var ch=Object.create;var jn=Object.defineProperty;var lh=Object.getOwnPropertyDescriptor;var ph=Object.getOwnPropertyNames;var fh=Object.getPrototypeOf,dh=Object.prototype.hasOwnProperty;var d=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),hh=(t,e)=>{for(var r in e)jn(t,r,{get:e[r],enumerable:!0})},qo=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ph(e))!dh.call(t,i)&&i!==r&&jn(t,i,{get:()=>e[i],enumerable:!(n=lh(e,i))||n.enumerable});return t};var qr=(t,e,r)=>(r=t!=null?ch(fh(t)):{},qo(e||!t||!t.__esModule?jn(r,"default",{value:t,enumerable:!0}):r,t)),vh=t=>qo(jn({},"__esModule",{value:!0}),t);var C=(t,e,r)=>new Promise((n,i)=>{var s=u=>{try{o(r.next(u))}catch(c){i(c)}},a=u=>{try{o(r.throw(u))}catch(c){i(c)}},o=u=>u.done?n(u.value):Promise.resolve(u.value).then(s,a);o((r=r.apply(t,e)).next())});var ae=d((vE,No)=>{"use strict";var gh=function(){function t(){}return t.info=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];t.enableDebug&&console.info(t.TAG+e,r)},t.warn=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];t.disableWarnings||console.warn(t.TAG+e,r)},t.enableDebug=!1,t.disableWarnings=!1,t.disableErrors=!1,t.TAG="ApplicationInsights:",t}();No.exports=gh});var $n=d(ht=>{"use strict";var Lo=ht&&ht.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(ht,"__esModule",{value:!0});var Tt=wt(),mh=require("events"),yh;(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(yh=ht.SpanKind||(ht.SpanKind={}));var Mo=function(){function t(){}return t.prototype.active=function(){var e=this,r=Tt.CorrelationContextManager.getCurrentContext();return Lo({},r,{getValue:function(n){return e._activeSymbol?n===e._activeSymbol?r:!1:(e._activeSymbol=n,r)},setValue:function(){}})},t.prototype.with=function(e,r){var n=e.parentSpanId,i=e.name,s=t._spanToContext(e,n,i);return Tt.CorrelationContextManager.runWithContext(s,r)()},t.prototype.bind=function(e){return typeof e=="function"?Tt.CorrelationContextManager.wrapCallback(e):(e instanceof mh.EventEmitter&&Tt.CorrelationContextManager.wrapEmitter(e),e)},t.prototype.enable=function(){return Tt.CorrelationContextManager.enable(),this},t.prototype.disable=function(){return Tt.CorrelationContextManager.disable(),this},t._spanToContext=function(e,r,n){var i=r?"|"+e.context().traceId+"."+r+".":e.context().traceId,s=Lo({},e.context(),{traceFlags:e.context().traceFlags.toString()}),a=Tt.CorrelationContextManager.spanToContextObject(s,i,n);return a},t}();ht.OpenTelemetryScopeManagerWrapper=Mo;ht.AsyncScopeManager=new Mo});var Jn=d((x,Zo)=>{x=Zo.exports=R;var H;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?H=function(){var t=Array.prototype.slice.call(arguments,0);t.unshift("SEMVER"),console.log.apply(console,t)}:H=function(){};x.SEMVER_SPEC_VERSION="2.0.0";var Nr=256,Vn=Number.MAX_SAFE_INTEGER||9007199254740991,ns=16,_h=Nr-6,Lr=x.re=[],V=x.safeRe=[],g=x.src=[],D=0,us="[a-zA-Z0-9-]",is=[["\\s",1],["\\d",Nr],[us,_h]];function Kn(t){for(var e=0;e<is.length;e++){var r=is[e][0],n=is[e][1];t=t.split(r+"*").join(r+"{0,"+n+"}").split(r+"+").join(r+"{1,"+n+"}")}return t}var Zt=D++;g[Zt]="0|[1-9]\\d*";var er=D++;g[er]="\\d+";var cs=D++;g[cs]="\\d*[a-zA-Z-]"+us+"*";var Ho=D++;g[Ho]="("+g[Zt]+")\\.("+g[Zt]+")\\.("+g[Zt]+")";var jo=D++;g[jo]="("+g[er]+")\\.("+g[er]+")\\.("+g[er]+")";var ss=D++;g[ss]="(?:"+g[Zt]+"|"+g[cs]+")";var as=D++;g[as]="(?:"+g[er]+"|"+g[cs]+")";var ls=D++;g[ls]="(?:-("+g[ss]+"(?:\\."+g[ss]+")*))";var ps=D++;g[ps]="(?:-?("+g[as]+"(?:\\."+g[as]+")*))";var os=D++;g[os]=us+"+";var Fr=D++;g[Fr]="(?:\\+("+g[os]+"(?:\\."+g[os]+")*))";var fs=D++,Uo="v?"+g[Ho]+g[ls]+"?"+g[Fr]+"?";g[fs]="^"+Uo+"$";var ds="[v=\\s]*"+g[jo]+g[ps]+"?"+g[Fr]+"?",hs=D++;g[hs]="^"+ds+"$";var sr=D++;g[sr]="((?:<|>)?=?)";var Bn=D++;g[Bn]=g[er]+"|x|X|\\*";var Gn=D++;g[Gn]=g[Zt]+"|x|X|\\*";var It=D++;g[It]="[v=\\s]*("+g[Gn]+")(?:\\.("+g[Gn]+")(?:\\.("+g[Gn]+")(?:"+g[ls]+")?"+g[Fr]+"?)?)?";var rr=D++;g[rr]="[v=\\s]*("+g[Bn]+")(?:\\.("+g[Bn]+")(?:\\.("+g[Bn]+")(?:"+g[ps]+")?"+g[Fr]+"?)?)?";var $o=D++;g[$o]="^"+g[sr]+"\\s*"+g[It]+"$";var Vo=D++;g[Vo]="^"+g[sr]+"\\s*"+g[rr]+"$";var Bo=D++;g[Bo]="(?:^|[^\\d])(\\d{1,"+ns+"})(?:\\.(\\d{1,"+ns+"}))?(?:\\.(\\d{1,"+ns+"}))?(?:$|[^\\d])";var Xn=D++;g[Xn]="(?:~>?)";var nr=D++;g[nr]="(\\s*)"+g[Xn]+"\\s+";Lr[nr]=new RegExp(g[nr],"g");V[nr]=new RegExp(Kn(g[nr]),"g");var Ch="$1~",Go=D++;g[Go]="^"+g[Xn]+g[It]+"$";var zo=D++;g[zo]="^"+g[Xn]+g[rr]+"$";var Yn=D++;g[Yn]="(?:\\^)";var ir=D++;g[ir]="(\\s*)"+g[Yn]+"\\s+";Lr[ir]=new RegExp(g[ir],"g");V[ir]=new RegExp(Kn(g[ir]),"g");var Eh="$1^",Qo=D++;g[Qo]="^"+g[Yn]+g[It]+"$";var Wo=D++;g[Wo]="^"+g[Yn]+g[rr]+"$";var vs=D++;g[vs]="^"+g[sr]+"\\s*("+ds+")$|^$";var gs=D++;g[gs]="^"+g[sr]+"\\s*("+Uo+")$|^$";var xt=D++;g[xt]="(\\s*)"+g[sr]+"\\s*("+ds+"|"+g[It]+")";Lr[xt]=new RegExp(g[xt],"g");V[xt]=new RegExp(Kn(g[xt]),"g");var bh="$1$2$3",Ko=D++;g[Ko]="^\\s*("+g[It]+")\\s+-\\s+("+g[It]+")\\s*$";var Xo=D++;g[Xo]="^\\s*("+g[rr]+")\\s+-\\s+("+g[rr]+")\\s*$";var Yo=D++;g[Yo]="(<|>)?=?\\s*\\*";for(Ke=0;Ke<D;Ke++)H(Ke,g[Ke]),Lr[Ke]||(Lr[Ke]=new RegExp(g[Ke]),V[Ke]=new RegExp(Kn(g[Ke])));var Ke;x.parse=kt;function kt(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof R)return t;if(typeof t!="string"||t.length>Nr)return null;var r=e.loose?V[hs]:V[fs];if(!r.test(t))return null;try{return new R(t,e)}catch{return null}}x.valid=Th;function Th(t,e){var r=kt(t,e);return r?r.version:null}x.clean=wh;function wh(t,e){var r=kt(t.trim().replace(/^[=v]+/,""),e);return r?r.version:null}x.SemVer=R;function R(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof R){if(t.loose===e.loose)return t;t=t.version}else if(typeof t!="string")throw new TypeError("Invalid Version: "+t);if(t.length>Nr)throw new TypeError("version is longer than "+Nr+" characters");if(!(this instanceof R))return new R(t,e);H("SemVer",t,e),this.options=e,this.loose=!!e.loose;var r=t.trim().match(e.loose?V[hs]:V[fs]);if(!r)throw new TypeError("Invalid Version: "+t);if(this.raw=t,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Vn||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Vn||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Vn||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(function(n){if(/^[0-9]+$/.test(n)){var i=+n;if(i>=0&&i<Vn)return i}return n}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}R.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version};R.prototype.toString=function(){return this.version};R.prototype.compare=function(t){return H("SemVer.compare",this.version,this.options,t),t instanceof R||(t=new R(t,this.options)),this.compareMain(t)||this.comparePre(t)};R.prototype.compareMain=function(t){return t instanceof R||(t=new R(t,this.options)),tr(this.major,t.major)||tr(this.minor,t.minor)||tr(this.patch,t.patch)};R.prototype.comparePre=function(t){if(t instanceof R||(t=new R(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;var e=0;do{var r=this.prerelease[e],n=t.prerelease[e];if(H("prerelease compare",e,r,n),r===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(r===void 0)return-1;if(r===n)continue;return tr(r,n)}while(++e)};R.prototype.inc=function(t,e){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var r=this.prerelease.length;--r>=0;)typeof this.prerelease[r]=="number"&&(this.prerelease[r]++,r=-2);r===-1&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+t)}return this.format(),this.raw=this.version,this};x.inc=Ih;function Ih(t,e,r,n){typeof r=="string"&&(n=r,r=void 0);try{return new R(t,r).inc(e,n).version}catch{return null}}x.diff=xh;function xh(t,e){if(ms(t,e))return null;var r=kt(t),n=kt(e),i="";if(r.prerelease.length||n.prerelease.length){i="pre";var s="prerelease"}for(var a in r)if((a==="major"||a==="minor"||a==="patch")&&r[a]!==n[a])return i+a;return s}x.compareIdentifiers=tr;var Fo=/^[0-9]+$/;function tr(t,e){var r=Fo.test(t),n=Fo.test(e);return r&&n&&(t=+t,e=+e),t===e?0:r&&!n?-1:n&&!r?1:t<e?-1:1}x.rcompareIdentifiers=kh;function kh(t,e){return tr(e,t)}x.major=Sh;function Sh(t,e){return new R(t,e).major}x.minor=Ph;function Ph(t,e){return new R(t,e).minor}x.patch=Ah;function Ah(t,e){return new R(t,e).patch}x.compare=tt;function tt(t,e,r){return new R(t,r).compare(new R(e,r))}x.compareLoose=Dh;function Dh(t,e){return tt(t,e,!0)}x.rcompare=Rh;function Rh(t,e,r){return tt(e,t,r)}x.sort=Oh;function Oh(t,e){return t.sort(function(r,n){return x.compare(r,n,e)})}x.rsort=qh;function qh(t,e){return t.sort(function(r,n){return x.rcompare(r,n,e)})}x.gt=Mr;function Mr(t,e,r){return tt(t,e,r)>0}x.lt=zn;function zn(t,e,r){return tt(t,e,r)<0}x.eq=ms;function ms(t,e,r){return tt(t,e,r)===0}x.neq=Jo;function Jo(t,e,r){return tt(t,e,r)!==0}x.gte=ys;function ys(t,e,r){return tt(t,e,r)>=0}x.lte=_s;function _s(t,e,r){return tt(t,e,r)<=0}x.cmp=Qn;function Qn(t,e,r,n){switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t===r;case"!==":return typeof t=="object"&&(t=t.version),typeof r=="object"&&(r=r.version),t!==r;case"":case"=":case"==":return ms(t,r,n);case"!=":return Jo(t,r,n);case">":return Mr(t,r,n);case">=":return ys(t,r,n);case"<":return zn(t,r,n);case"<=":return _s(t,r,n);default:throw new TypeError("Invalid operator: "+e)}}x.Comparator=Oe;function Oe(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof Oe){if(t.loose===!!e.loose)return t;t=t.value}if(!(this instanceof Oe))return new Oe(t,e);t=t.trim().split(/\s+/).join(" "),H("comparator",t,e),this.options=e,this.loose=!!e.loose,this.parse(t),this.semver===Hr?this.value="":this.value=this.operator+this.semver.version,H("comp",this)}var Hr={};Oe.prototype.parse=function(t){var e=this.options.loose?V[vs]:V[gs],r=t.match(e);if(!r)throw new TypeError("Invalid comparator: "+t);this.operator=r[1],this.operator==="="&&(this.operator=""),r[2]?this.semver=new R(r[2],this.options.loose):this.semver=Hr};Oe.prototype.toString=function(){return this.value};Oe.prototype.test=function(t){return H("Comparator.test",t,this.options.loose),this.semver===Hr?!0:(typeof t=="string"&&(t=new R(t,this.options)),Qn(t,this.operator,this.semver,this.options))};Oe.prototype.intersects=function(t,e){if(!(t instanceof Oe))throw new TypeError("a Comparator is required");(!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1});var r;if(this.operator==="")return r=new W(t.value,e),Wn(this.value,r,e);if(t.operator==="")return r=new W(this.value,e),Wn(t.semver,r,e);var n=(this.operator===">="||this.operator===">")&&(t.operator===">="||t.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(t.operator==="<="||t.operator==="<"),s=this.semver.version===t.semver.version,a=(this.operator===">="||this.operator==="<=")&&(t.operator===">="||t.operator==="<="),o=Qn(this.semver,"<",t.semver,e)&&(this.operator===">="||this.operator===">")&&(t.operator==="<="||t.operator==="<"),u=Qn(this.semver,">",t.semver,e)&&(this.operator==="<="||this.operator==="<")&&(t.operator===">="||t.operator===">");return n||i||s&&a||o||u};x.Range=W;function W(t,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),t instanceof W)return t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease?t:new W(t.raw,e);if(t instanceof Oe)return new W(t.value,e);if(!(this instanceof W))return new W(t,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=t.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(function(r){return this.parseRange(r.trim())},this).filter(function(r){return r.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+this.raw);this.format()}W.prototype.format=function(){return this.range=this.set.map(function(t){return t.join(" ").trim()}).join("||").trim(),this.range};W.prototype.toString=function(){return this.range};W.prototype.parseRange=function(t){var e=this.options.loose,r=e?V[Xo]:V[Ko];t=t.replace(r,Bh),H("hyphen replace",t),t=t.replace(V[xt],bh),H("comparator trim",t,V[xt]),t=t.replace(V[nr],Ch),t=t.replace(V[ir],Eh);var n=e?V[vs]:V[gs],i=t.split(" ").map(function(s){return Lh(s,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(i=i.filter(function(s){return!!s.match(n)})),i=i.map(function(s){return new Oe(s,this.options)},this),i};W.prototype.intersects=function(t,e){if(!(t instanceof W))throw new TypeError("a Range is required");return this.set.some(function(r){return r.every(function(n){return t.set.some(function(i){return i.every(function(s){return n.intersects(s,e)})})})})};x.toComparators=Nh;function Nh(t,e){return new W(t,e).set.map(function(r){return r.map(function(n){return n.value}).join(" ").trim().split(" ")})}function Lh(t,e){return H("comp",t,e),t=Hh(t,e),H("caret",t),t=Mh(t,e),H("tildes",t),t=Uh(t,e),H("xrange",t),t=Vh(t,e),H("stars",t),t}function Ee(t){return!t||t.toLowerCase()==="x"||t==="*"}function Mh(t,e){return t.trim().split(/\s+/).map(function(r){return Fh(r,e)}).join(" ")}function Fh(t,e){var r=e.loose?V[zo]:V[Go];return t.replace(r,function(n,i,s,a,o){H("tilde",t,n,i,s,a,o);var u;return Ee(i)?u="":Ee(s)?u=">="+i+".0.0 <"+(+i+1)+".0.0":Ee(a)?u=">="+i+"."+s+".0 <"+i+"."+(+s+1)+".0":o?(H("replaceTilde pr",o),u=">="+i+"."+s+"."+a+"-"+o+" <"+i+"."+(+s+1)+".0"):u=">="+i+"."+s+"."+a+" <"+i+"."+(+s+1)+".0",H("tilde return",u),u})}function Hh(t,e){return t.trim().split(/\s+/).map(function(r){return jh(r,e)}).join(" ")}function jh(t,e){H("caret",t,e);var r=e.loose?V[Wo]:V[Qo];return t.replace(r,function(n,i,s,a,o){H("caret",t,n,i,s,a,o);var u;return Ee(i)?u="":Ee(s)?u=">="+i+".0.0 <"+(+i+1)+".0.0":Ee(a)?i==="0"?u=">="+i+"."+s+".0 <"+i+"."+(+s+1)+".0":u=">="+i+"."+s+".0 <"+(+i+1)+".0.0":o?(H("replaceCaret pr",o),i==="0"?s==="0"?u=">="+i+"."+s+"."+a+"-"+o+" <"+i+"."+s+"."+(+a+1):u=">="+i+"."+s+"."+a+"-"+o+" <"+i+"."+(+s+1)+".0":u=">="+i+"."+s+"."+a+"-"+o+" <"+(+i+1)+".0.0"):(H("no pr"),i==="0"?s==="0"?u=">="+i+"."+s+"."+a+" <"+i+"."+s+"."+(+a+1):u=">="+i+"."+s+"."+a+" <"+i+"."+(+s+1)+".0":u=">="+i+"."+s+"."+a+" <"+(+i+1)+".0.0"),H("caret return",u),u})}function Uh(t,e){return H("replaceXRanges",t,e),t.split(/\s+/).map(function(r){return $h(r,e)}).join(" ")}function $h(t,e){t=t.trim();var r=e.loose?V[Vo]:V[$o];return t.replace(r,function(n,i,s,a,o,u){H("xRange",t,n,i,s,a,o,u);var c=Ee(s),l=c||Ee(a),p=l||Ee(o),f=p;return i==="="&&f&&(i=""),c?i===">"||i==="<"?n="<0.0.0":n="*":i&&f?(l&&(a=0),o=0,i===">"?(i=">=",l?(s=+s+1,a=0,o=0):(a=+a+1,o=0)):i==="<="&&(i="<",l?s=+s+1:a=+a+1),n=i+s+"."+a+"."+o):l?n=">="+s+".0.0 <"+(+s+1)+".0.0":p&&(n=">="+s+"."+a+".0 <"+s+"."+(+a+1)+".0"),H("xRange return",n),n})}function Vh(t,e){return H("replaceStars",t,e),t.trim().replace(V[Yo],"")}function Bh(t,e,r,n,i,s,a,o,u,c,l,p,f){return Ee(r)?e="":Ee(n)?e=">="+r+".0.0":Ee(i)?e=">="+r+"."+n+".0":e=">="+e,Ee(u)?o="":Ee(c)?o="<"+(+u+1)+".0.0":Ee(l)?o="<"+u+"."+(+c+1)+".0":p?o="<="+u+"."+c+"."+l+"-"+p:o="<="+o,(e+" "+o).trim()}W.prototype.test=function(t){if(!t)return!1;typeof t=="string"&&(t=new R(t,this.options));for(var e=0;e<this.set.length;e++)if(Gh(this.set[e],t,this.options))return!0;return!1};function Gh(t,e,r){for(var n=0;n<t.length;n++)if(!t[n].test(e))return!1;if(e.prerelease.length&&!r.includePrerelease){for(n=0;n<t.length;n++)if(H(t[n].semver),t[n].semver!==Hr&&t[n].semver.prerelease.length>0){var i=t[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}x.satisfies=Wn;function Wn(t,e,r){try{e=new W(e,r)}catch{return!1}return e.test(t)}x.maxSatisfying=zh;function zh(t,e,r){var n=null,i=null;try{var s=new W(e,r)}catch{return null}return t.forEach(function(a){s.test(a)&&(!n||i.compare(a)===-1)&&(n=a,i=new R(n,r))}),n}x.minSatisfying=Qh;function Qh(t,e,r){var n=null,i=null;try{var s=new W(e,r)}catch{return null}return t.forEach(function(a){s.test(a)&&(!n||i.compare(a)===1)&&(n=a,i=new R(n,r))}),n}x.minVersion=Wh;function Wh(t,e){t=new W(t,e);var r=new R("0.0.0");if(t.test(r)||(r=new R("0.0.0-0"),t.test(r)))return r;r=null;for(var n=0;n<t.set.length;++n){var i=t.set[n];i.forEach(function(s){var a=new R(s.semver.version);switch(s.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!r||Mr(r,a))&&(r=a);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+s.operator)}})}return r&&t.test(r)?r:null}x.validRange=Kh;function Kh(t,e){try{return new W(t,e).range||"*"}catch{return null}}x.ltr=Xh;function Xh(t,e,r){return Cs(t,e,"<",r)}x.gtr=Yh;function Yh(t,e,r){return Cs(t,e,">",r)}x.outside=Cs;function Cs(t,e,r,n){t=new R(t,n),e=new W(e,n);var i,s,a,o,u;switch(r){case">":i=Mr,s=_s,a=zn,o=">",u=">=";break;case"<":i=zn,s=ys,a=Mr,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Wn(t,e,n))return!1;for(var c=0;c<e.set.length;++c){var l=e.set[c],p=null,f=null;if(l.forEach(function(h){h.semver===Hr&&(h=new Oe(">=0.0.0")),p=p||h,f=f||h,i(h.semver,p.semver,n)?p=h:a(h.semver,f.semver,n)&&(f=h)}),p.operator===o||p.operator===u||(!f.operator||f.operator===o)&&s(t,f.semver))return!1;if(f.operator===u&&a(t,f.semver))return!1}return!0}x.prerelease=Jh;function Jh(t,e){var r=kt(t,e);return r&&r.prerelease.length?r.prerelease:null}x.intersects=Zh;function Zh(t,e,r){return t=new W(t,r),e=new W(e,r),t.intersects(e)}x.coerce=ev;function ev(t){if(t instanceof R)return t;if(typeof t!="string")return null;var e=t.match(V[Bo]);return e==null?null:kt(e[1]+"."+(e[2]||"0")+"."+(e[3]||"0"))}});var bs=d(Es=>{"use strict";Object.defineProperty(Es,"__esModule",{value:!0});var tv=require("path"),rv=Jn(),tu=require("module"),nv=Object.keys(process.binding("natives")),eu=tu.prototype.require;function iv(t){var e={};return function(n){var i=eu.apply(this,arguments);if(t[n]){var s=tu._resolveFilename(n,this);if(e.hasOwnProperty(s))return e[s];var a=void 0;if(nv.indexOf(n)<0)try{a=eu.call(this,tv.join(n,"package.json")).version}catch{return i}else a=process.version.substring(1);var o=a.indexOf("-");o>=0&&(a=a.substring(0,o));for(var u=i,c=0,l=t[n];c<l.length;c++){var p=l[c];rv.satisfies(a,p.versionSpecifier)&&(u=p.patch(u,s))}return e[s]=u}return i}}Es.makePatchingRequire=iv});var ru=d((yE,sv)=>{sv.exports={name:"diagnostic-channel",version:"0.3.1",main:"./dist/src/channel.js",types:"./dist/src/channel.d.ts",scripts:{build:"tsc",lint:"tslint -c tslint.json -p tsconfig.json",clean:"rimraf ./dist",test:"mocha ./dist/tests/**/*.js"},homepage:"https://github.com/Microsoft/node-diagnostic-channel",bugs:{url:"https://github.com/Microsoft/node-diagnostic-channel/issues"},repository:{type:"git",url:"https://github.com/Microsoft/node-diagnostic-channel.git"},description:"Provides a context-saving pub/sub channel to connect diagnostic event publishers and subscribers",dependencies:{semver:"^5.3.0"},devDependencies:{"@types/mocha":"^2.2.40","@types/node":"^7.0.12",mocha:"^3.2.0",rimraf:"^2.6.1",tslint:"^5.0.0",typescript:"^2.2.1"},files:["dist/src/**/*.d.ts","dist/src/**/*.js","LICENSE","README.md","package.json"],license:"MIT"}});var J=d(Zn=>{"use strict";Object.defineProperty(Zn,"__esModule",{value:!0});var av=bs(),ov=bs();Zn.makePatchingRequire=ov.makePatchingRequire;var nu=function(t){return!0},uv=function(){function t(){this.version=ru().version,this.subscribers={},this.contextPreservationFunction=function(e){return e},this.knownPatches={},this.currentlyPublishing=!1}return t.prototype.shouldPublish=function(e){var r=this.subscribers[e];return r?r.some(function(n){var i=n.filter;return!i||i(!1)}):!1},t.prototype.publish=function(e,r){if(!this.currentlyPublishing){var n=this.subscribers[e];if(n){var i={timestamp:Date.now(),data:r};this.currentlyPublishing=!0,n.forEach(function(s){var a=s.listener,o=s.filter;try{o&&o(!0)&&a(i)}catch{}}),this.currentlyPublishing=!1}}},t.prototype.subscribe=function(e,r,n){n===void 0&&(n=nu),this.subscribers[e]||(this.subscribers[e]=[]),this.subscribers[e].push({listener:r,filter:n})},t.prototype.unsubscribe=function(e,r,n){n===void 0&&(n=nu);var i=this.subscribers[e];if(i){for(var s=0;s<i.length;++s)if(i[s].listener===r&&i[s].filter===n)return i.splice(s,1),!0}return!1},t.prototype.reset=function(){var e=this;this.subscribers={},this.contextPreservationFunction=function(r){return r},Object.getOwnPropertyNames(this.knownPatches).forEach(function(r){return delete e.knownPatches[r]})},t.prototype.bindToContext=function(e){return this.contextPreservationFunction(e)},t.prototype.addContextPreservation=function(e){var r=this.contextPreservationFunction;this.contextPreservationFunction=function(n){return e(r(n))}},t.prototype.registerMonkeyPatch=function(e,r){this.knownPatches[e]||(this.knownPatches[e]=[]),this.knownPatches[e].push(r)},t.prototype.getPatchesObject=function(){return this.knownPatches},t}();global.diagnosticsSource||(global.diagnosticsSource=new uv,iu=require("module"),iu.prototype.require=av.makePatchingRequire(global.diagnosticsSource.getPatchesObject()));var iu;Zn.channel=global.diagnosticsSource});var au=d(rt=>{"use strict";var cv=rt&&rt.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(rt,"__esModule",{value:!0});var ei=J();rt.AzureMonitorSymbol="Azure_Monitor_Tracer";var su=!1,lv=function(t){if(su)return t;try{var e=require("@opentelemetry/tracing"),r=require("@opentelemetry/api"),n=ei.channel.spanContextPropagator?{contextManager:ei.channel.spanContextPropagator}:void 0;new e.BasicTracerProvider().register(n);var i=r.trace.getTracer("applicationinsights tracer"),s=i.startSpan;i.startSpan=function(a,o){if(!o||!o.parent){var u=r.getSpan(r.context.active());u&&u.operation&&u.operation.traceparent&&(o=cv({},o,{parent:{traceId:u.operation.traceparent.traceId,spanId:u.operation.traceparent.spanId,traceFlags:1}}))}var c=s.call(this,a,o),l=c.end;return c.end=function(){var p=l.apply(this,arguments);return ei.channel.publish("azure-coretracing",c),p},c},r.getSpan(r.context.active()),i[rt.AzureMonitorSymbol]=!0,t.setTracer(i),su=!0}catch{}return t};rt.azureCoreTracing={versionSpecifier:">= 1.0.0 < 2.0.0",patch:lv};function pv(){ei.channel.registerMonkeyPatch("@azure/core-tracing",rt.azureCoreTracing)}rt.enable=pv});var uu=d(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});var ou=J(),fv=function(t){var e=t.prototype._emit;return t.prototype._emit=function(r,n){var i=e.apply(this,arguments);if(!n){var s=i;s||(s=e.call(this,r,!0)),ou.channel.publish("bunyan",{level:r.level,result:s})}return i},t};jr.bunyan={versionSpecifier:">= 1.0.0 < 2.0.0",patch:fv};function dv(){ou.channel.registerMonkeyPatch("bunyan",jr.bunyan)}jr.enable=dv});var lu=d(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});var Ts=J(),cu=require("stream"),hv=function(t){var e=new cu.Writable,r=new cu.Writable;e.write=function(c){if(!c)return!0;var l=c.toString();return Ts.channel.publish("console",{message:l}),!0},r.write=function(c){if(!c)return!0;var l=c.toString();return Ts.channel.publish("console",{message:l,stderr:!0}),!0};for(var n=new t.Console(e,r),i=["log","info","warn","error","dir","time","timeEnd","trace","assert"],s=function(c){var l=t[c];l&&(t[c]=function(){if(n[c])try{n[c].apply(n,arguments)}catch{}return l.apply(t,arguments)})},a=0,o=i;a<o.length;a++){var u=o[a];s(u)}return t};Ur.console={versionSpecifier:">= 4.0.0",patch:hv};function vv(){Ts.channel.registerMonkeyPatch("console",Ur.console),require("console")}Ur.enable=vv});var pu=d($r=>{"use strict";Object.defineProperty($r,"__esModule",{value:!0});var ws=J(),gv=function(t){var e=t.Server.prototype.connect;return t.Server.prototype.connect=function(){var n=e.apply(this,arguments),i=this.s.pool.write;this.s.pool.write=function(){var o=typeof arguments[1]=="function"?1:2;return typeof arguments[o]=="function"&&(arguments[o]=ws.channel.bindToContext(arguments[o])),i.apply(this,arguments)};var s=this.s.pool.logout;return this.s.pool.logout=function(){return typeof arguments[1]=="function"&&(arguments[1]=ws.channel.bindToContext(arguments[1])),s.apply(this,arguments)},n},t};$r.mongoCore={versionSpecifier:">= 2.0.0 < 4.0.0",patch:gv};function mv(){ws.channel.registerMonkeyPatch("mongodb-core",$r.mongoCore)}$r.enable=mv});var du=d(je=>{"use strict";var fu=je&&je.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(je,"__esModule",{value:!0});var ge=J(),yv=function(t){var e=t.instrument({operationIdGenerator:{next:function(){return ge.channel.bindToContext(function(n){return n()})}}}),r={};return e.on("started",function(n){r[n.requestId]||(r[n.requestId]=fu({},n,{time:new Date}))}),e.on("succeeded",function(n){var i=r[n.requestId];i&&delete r[n.requestId],typeof n.operationId=="function"?n.operationId(function(){return ge.channel.publish("mongodb",{startedData:i,event:n,succeeded:!0})}):ge.channel.publish("mongodb",{startedData:i,event:n,succeeded:!0})}),e.on("failed",function(n){var i=r[n.requestId];i&&delete r[n.requestId],typeof n.operationId=="function"?n.operationId(function(){return ge.channel.publish("mongodb",{startedData:i,event:n,succeeded:!1})}):ge.channel.publish("mongodb",{startedData:i,event:n,succeeded:!1})}),t},_v=function(t){var e=t.instrument(),r={},n={};return e.on("started",function(i){r[i.requestId]||(n[i.requestId]=ge.channel.bindToContext(function(s){return s()}),r[i.requestId]=fu({},i,{time:new Date}))}),e.on("succeeded",function(i){var s=r[i.requestId];s&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return ge.channel.publish("mongodb",{startedData:s,event:i,succeeded:!0})}),delete n[i.requestId])}),e.on("failed",function(i){var s=r[i.requestId];s&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return ge.channel.publish("mongodb",{startedData:s,event:i,succeeded:!1})}),delete n[i.requestId])}),t},Cv=function(t){var e=t.Server.prototype.connect;return t.Server.prototype.connect=function(){var n=e.apply(this,arguments),i=this.s.coreTopology.s.pool.write;this.s.coreTopology.s.pool.write=function(){var o=typeof arguments[1]=="function"?1:2;return typeof arguments[o]=="function"&&(arguments[o]=ge.channel.bindToContext(arguments[o])),i.apply(this,arguments)};var s=this.s.coreTopology.s.pool.logout;return this.s.coreTopology.s.pool.logout=function(){return typeof arguments[1]=="function"&&(arguments[1]=ge.channel.bindToContext(arguments[1])),s.apply(this,arguments)},n},t},Ev=function(t){Cv(t);var e=t.instrument(),r={},n={};return e.on("started",function(i){r[i.requestId]||(n[i.requestId]=ge.channel.bindToContext(function(s){return s()}),r[i.requestId]=i)}),e.on("succeeded",function(i){var s=r[i.requestId];s&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return ge.channel.publish("mongodb",{startedData:s,event:i,succeeded:!0})}),delete n[i.requestId])}),e.on("failed",function(i){var s=r[i.requestId];s&&delete r[i.requestId],typeof i=="object"&&typeof n[i.requestId]=="function"&&(n[i.requestId](function(){return ge.channel.publish("mongodb",{startedData:s,event:i,succeeded:!1})}),delete n[i.requestId])}),t};je.mongo2={versionSpecifier:">= 2.0.0 <= 3.0.5",patch:yv};je.mongo3={versionSpecifier:"> 3.0.5 < 3.3.0",patch:_v};je.mongo330={versionSpecifier:">= 3.3.0 < 4.0.0",patch:Ev};function bv(){ge.channel.registerMonkeyPatch("mongodb",je.mongo2),ge.channel.registerMonkeyPatch("mongodb",je.mongo3),ge.channel.registerMonkeyPatch("mongodb",je.mongo330)}je.enable=bv});var vu=d(Vr=>{"use strict";Object.defineProperty(Vr,"__esModule",{value:!0});var ti=J(),hu=require("path"),Tv=function(t,e){var r=function(u,c){return function(l,p){var f=u[l];f&&(u[l]=function(){for(var m=arguments.length-1,E=arguments.length-1;E>=0;--E)if(typeof arguments[E]=="function"){m=E;break}else if(typeof arguments[E]<"u")break;var I=arguments[m],q={result:null,startTime:null,startDate:null};typeof I=="function"&&(p?(q.startTime=process.hrtime(),q.startDate=new Date,arguments[m]=ti.channel.bindToContext(p(q,I))):arguments[m]=ti.channel.bindToContext(I));var Q=f.apply(this,arguments);return q.result=Q,Q})}},n=function(u,c){return r(u.prototype,c+".prototype")},i=["connect","changeUser","ping","statistics","end"],s=require(hu.dirname(e)+"/lib/Connection");i.forEach(function(u){return n(s,"Connection")(u)}),r(s,"Connection")("createQuery",function(u,c){return function(l){var p=process.hrtime(u.startTime),f=p[0]*1e3+p[1]/1e6|0;ti.channel.publish("mysql",{query:u.result,callbackArgs:arguments,err:l,duration:f,time:u.startDate}),c.apply(this,arguments)}});var a=["_enqueueCallback"],o=require(hu.dirname(e)+"/lib/Pool");return a.forEach(function(u){return n(o,"Pool")(u)}),t};Vr.mysql={versionSpecifier:">= 2.0.0 < 3.0.0",patch:Tv};function wv(){ti.channel.registerMonkeyPatch("mysql",Vr.mysql)}Vr.enable=wv});var mu=d(Br=>{"use strict";Object.defineProperty(Br,"__esModule",{value:!0});var gu=J();function Iv(t){var e=t.prototype.connect;return t.prototype.connect=function(n){return n&&(arguments[0]=gu.channel.bindToContext(n)),e.apply(this,arguments)},t}Br.postgresPool1={versionSpecifier:">= 1.0.0 < 3.0.0",patch:Iv};function xv(){gu.channel.registerMonkeyPatch("pg-pool",Br.postgresPool1)}Br.enable=xv});var _u=d(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});var ar=J(),yu=require("events");function kv(t,e){var r=t.Client.prototype.query,n="__diagnosticOriginalFunc";return t.Client.prototype.query=function(s,a,o){var u={query:{},database:{host:this.connectionParameters.host,port:this.connectionParameters.port},result:null,error:null,duration:0,time:new Date},c=process.hrtime(),l;function p(f){f&&f[n]&&(f=f[n]);var h=ar.channel.bindToContext(function(m,E){var I=process.hrtime(c);if(u.result=E&&{rowCount:E.rowCount,command:E.command},u.error=m,u.duration=Math.ceil(I[0]*1e3+I[1]/1e6),ar.channel.publish("postgres",u),m){if(f)return f.apply(this,arguments);l&&l instanceof yu.EventEmitter&&l.emit("error",m)}else f&&f.apply(this,arguments)});try{return Object.defineProperty(h,n,{value:f}),h}catch{return f}}try{typeof s=="string"?a instanceof Array?(u.query.preparable={text:s,args:a},o=p(o)):(u.query.text=s,o?o=p(o):a=p(a)):(typeof s.name=="string"?u.query.plan=s.name:s.values instanceof Array?u.query.preparable={text:s.text,args:s.values}:u.query.text=s.text,o?o=p(o):a?a=p(a):s.callback=p(s.callback))}catch{return r.apply(this,arguments)}return arguments[0]=s,arguments[1]=a,arguments[2]=o,arguments.length=arguments.length>3?arguments.length:3,l=r.apply(this,arguments),l},t}function Sv(t,e){var r=t.Client.prototype.query,n="__diagnosticOriginalFunc";return t.Client.prototype.query=function(s,a,o){var u=this,c=!!o,l={query:{},database:{host:this.connectionParameters.host,port:this.connectionParameters.port},result:null,error:null,duration:0,time:new Date},p=process.hrtime(),f;function h(m){m&&m[n]&&(m=m[n]);var E=ar.channel.bindToContext(function(I,q){var Q=process.hrtime(p);if(l.result=q&&{rowCount:q.rowCount,command:q.command},l.error=I,l.duration=Math.ceil(Q[0]*1e3+Q[1]/1e6),ar.channel.publish("postgres",l),I){if(m)return m.apply(this,arguments);f&&f instanceof yu.EventEmitter&&f.emit("error",I)}else m&&m.apply(this,arguments)});try{return Object.defineProperty(E,n,{value:m}),E}catch{return m}}try{typeof s=="string"?a instanceof Array?(l.query.preparable={text:s,args:a},c=typeof o=="function",o=c?h(o):o):(l.query.text=s,o?(c=typeof o=="function",o=c?h(o):o):(c=typeof a=="function",a=c?h(a):a)):(typeof s.name=="string"?l.query.plan=s.name:s.values instanceof Array?l.query.preparable={text:s.text,args:s.values}:l.query.text=s.text,o?(c=typeof o=="function",o=h(o)):a?(c=typeof a=="function",a=c?h(a):a):(c=typeof s.callback=="function",s.callback=c?h(s.callback):s.callback))}catch{return r.apply(this,arguments)}return arguments[0]=s,arguments[1]=a,arguments[2]=o,arguments.length=arguments.length>3?arguments.length:3,f=r.apply(this,arguments),c?f:f.then(function(m){return h()(void 0,m),new u._Promise(function(E,I){E(m)})}).catch(function(m){return h()(m,void 0),new u._Promise(function(E,I){I(m)})})},t}St.postgres6={versionSpecifier:"6.*",patch:kv};St.postgres7={versionSpecifier:">=7.* <=8.*",patch:Sv};function Pv(){ar.channel.registerMonkeyPatch("pg",St.postgres6),ar.channel.registerMonkeyPatch("pg",St.postgres7)}St.enable=Pv});var Cu=d(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});var Is=J(),Av=function(t){var e=t.RedisClient.prototype.internal_send_command;return t.RedisClient.prototype.internal_send_command=function(r){if(r){var n=r.callback;if(!n||!n.pubsubBound){var i=this.address,s=process.hrtime(),a=new Date;r.callback=Is.channel.bindToContext(function(o,u){var c=process.hrtime(s),l=c[0]*1e3+c[1]/1e6|0;Is.channel.publish("redis",{duration:l,address:i,commandObj:r,err:o,result:u,time:a}),typeof n=="function"&&n.apply(this,arguments)}),r.callback.pubsubBound=!0}}return e.call(this,r)},t};Gr.redis={versionSpecifier:">= 2.0.0 < 4.0.0",patch:Av};function Dv(){Is.channel.registerMonkeyPatch("redis",Gr.redis)}Gr.enable=Dv});var Eu=d(Pt=>{"use strict";var Rv=Pt&&Pt.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(Pt,"__esModule",{value:!0});var xs=J(),Ov=function(t){var e=t.Connection.prototype.makeRequest;return t.Connection.prototype.makeRequest=function(){function n(s){var a=process.hrtime(),o={query:{},database:{host:null,port:null},result:null,error:null,duration:0};return xs.channel.bindToContext(function(u,c,l){var p=process.hrtime(a);o=Rv({},o,{database:{host:this.connection.config.server,port:this.connection.config.options.port},result:!u&&{rowCount:c,rows:l},query:{text:this.parametersByName.statement.value},error:u,duration:Math.ceil(p[0]*1e3+p[1]/1e6)}),xs.channel.publish("tedious",o),s.call(this,u,c,l)})}var i=arguments[0];arguments[0].callback=n(i.callback),e.apply(this,arguments)},t};Pt.tedious={versionSpecifier:">= 6.0.0 < 9.0.0",patch:Ov};function qv(){xs.channel.registerMonkeyPatch("tedious",Pt.tedious)}Pt.enable=qv});var bu=d(Ue=>{"use strict";var Nv=Ue&&Ue.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Lv=Ue&&Ue.__rest||function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&(r[n[i]]=t[n[i]]);return r};Object.defineProperty(Ue,"__esModule",{value:!0});var ri=J(),Mv=function(t){var e=t.Logger.prototype.log,r,n=function(i,s,a){var o;return r===t.config.npm.levels?o="npm":r===t.config.syslog.levels?o="syslog":o="unknown",ri.channel.publish("winston",{level:i,message:s,meta:a,levelKind:o}),s};return t.Logger.prototype.log=function(){return r=this.levels,!this.filters||this.filters.length===0?this.filters=[n]:this.filters[this.filters.length-1]!==n&&(this.filters=this.filters.filter(function(s){return s!==n}),this.filters.push(n)),e.apply(this,arguments)},t},Fv=function(t){var e=function(a,o){var u;return a.config.npm.levels[o]!=null?u="npm":a.config.syslog.levels[o]!=null?u="syslog":u="unknown",u},r=function(a){Nv(o,a);function o(u,c){var l=a.call(this,c)||this;return l.winston=u,l}return o.prototype.log=function(u,c){var l=u.message,p=u.level,f=u.meta,h=Lv(u,["message","level","meta"]);p=typeof Symbol.for=="function"?u[Symbol.for("level")]:p,l=u instanceof Error?u:l;var m=e(this.winston,p);f=f||{};for(var E in h)h.hasOwnProperty(E)&&(f[E]=h[E]);ri.channel.publish("winston",{message:l,level:p,levelKind:m,meta:f}),c()},o}(t.Transport);function n(){var a=arguments[0].levels||t.config.npm.levels,o;for(var u in a)a.hasOwnProperty(u)&&(o=o===void 0||a[u]>a[o]?u:o);this.add(new r(t,{level:o}))}var i=t.createLogger;t.createLogger=function(){var o=arguments[0].levels||t.config.npm.levels,u;for(var c in o)o.hasOwnProperty(c)&&(u=u===void 0||o[c]>o[u]?c:u);var l=i.apply(this,arguments);l.add(new r(t,{level:u}));var p=l.configure;return l.configure=function(){p.apply(this,arguments),n.apply(this,arguments)},l};var s=t.configure;return t.configure=function(){s.apply(this,arguments),n.apply(this,arguments)},t.add(new r(t)),t};Ue.winston3={versionSpecifier:"3.x",patch:Fv};Ue.winston2={versionSpecifier:"2.x",patch:Mv};function Hv(){ri.channel.registerMonkeyPatch("winston",Ue.winston2),ri.channel.registerMonkeyPatch("winston",Ue.winston3)}Ue.enable=Hv});var qu=d(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});var Tu=au();xe.azuresdk=Tu;var wu=uu();xe.bunyan=wu;var Iu=lu();xe.console=Iu;var xu=pu();xe.mongodbCore=xu;var ku=du();xe.mongodb=ku;var Su=vu();xe.mysql=Su;var Pu=mu();xe.pgPool=Pu;var Au=_u();xe.pg=Au;var Du=Cu();xe.redis=Du;var Ru=Eu();xe.tedious=Ru;var Ou=bu();xe.winston=Ou;function jv(){wu.enable(),Iu.enable(),xu.enable(),ku.enable(),Su.enable(),Au.enable(),Pu.enable(),Du.enable(),Ou.enable(),Tu.enable(),Ru.enable()}xe.enable=jv});var si=d(or=>{"use strict";Object.defineProperty(or,"__esModule",{value:!0});var Uv=$n(),ks=ae();or.IsInitialized=!process.env.APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL;var Ss="DiagnosticChannel";if(or.IsInitialized){$e=qu(),Nu=process.env.APPLICATION_INSIGHTS_NO_PATCH_MODULES||"",ni=Nu.split(","),Ps={bunyan:$e.bunyan,console:$e.console,mongodb:$e.mongodb,mongodbCore:$e.mongodbCore,mysql:$e.mysql,redis:$e.redis,pg:$e.pg,pgPool:$e.pgPool,winston:$e.winston,azuresdk:$e.azuresdk};for(ii in Ps)ni.indexOf(ii)===-1&&(Ps[ii].enable(),ks.info(Ss,"Subscribed to "+ii+" events"));ni.length>0&&ks.info(Ss,"Some modules will not be patched",ni)}else ks.info(Ss,"Not subscribing to dependency autocollection because APPLICATION_INSIGHTS_NO_DIAGNOSTIC_CHANNEL was set");var $e,Nu,ni,Ps,ii;function $v(t){if(!!or.IsInitialized){var e=J();e.channel.addContextPreservation(t),e.channel.spanContextPropagator=Uv.AsyncScopeManager}}or.registerContextPreservation=$v});var ur=d((OE,Lu)=>{"use strict";Lu.exports={requestContextHeader:"request-context",requestContextSourceKey:"appId",requestContextTargetKey:"appId",requestIdHeader:"request-id",parentIdHeader:"x-ms-request-id",rootIdHeader:"x-ms-request-root-id",correlationContextHeader:"correlation-context",traceparentHeader:"traceparent",traceStateHeader:"tracestate"}});var Ae=d((Rs,Fu)=>{"use strict";var As=Rs&&Rs.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},Vv=require("http"),Mu=require("https"),Ds=require("url"),ai=require("constants"),zr=ae(),cr=ur(),Bv=function(){function t(){}return t.getCookie=function(e,r){var n="";if(e&&e.length&&typeof r=="string")for(var i=e+"=",s=r.split(";"),a=0;a<s.length;a++){var r=s[a];if(r=t.trim(r),r&&r.indexOf(i)===0){n=r.substring(i.length,s[a].length);break}}return n},t.trim=function(e){return typeof e=="string"?e.replace(/^\s+|\s+$/g,""):""},t.int32ArrayToBase64=function(e){var r=function(o,u){return String.fromCharCode(o>>u&255)},n=function(o){return r(o,24)+r(o,16)+r(o,8)+r(o,0)},i=e.map(n).join(""),s=Buffer.from?Buffer.from(i,"binary"):new Buffer(i,"binary"),a=s.toString("base64");return a.substr(0,a.indexOf("="))},t.random32=function(){return 4294967296*Math.random()|0},t.randomu32=function(){return t.random32()+2147483648},t.w3cTraceId=function(){for(var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],r="",n,i=0;i<4;i++)n=t.random32(),r+=e[n&15]+e[n>>4&15]+e[n>>8&15]+e[n>>12&15]+e[n>>16&15]+e[n>>20&15]+e[n>>24&15]+e[n>>28&15];var s=e[8+Math.random()*4|0];return r.substr(0,8)+r.substr(9,4)+"4"+r.substr(13,3)+s+r.substr(16,3)+r.substr(19,12)},t.w3cSpanId=function(){return t.w3cTraceId().substring(16)},t.isValidW3CId=function(e){return e.length===32&&e!=="00000000000000000000000000000000"},t.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"},t.isError=function(e){return e instanceof Error},t.isPrimitive=function(e){var r=typeof e;return r==="string"||r==="number"||r==="boolean"},t.isDate=function(e){return Object.prototype.toString.call(e)==="[object Date]"},t.msToTimeSpan=function(e){(isNaN(e)||e<0)&&(e=0);var r=(e/1e3%60).toFixed(7).replace(/0{0,4}$/,""),n=""+Math.floor(e/(1e3*60))%60,i=""+Math.floor(e/(1e3*60*60))%24,s=Math.floor(e/(1e3*60*60*24));r=r.indexOf(".")<2?"0"+r:r,n=n.length<2?"0"+n:n,i=i.length<2?"0"+i:i;var a=s>0?s+".":"";return a+i+":"+n+":"+r},t.extractError=function(e){var r=e;return{message:e.message,code:r.code||r.id||""}},t.extractObject=function(e){return e instanceof Error?t.extractError(e):typeof e.toJSON=="function"?e.toJSON():e},t.validateStringMap=function(e){if(typeof e!="object"){zr.info("Invalid properties dropped from payload");return}var r={};for(var n in e){var i="",s=e[n],a=typeof s;if(t.isPrimitive(s))i=s.toString();else if(s===null||a==="undefined")i="";else if(a==="function"){zr.info("key: "+n+" was function; will not serialize");continue}else{var o=t.isArray(s)?s:t.extractObject(s);try{t.isPrimitive(o)?i=o:i=JSON.stringify(o)}catch(u){i=s.constructor.name.toString()+" (Error: "+u.message+")",zr.info("key: "+n+", could not be serialized")}}r[n]=i.substring(0,t.MAX_PROPERTY_LENGTH)}return r},t.canIncludeCorrelationHeader=function(e,r){var n=e&&e.config&&e.config.correlationHeaderExcludedDomains;if(!n||n.length==0||!r)return!0;for(var i=0;i<n.length;i++){var s=new RegExp(n[i].replace(/\./g,".").replace(/\*/g,".*"));if(s.test(Ds.parse(r).hostname))return!1}return!0},t.getCorrelationContextTarget=function(e,r){var n=e.headers&&e.headers[cr.requestContextHeader];if(n)for(var i=n.split(","),s=0;s<i.length;++s){var a=i[s].split("=");if(a.length==2&&a[0]==r)return a[1]}},t.makeRequest=function(e,r,n,i){r&&r.indexOf("//")===0&&(r="https:"+r);var s=Ds.parse(r),a=As({},n,{host:s.hostname,port:s.port,path:s.pathname}),o=void 0;if(s.protocol==="https:"&&(o=e.proxyHttpsUrl||void 0),s.protocol==="http:"&&(o=e.proxyHttpUrl||void 0),o){o.indexOf("//")===0&&(o="http:"+o);var u=Ds.parse(o);u.protocol==="https:"?(zr.info("Proxies that use HTTPS are not supported"),o=void 0):a=As({},a,{host:u.hostname,port:u.port||"80",path:r,headers:As({},a.headers,{Host:s.hostname})})}var c=s.protocol==="https:"&&!o;return c&&e.httpsAgent!==void 0?a.agent=e.httpsAgent:!c&&e.httpAgent!==void 0?a.agent=e.httpAgent:c&&(a.agent=t.tlsRestrictedAgent),c?Mu.request(a,i):Vv.request(a,i)},t.safeIncludeCorrelationHeader=function(e,r,n){var i;if(typeof n=="string")i=n;else if(n instanceof Array)i=n.join(",");else if(n&&typeof n.toString=="function")try{i=n.toString()}catch(s){zr.warn("Outgoing request-context header could not be read. Correlation of requests may be lost.",s,n)}i?t.addCorrelationIdHeaderFromString(e,r,i):r.setHeader(cr.requestContextHeader,cr.requestContextSourceKey+"="+e.config.correlationId)},t.addCorrelationIdHeaderFromString=function(e,r,n){var i=n.split(","),s=cr.requestContextSourceKey+"=",a=i.some(function(o){return o.substring(0,s.length)===s});a||r.setHeader(cr.requestContextHeader,n+","+cr.requestContextSourceKey+"="+e.config.correlationId)},t.MAX_PROPERTY_LENGTH=8192,t.tlsRestrictedAgent=new Mu.Agent({secureOptions:ai.SSL_OP_NO_SSLv2|ai.SSL_OP_NO_SSLv3|ai.SSL_OP_NO_TLSv1|ai.SSL_OP_NO_TLSv1_1}),t}();Fu.exports=Bv});var At=d((qE,Hu)=>{"use strict";var oi=Ae(),Os=ae(),Gv=function(){function t(){}return t.queryCorrelationId=function(e,r){var n=e.profileQueryEndpoint+"/api/profiles/"+e.instrumentationKey+"/appId";if(t.completedLookups.hasOwnProperty(n)){r(t.completedLookups[n]);return}else if(t.pendingLookups[n]){t.pendingLookups[n].push(r);return}t.pendingLookups[n]=[r];var i=function(){if(!!t.pendingLookups[n]){var s={method:"GET",disableAppInsightsAutoCollection:!0};Os.info(t.TAG,s);var a=oi.makeRequest(e,n,s,function(o){if(o.statusCode===200){var u="";o.setEncoding("utf-8"),o.on("data",function(c){u+=c}),o.on("end",function(){Os.info(t.TAG,u);var c=t.correlationIdPrefix+u;t.completedLookups[n]=c,t.pendingLookups[n]&&t.pendingLookups[n].forEach(function(l){return l(c)}),delete t.pendingLookups[n]})}else o.statusCode>=400&&o.statusCode<500?(t.completedLookups[n]=void 0,delete t.pendingLookups[n]):setTimeout(i,e.correlationIdRetryIntervalMs)});a&&(a.on("error",function(o){Os.warn(t.TAG,o)}),a.end())}};setTimeout(i,0)},t.cancelCorrelationIdQuery=function(e,r){var n=e.profileQueryEndpoint+"/api/profiles/"+e.instrumentationKey+"/appId",i=t.pendingLookups[n];i&&(t.pendingLookups[n]=i.filter(function(s){return s!=r}),t.pendingLookups[n].length==0&&delete t.pendingLookups[n])},t.generateRequestId=function(e){if(e){e=e[0]=="|"?e:"|"+e,e[e.length-1]!=="."&&(e+=".");var r=(t.currentRootId++).toString(16);return t.appendSuffix(e,r,"_")}else return t.generateRootId()},t.getRootId=function(e){var r=e.indexOf(".");r<0&&(r=e.length);var n=e[0]==="|"?1:0;return e.substring(n,r)},t.generateRootId=function(){return"|"+oi.w3cTraceId()+"."},t.appendSuffix=function(e,r,n){if(e.length+r.length<t.requestIdMaxLength)return e+r+n;var i=t.requestIdMaxLength-9;if(e.length>i)for(;i>1;--i){var s=e[i-1];if(s==="."||s==="_")break}if(i<=1)return t.generateRootId();for(r=oi.randomu32().toString(16);r.length<8;)r="0"+r;return e.substring(0,i)+r+"#"},t.TAG="CorrelationIdManager",t.correlationIdPrefix="cid-v1:",t.w3cEnabled=!0,t.pendingLookups={},t.completedLookups={},t.requestIdMaxLength=1024,t.currentRootId=oi.randomu32(),t}();Hu.exports=Gv});var Qr=d((NE,ju)=>{"use strict";var fe=Ae(),zv=At(),Qv=function(){function t(e,r){if(this.traceFlag=t.DEFAULT_TRACE_FLAG,this.version=t.DEFAULT_VERSION,e&&typeof e=="string")if(e.split(",").length>1)this.traceId=fe.w3cTraceId(),this.spanId=fe.w3cTraceId().substr(0,16);else{var n=e.trim().split("-"),i=n.length;i>=4?(this.version=n[0],this.traceId=n[1],this.spanId=n[2],this.traceFlag=n[3]):(this.traceId=fe.w3cTraceId(),this.spanId=fe.w3cTraceId().substr(0,16)),this.version.match(/^[0-9a-f]{2}$/g)||(this.version=t.DEFAULT_VERSION,this.traceId=fe.w3cTraceId()),this.version==="00"&&i!==4&&(this.traceId=fe.w3cTraceId(),this.spanId=fe.w3cTraceId().substr(0,16)),this.version==="ff"&&(this.version=t.DEFAULT_VERSION,this.traceId=fe.w3cTraceId(),this.spanId=fe.w3cTraceId().substr(0,16)),this.version.match(/^0[0-9a-f]$/g)||(this.version=t.DEFAULT_VERSION),this.traceFlag.match(/^[0-9a-f]{2}$/g)||(this.traceFlag=t.DEFAULT_TRACE_FLAG,this.traceId=fe.w3cTraceId()),t.isValidTraceId(this.traceId)||(this.traceId=fe.w3cTraceId()),t.isValidSpanId(this.spanId)||(this.spanId=fe.w3cTraceId().substr(0,16),this.traceId=fe.w3cTraceId()),this.parentId=this.getBackCompatRequestId()}else if(r){this.parentId=r.slice();var s=zv.getRootId(r);t.isValidTraceId(s)||(this.legacyRootId=s,s=fe.w3cTraceId()),r.indexOf("|")!==-1&&(r=r.substring(1+r.substring(0,r.length-1).lastIndexOf("."),r.length-1)),this.traceId=s,this.spanId=r}else this.traceId=fe.w3cTraceId(),this.spanId=fe.w3cTraceId().substr(0,16)}return t.isValidTraceId=function(e){return e.match(/^[0-9a-f]{32}$/)&&e!=="00000000000000000000000000000000"},t.isValidSpanId=function(e){return e.match(/^[0-9a-f]{16}$/)&&e!=="0000000000000000"},t.prototype.getBackCompatRequestId=function(){return"|"+this.traceId+"."+this.spanId+"."},t.prototype.toString=function(){return this.version+"-"+this.traceId+"-"+this.spanId+"-"+this.traceFlag},t.prototype.updateSpanId=function(){this.spanId=fe.w3cTraceId().substr(0,16)},t.DEFAULT_TRACE_FLAG="01",t.DEFAULT_VERSION="00",t}();ju.exports=Qv});var qs=d((LE,Uu)=>{"use strict";var Wv=function(){function t(e){this.fieldmap=[],e&&(this.fieldmap=this.parseHeader(e))}return t.prototype.toString=function(){var e=this.fieldmap;return!e||e.length==0?null:e.join(", ")},t.validateKeyChars=function(e){var r=e.split("@");if(r.length==2){var n=r[0].trim(),i=r[1].trim(),s=Boolean(n.match(/^[\ ]?[a-z0-9\*\-\_/]{1,241}$/)),a=Boolean(i.match(/^[\ ]?[a-z0-9\*\-\_/]{1,14}$/));return s&&a}else if(r.length==1)return Boolean(e.match(/^[\ ]?[a-z0-9\*\-\_/]{1,256}$/));return!1},t.prototype.parseHeader=function(e){var r=[],n={},i=e.split(",");if(i.length>32)return null;for(var s=0,a=i;s<a.length;s++){var o=a[s],u=o.trim();if(u.length!==0){var c=u.split("=");if(c.length!==2||!t.validateKeyChars(c[0])||n[c[0]])return null;n[c[0]]=!0,r.push(u)}}return r},t.strict=!0,t}();Uu.exports=Wv});var nt=d((ME,$u)=>{"use strict";var Kv=function(){function t(){}return t}();$u.exports=Kv});var Bu=d((Ns,Vu)=>{"use strict";var Xv=Ns&&Ns.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Yv=nt(),Jv=function(t){Xv(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(Yv);Vu.exports=Jv});var Ls=d((FE,Gu)=>{"use strict";var Zv=function(){function t(){}return t}();Gu.exports=Zv});var Qu=d((HE,zu)=>{"use strict";var eg=function(){function t(){this.applicationVersion="ai.application.ver",this.deviceId="ai.device.id",this.deviceLocale="ai.device.locale",this.deviceModel="ai.device.model",this.deviceOEMName="ai.device.oemName",this.deviceOSVersion="ai.device.osVersion",this.deviceType="ai.device.type",this.locationIp="ai.location.ip",this.operationId="ai.operation.id",this.operationName="ai.operation.name",this.operationParentId="ai.operation.parentId",this.operationSyntheticSource="ai.operation.syntheticSource",this.operationCorrelationVector="ai.operation.correlationVector",this.sessionId="ai.session.id",this.sessionIsFirst="ai.session.isFirst",this.userAccountId="ai.user.accountId",this.userId="ai.user.id",this.userAuthUserId="ai.user.authUserId",this.cloudRole="ai.cloud.role",this.cloudRoleInstance="ai.cloud.roleInstance",this.internalSdkVersion="ai.internal.sdkVersion",this.internalAgentVersion="ai.internal.agentVersion",this.internalNodeName="ai.internal.nodeName"}return t}();zu.exports=eg});var Ku=d((Ms,Wu)=>{"use strict";var tg=Ms&&Ms.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),rg=Ls(),ng=function(t){tg(e,t);function e(){return t.call(this)||this}return e}(rg);Wu.exports=ng});var Hs=d((jE,Xu)=>{"use strict";var Fs;(function(t){t[t.Measurement=0]="Measurement",t[t.Aggregation=1]="Aggregation"})(Fs||(Fs={}));Xu.exports=Fs});var Ju=d((UE,Yu)=>{"use strict";var ig=Hs(),sg=function(){function t(){this.kind=ig.Measurement}return t}();Yu.exports=sg});var ec=d(($E,Zu)=>{"use strict";var ag=function(){function t(){this.ver=1,this.sampleRate=100,this.tags={}}return t}();Zu.exports=ag});var Us=d((js,tc)=>{"use strict";var og=js&&js.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),ug=nt(),cg=function(t){og(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(ug);tc.exports=cg});var nc=d(($s,rc)=>{"use strict";var lg=$s&&$s.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),pg=nt(),fg=function(t){lg(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.exceptions=[],r.properties={},r.measurements={},r}return e}(pg);rc.exports=fg});var sc=d((VE,ic)=>{"use strict";var dg=function(){function t(){this.hasFullStack=!0,this.parsedStack=[]}return t}();ic.exports=dg});var oc=d((Vs,ac)=>{"use strict";var hg=Vs&&Vs.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),vg=nt(),gg=function(t){hg(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r}return e}(vg);ac.exports=gg});var cc=d((Bs,uc)=>{"use strict";var mg=Bs&&Bs.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),yg=nt(),_g=function(t){mg(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.metrics=[],r.properties={},r}return e}(yg);uc.exports=_g});var pc=d((Gs,lc)=>{"use strict";var Cg=Gs&&Gs.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Eg=Us(),bg=function(t){Cg(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(Eg);lc.exports=bg});var dc=d((zs,fc)=>{"use strict";var Tg=zs&&zs.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),wg=nt(),Ig=function(t){Tg(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.success=!0,r.properties={},r.measurements={},r}return e}(wg);fc.exports=Ig});var vc=d((Qs,hc)=>{"use strict";var xg=Qs&&Qs.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),kg=nt(),Sg=function(t){xg(e,t);function e(){var r=t.call(this)||this;return r.ver=2,r.properties={},r.measurements={},r}return e}(kg);hc.exports=Sg});var Ks=d((BE,gc)=>{"use strict";var Ws;(function(t){t[t.Verbose=0]="Verbose",t[t.Information=1]="Information",t[t.Warning=2]="Warning",t[t.Error=3]="Error",t[t.Critical=4]="Critical"})(Ws||(Ws={}));gc.exports=Ws});var yc=d((GE,mc)=>{"use strict";var Pg=function(){function t(){}return t}();mc.exports=Pg});var Xs=d(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.AvailabilityData=Bu();te.Base=Ls();te.ContextTagKeys=Qu();te.Data=Ku();te.DataPoint=Ju();te.DataPointType=Hs();te.Domain=nt();te.Envelope=ec();te.EventData=Us();te.ExceptionData=nc();te.ExceptionDetails=sc();te.MessageData=oc();te.MetricData=cc();te.PageViewData=pc();te.RemoteDependencyData=dc();te.RequestData=vc();te.SeverityLevel=Ks();te.StackFrame=yc()});var _c=d(ui=>{"use strict";Object.defineProperty(ui,"__esModule",{value:!0});var Dt=Xs(),Ag=function(){function t(){}return t.TYPE_HTTP="Http",t.TYPE_AI="Http (tracked component)",t}();ui.RemoteDependencyDataConstants=Ag;function Dg(t){return"properties"in t||t instanceof Dt.EventData||t instanceof Dt.ExceptionData||t instanceof Dt.MessageData||t instanceof Dt.MetricData||t instanceof Dt.PageViewData||t instanceof Dt.RemoteDependencyData||t instanceof Dt.RequestData}ui.domainSupportsProperties=Dg});var Cc=d(Rt=>{"use strict";Object.defineProperty(Rt,"__esModule",{value:!0});function Rg(t){switch(t){case de.Event:return"EventData";case de.Exception:return"ExceptionData";case de.Trace:return"MessageData";case de.Metric:return"MetricData";case de.Request:return"RequestData";case de.Dependency:return"RemoteDependencyData";case de.Availability:return"AvailabilityData";case de.PageView:return"PageViewData"}}Rt.telemetryTypeToBaseType=Rg;function Og(t){switch(t){case"EventData":return de.Event;case"ExceptionData":return de.Exception;case"MessageData":return de.Trace;case"MetricData":return de.Metric;case"RequestData":return de.Request;case"RemoteDependencyData":return de.Dependency;case"AvailabilityData":return de.Availability;case"PageViewData":return de.PageView}}Rt.baseTypeToTelemetryType=Og;Rt.TelemetryTypeString={Event:"EventData",Exception:"ExceptionData",Trace:"MessageData",Metric:"MetricData",Request:"RequestData",Dependency:"RemoteDependencyData",Availability:"AvailabilityData",PageView:"PageViewData"};var de;(function(t){t[t.Event=0]="Event",t[t.Exception=1]="Exception",t[t.Trace=2]="Trace",t[t.Metric=3]="Metric",t[t.Request=4]="Request",t[t.Dependency=5]="Dependency",t[t.Availability=6]="Availability",t[t.PageView=7]="PageView"})(de=Rt.TelemetryType||(Rt.TelemetryType={}))});var Ec=d(ci=>{"use strict";function qg(t){for(var e in t)ci.hasOwnProperty(e)||(ci[e]=t[e])}Object.defineProperty(ci,"__esModule",{value:!0});qg(Cc())});var De=d(li=>{"use strict";function Ys(t){for(var e in t)li.hasOwnProperty(e)||(li[e]=t[e])}Object.defineProperty(li,"__esModule",{value:!0});Ys(_c());Ys(Xs());Ys(Ec())});var Js=d((YE,bc)=>{"use strict";var Ng=function(){function t(){}return t.prototype.getUrl=function(){return this.url},t.prototype.RequestParser=function(){this.startTime=+new Date},t.prototype._setStatus=function(e,r){var n=+new Date;this.duration=n-this.startTime,this.statusCode=e;var i=this.properties||{};if(r){if(typeof r=="string")i.error=r;else if(r instanceof Error)i.error=r.message;else if(typeof r=="object")for(var s in r)i[s]=r[s]&&r[s].toString&&r[s].toString()}this.properties=i},t.prototype._isSuccess=function(){return 0<this.statusCode&&this.statusCode<400},t}();bc.exports=Ng});var ta=d((ea,wc)=>{"use strict";var Lg=ea&&ea.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),pi=require("url"),Mg=De(),Tc=Ae(),Ot=ur(),Fg=Js(),vt=At(),Hg=qs(),Zs=Qr(),jg=function(t){Lg(e,t);function e(r,n){var i=t.call(this)||this;return r&&(i.method=r.method,i.url=i._getAbsoluteUrl(r),i.startTime=+new Date,i.socketRemoteAddress=r.socket&&r.socket.remoteAddress,i.parseHeaders(r,n),r.connection&&(i.connectionRemoteAddress=r.connection.remoteAddress,i.legacySocketRemoteAddress=r.connection.socket&&r.connection.socket.remoteAddress)),i}return e.prototype.onError=function(r,n){this._setStatus(void 0,r),n&&(this.duration=n)},e.prototype.onResponse=function(r,n){this._setStatus(r.statusCode,void 0),n&&(this.duration=n)},e.prototype.getRequestTelemetry=function(r){var n={id:this.requestId,name:this.method+" "+pi.parse(this.url).pathname,url:this.url,source:this.sourceCorrelationId,duration:this.duration,resultCode:this.statusCode?this.statusCode.toString():null,success:this._isSuccess(),properties:this.properties};if(r&&r.time?n.time=r.time:this.startTime&&(n.time=new Date(this.startTime)),r){for(var i in r)n[i]||(n[i]=r[i]);if(r.properties)for(var i in r.properties)n.properties[i]=r.properties[i]}return n},e.prototype.getRequestTags=function(r){var n={};for(var i in r)n[i]=r[i];return n[e.keys.locationIp]=r[e.keys.locationIp]||this._getIp(),n[e.keys.sessionId]=r[e.keys.sessionId]||this._getId("ai_session"),n[e.keys.userId]=r[e.keys.userId]||this._getId("ai_user"),n[e.keys.userAuthUserId]=r[e.keys.userAuthUserId]||this._getId("ai_authUser"),n[e.keys.operationName]=this.getOperationName(r),n[e.keys.operationParentId]=this.getOperationParentId(r),n[e.keys.operationId]=this.getOperationId(r),n},e.prototype.getOperationId=function(r){return r[e.keys.operationId]||this.operationId},e.prototype.getOperationParentId=function(r){return r[e.keys.operationParentId]||this.parentId||this.getOperationId(r)},e.prototype.getOperationName=function(r){return r[e.keys.operationName]||this.method+" "+pi.parse(this.url).pathname},e.prototype.getRequestId=function(){return this.requestId},e.prototype.getCorrelationContextHeader=function(){return this.correlationContextHeader},e.prototype.getTraceparent=function(){return this.traceparent},e.prototype.getTracestate=function(){return this.tracestate},e.prototype.getLegacyRootId=function(){return this.legacyRootId},e.prototype._getAbsoluteUrl=function(r){if(!r.headers)return r.url;var n=r.connection?r.connection.encrypted:null,i=pi.parse(r.url),s=i.pathname,a=i.search,o=pi.format({protocol:n?"https":"http",host:r.headers.host,pathname:s,search:a});return o},e.prototype._getIp=function(){var r=/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/,n=function(s){var a=r.exec(s);if(a)return a[0]},i=n(this.rawHeaders["x-forwarded-for"])||n(this.rawHeaders["x-client-ip"])||n(this.rawHeaders["x-real-ip"])||n(this.connectionRemoteAddress)||n(this.socketRemoteAddress)||n(this.legacySocketRemoteAddress);return!i&&this.connectionRemoteAddress&&this.connectionRemoteAddress.substr&&this.connectionRemoteAddress.substr(0,2)==="::"&&(i="127.0.0.1"),i},e.prototype._getId=function(r){var n=this.rawHeaders&&this.rawHeaders.cookie&&typeof this.rawHeaders.cookie=="string"&&this.rawHeaders.cookie||"",i=e.parseId(Tc.getCookie(r,n));return i},e.prototype.setBackCompatFromThisTraceContext=function(){this.operationId=this.traceparent.traceId,this.traceparent.legacyRootId&&(this.legacyRootId=this.traceparent.legacyRootId),this.parentId=this.traceparent.parentId,this.traceparent.updateSpanId(),this.requestId=this.traceparent.getBackCompatRequestId()},e.prototype.parseHeaders=function(r,n){if(this.rawHeaders=r.headers||r.rawHeaders,this.userAgent=r.headers&&r.headers["user-agent"],this.sourceCorrelationId=Tc.getCorrelationContextTarget(r,Ot.requestContextSourceKey),r.headers){var i=r.headers[Ot.traceStateHeader],s=r.headers[Ot.traceparentHeader],a=r.headers[Ot.requestIdHeader],o=r.headers[Ot.parentIdHeader],u=r.headers[Ot.rootIdHeader];this.correlationContextHeader=r.headers[Ot.correlationContextHeader],vt.w3cEnabled&&(s||i)?(this.traceparent=new Zs(s),this.tracestate=s&&i&&new Hg(i),this.setBackCompatFromThisTraceContext()):a?vt.w3cEnabled?(this.traceparent=new Zs(null,a),this.setBackCompatFromThisTraceContext()):(this.parentId=a,this.requestId=vt.generateRequestId(this.parentId),this.operationId=vt.getRootId(this.requestId)):vt.w3cEnabled?(this.traceparent=new Zs,this.traceparent.parentId=o,this.traceparent.legacyRootId=u||o,this.setBackCompatFromThisTraceContext()):(this.parentId=o,this.requestId=vt.generateRequestId(u||this.parentId),this.correlationContextHeader=null,this.operationId=vt.getRootId(this.requestId)),n&&(this.requestId=n,this.operationId=vt.getRootId(this.requestId))}},e.parseId=function(r){var n=r.split("|");return n.length>0?n[0]:""},e.keys=new Mg.ContextTagKeys,e}(Fg);wc.exports=jg});var fi=d((JE,kc)=>{"use strict";function ra(t){return typeof t=="function"}var be=console.error.bind(console);function Wr(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function Kr(t){t&&t.logger&&(ra(t.logger)?be=t.logger:be("new logger isn't a function, not replacing"))}function Ic(t,e,r){if(!t||!t[e]){be("no original function "+e+" to wrap");return}if(!r){be("no wrapper function"),be(new Error().stack);return}if(!ra(t[e])||!ra(r)){be("original object and wrapper must be functions");return}var n=t[e],i=r(n,e);return Wr(i,"__original",n),Wr(i,"__unwrap",function(){t[e]===i&&Wr(t,e,n)}),Wr(i,"__wrapped",!0),Wr(t,e,i),i}function Ug(t,e,r){if(t)Array.isArray(t)||(t=[t]);else{be("must provide one or more modules to patch"),be(new Error().stack);return}if(!(e&&Array.isArray(e))){be("must provide one or more functions to wrap on modules");return}t.forEach(function(n){e.forEach(function(i){Ic(n,i,r)})})}function xc(t,e){if(!t||!t[e]){be("no function to unwrap."),be(new Error().stack);return}if(!t[e].__unwrap)be("no original to unwrap to -- has "+e+" already been unwrapped?");else return t[e].__unwrap()}function $g(t,e){if(t)Array.isArray(t)||(t=[t]);else{be("must provide one or more modules to patch"),be(new Error().stack);return}if(!(e&&Array.isArray(e))){be("must provide one or more functions to unwrap on modules");return}t.forEach(function(r){e.forEach(function(n){xc(r,n)})})}Kr.wrap=Ic;Kr.massWrap=Ug;Kr.unwrap=xc;Kr.massUnwrap=$g;kc.exports=Kr});var vi=d((ZE,Dc)=>{"use strict";var Pc=fi(),lr=Pc.wrap,di=Pc.unwrap,it="wrap@before";function hi(t,e,r){var n=!!t[e]&&t.propertyIsEnumerable(e);Object.defineProperty(t,e,{configurable:!0,enumerable:n,writable:!0,value:r})}function Vg(t,e){for(var r=e.length,n=0;n<r;n++){var i=e[n],s=t[it];if(typeof s=="function")s(i);else if(Array.isArray(s))for(var a=s.length,o=0;o<a;o++)s[o](i)}}function Ac(t,e){var r;return r=t._events&&t._events[e],Array.isArray(r)||(r?r=[r]:r=[]),r}function Bg(t,e,r){var n=Ac(t,e),i=n.filter(function(s){return r.indexOf(s)===-1});i.length>0&&Vg(t,i)}function Sc(t,e){if(!!t){var r=t;if(typeof t=="function")r=e(t);else if(Array.isArray(t)){r=[];for(var n=0;n<t.length;n++)r[n]=e(t[n])}return r}}Dc.exports=function(e,r,n){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!r)throw new Error("must have function to run on listener addition");if(!n)throw new Error("must have function to wrap listeners when emitting");function i(a){return function(u,c){var l=Ac(this,u).slice();try{var p=a.call(this,u,c);return Bg(this,u,l),p}finally{this.on.__wrapped||lr(this,"on",i),this.addListener.__wrapped||lr(this,"addListener",i)}}}function s(a){return function(u){if(!this._events||!this._events[u])return a.apply(this,arguments);var c=this._events[u];function l(p){return function(){this._events[u]=c;try{return p.apply(this,arguments)}finally{c=this._events[u],this._events[u]=Sc(c,n)}}}lr(this,"removeListener",l);try{return this._events[u]=Sc(c,n),a.apply(this,arguments)}finally{di(this,"removeListener"),this._events[u]=c}}}e[it]?typeof e[it]=="function"?hi(e,it,[e[it],r]):Array.isArray(e[it])&&e[it].push(r):hi(e,it,r),e.__wrapped||(lr(e,"addListener",i),lr(e,"on",i),lr(e,"emit",s),hi(e,"__unwrap",function(){di(e,"addListener"),di(e,"on"),di(e,"emit"),delete e[it],delete e.__wrapped}),hi(e,"__wrapped",!0))}});var Nc=d((e0,qc)=>{"use strict";var M=require("util"),st=require("assert"),Gg=vi(),G=require("async_hooks"),Xr="cls@contexts",Yr="error@context",K=process.env.DEBUG_CLS_HOOKED,L=-1;qc.exports={getNamespace:Rc,createNamespace:zg,destroyNamespace:Oc,reset:Qg,ERROR_SYMBOL:Yr};function qe(t){this.name=t,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}qe.prototype.set=function(e,r){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=r,K){let n=" ".repeat(this._indent<0?0:this._indent);z(n+"CONTEXT-SET KEY:"+e+"="+r+" in ns:"+this.name+" currentUid:"+L+" active:"+M.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return r};qe.prototype.get=function(e){if(!this.active){if(K){let r=G.currentId(),n=G.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);z(`${i}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${L} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length}`)}return}if(K){let r=G.executionAsyncId(),n=G.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);z(i+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+L+" active:"+M.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),z(`${i}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${L} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} active:${M.inspect(this.active)}`)}return this.active[e]};qe.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=L,K){let r=G.executionAsyncId(),n=G.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);z(`${i}CONTEXT-CREATED Context: (${this.name}) currentUid:${L} asyncHooksCurrentId:${r} triggerId:${n} len:${this._set.length} context:${M.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};qe.prototype.run=function(e){let r=this.createContext();this.enter(r);try{if(K){let n=G.triggerAsyncId(),i=G.executionAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);z(`${s}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${L} triggerId:${n} asyncHooksCurrentId:${i} len:${this._set.length} context:${M.inspect(r)}`)}return e(r),r}catch(n){throw n&&(n[Yr]=r),n}finally{if(K){let n=G.triggerAsyncId(),i=G.executionAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);z(`${s}CONTEXT-RUN END: (${this.name}) currentUid:${L} triggerId:${n} asyncHooksCurrentId:${i} len:${this._set.length} ${M.inspect(r)}`)}this.exit(r)}};qe.prototype.runAndReturn=function(e){let r;return this.run(function(n){r=e(n)}),r};qe.prototype.runPromise=function(e){let r=this.createContext();this.enter(r);let n=e(r);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return K&&z("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+L+" len:"+this._set.length+" "+M.inspect(r)),n.then(i=>(K&&z("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+L+" len:"+this._set.length+" "+M.inspect(r)),this.exit(r),i)).catch(i=>{throw i[Yr]=r,K&&z("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+L+" len:"+this._set.length+" "+M.inspect(r)),this.exit(r),i})};qe.prototype.bind=function(e,r){r||(this.active?r=this.active:r=this.createContext());let n=this;return function(){n.enter(r);try{return e.apply(this,arguments)}catch(s){throw s&&(s[Yr]=r),s}finally{n.exit(r)}}};qe.prototype.enter=function(e){if(st.ok(e,"context must be provided for entering"),K){let r=G.executionAsyncId(),n=G.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);z(`${i}CONTEXT-ENTER: (${this.name}) currentUid:${L} triggerId:${n} asyncHooksCurrentId:${r} len:${this._set.length} ${M.inspect(e)}`)}this._set.push(this.active),this.active=e};qe.prototype.exit=function(e){if(st.ok(e,"context must be provided for exiting"),K){let n=G.executionAsyncId(),i=G.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);z(`${s}CONTEXT-EXIT: (${this.name}) currentUid:${L} triggerId:${i} asyncHooksCurrentId:${n} len:${this._set.length} ${M.inspect(e)}`)}if(this.active===e){st.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let r=this._set.lastIndexOf(e);r<0?(K&&z("??ERROR?? context exiting but not entered - ignoring: "+M.inspect(e)),st.ok(r>=0,`context not currently entered; can't exit. 
`+M.inspect(this)+`
`+M.inspect(e))):(st.ok(r,"can't remove top context"),this._set.splice(r,1))};qe.prototype.bindEmitter=function(e){st.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let r=this,n="context@"+this.name;function i(a){!a||(a[Xr]||(a[Xr]=Object.create(null)),a[Xr][n]={namespace:r,context:r.active})}function s(a){if(!(a&&a[Xr]))return a;let o=a,u=a[Xr];return Object.keys(u).forEach(function(c){let l=u[c];o=l.namespace.bind(o,l.context)}),o}Gg(e,i,s)};qe.prototype.fromException=function(e){return e[Yr]};function Rc(t){return process.namespaces[t]}function zg(t){st.ok(t,"namespace must be given a name."),K&&z(`NS-CREATING NAMESPACE (${t})`);let e=new qe(t);return e.id=L,G.createHook({init(n,i,s,a){if(L=G.executionAsyncId(),e.active){if(e._contexts.set(n,e.active),K){let o=" ".repeat(e._indent<0?0:e._indent);z(`${o}INIT [${i}] (${t}) asyncId:${n} currentUid:${L} triggerId:${s} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(L===0){let o=G.triggerAsyncId(),u=e._contexts.get(o);if(u){if(e._contexts.set(n,u),K){let c=" ".repeat(e._indent<0?0:e._indent);z(`${c}INIT USING CONTEXT FROM TRIGGERID [${i}] (${t}) asyncId:${n} currentUid:${L} triggerId:${o} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(K){let c=" ".repeat(e._indent<0?0:e._indent);z(`${c}INIT MISSING CONTEXT [${i}] (${t}) asyncId:${n} currentUid:${L} triggerId:${o} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}if(K&&i==="PROMISE"){z(M.inspect(a,{showHidden:!0}));let o=a.parentId,u=" ".repeat(e._indent<0?0:e._indent);z(`${u}INIT RESOURCE-PROMISE [${i}] (${t}) parentId:${o} asyncId:${n} currentUid:${L} triggerId:${s} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}},before(n){L=G.executionAsyncId();let i;if(i=e._contexts.get(n)||e._contexts.get(L),i){if(K){let s=G.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);z(`${a}BEFORE (${t}) asyncId:${n} currentUid:${L} triggerId:${s} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${M.inspect(i)}`),e._indent+=2}e.enter(i)}else if(K){let s=G.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);z(`${a}BEFORE MISSING CONTEXT (${t}) asyncId:${n} currentUid:${L} triggerId:${s} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${M.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(n){L=G.executionAsyncId();let i;if(i=e._contexts.get(n)||e._contexts.get(L),i){if(K){let s=G.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);z(`${a}AFTER (${t}) asyncId:${n} currentUid:${L} triggerId:${s} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${M.inspect(i)}`)}e.exit(i)}else if(K){let s=G.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);z(`${a}AFTER MISSING CONTEXT (${t}) asyncId:${n} currentUid:${L} triggerId:${s} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${M.inspect(i)}`)}},destroy(n){if(L=G.executionAsyncId(),K){let i=G.triggerAsyncId(),s=" ".repeat(e._indent<0?0:e._indent);z(`${s}DESTROY (${t}) currentUid:${L} asyncId:${n} triggerId:${i} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${M.inspect(e._contexts.get(L))}`)}e._contexts.delete(n)}}).enable(),process.namespaces[t]=e,e}function Oc(t){let e=Rc(t);st.ok(e,`can't delete nonexistent namespace! "`+t+'"'),st.ok(e.id,"don't assign to process.namespaces directly! "+M.inspect(e)),process.namespaces[t]=null}function Qg(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){Oc(t)}),process.namespaces=Object.create(null)}process.namespaces={};function z(...t){K&&process._rawDebug(`${M.format(...t)}`)}});var Mc=d((t0,Lc)=>{"use strict";function Wg(){}Lc.exports=function(){let e=this._hooks,r=this._state,n=process.nextTick;process.nextTick=function(){if(!r.enabled)return n.apply(process,arguments);let i=new Array(arguments.length);for(let u=0;u<arguments.length;u++)i[u]=arguments[u];let s=i[0];if(typeof s!="function")throw new TypeError("callback is not a function");let a=new Wg,o=--r.counter;return e.init.call(a,o,0,null,null),i[0]=function(){e.pre.call(a,o);let u=!0;try{s.apply(this,arguments),u=!1}finally{u&&process.listenerCount("uncaughtException")>0&&process.once("uncaughtException",function(){e.post.call(a,o,!0),e.destroy.call(null,o)})}e.post.call(a,o,!1),e.destroy.call(null,o)},n.apply(process,i)}}});var Hc=d((r0,Fc)=>{"use strict";function Kg(){}Fc.exports=function(){let e=this._hooks,r=this._state,n=global.Promise,i=n.prototype.then;n.prototype.then=u;function s(c,l,p,f){return typeof c!="function"?f?a(p):o(p):function(){e.pre.call(l,p);try{return c.apply(this,arguments)}finally{e.post.call(l,p,!1),e.destroy.call(null,p)}}}function a(c){return function(p){return e.destroy.call(null,c),p}}function o(c){return function(p){throw e.destroy.call(null,c),p}}function u(c,l){if(!r.enabled)return i.call(this,c,l);let p=new Kg,f=--r.counter;return e.init.call(p,f,0,null,null),i.call(this,s(c,p,f,!0),s(l,p,f,!1))}}});var Uc=d((n0,jc)=>{"use strict";var Re=require("timers");function Xg(){}function Yg(){}function Jg(){}var Zg=new Map,em=new Map,tm=new Map,na=null,ia=!1;jc.exports=function(){sa(this._hooks,this._state,"setTimeout","clearTimeout",Xg,Zg,!0),sa(this._hooks,this._state,"setInterval","clearInterval",Yg,em,!1),sa(this._hooks,this._state,"setImmediate","clearImmediate",Jg,tm,!0),global.setTimeout=Re.setTimeout,global.setInterval=Re.setInterval,global.setImmediate=Re.setImmediate,global.clearTimeout=Re.clearTimeout,global.clearInterval=Re.clearInterval,global.clearImmediate=Re.clearImmediate};function sa(t,e,r,n,i,s,a){let o=Re[r],u=Re[n];Re[r]=function(){if(!e.enabled)return o.apply(Re,arguments);let c=new Array(arguments.length);for(let m=0;m<arguments.length;m++)c[m]=arguments[m];let l=c[0];if(typeof l!="function")throw new TypeError('"callback" argument must be a function');let p=new i,f=--e.counter,h;return t.init.call(p,f,0,null,null),c[0]=function(){na=h,t.pre.call(p,f);let m=!0;try{l.apply(this,arguments),m=!1}finally{m&&process.listenerCount("uncaughtException")>0&&process.once("uncaughtException",function(){t.post.call(p,f,!0),s.delete(h),t.destroy.call(null,f)})}t.post.call(p,f,!1),na=null,(a||ia)&&(ia=!1,s.delete(h),t.destroy.call(null,f))},h=o.apply(Re,c),s.set(h,f),h},Re[n]=function(c){if(na===c&&c!==null)ia=!0;else if(s.has(c)){let l=s.get(c);s.delete(c),t.destroy.call(null,l)}u.apply(Re,arguments)}}});var aa=d((i0,rm)=>{rm.exports={name:"async-hook-jl",description:"Inspect the life of handle objects in node",version:"1.7.6",author:"Andreas Madsen <amwebdk@gmail.com>",main:"./index.js",scripts:{test:"node ./test/runner.js && eslint ."},repository:{type:"git",url:"git://github.com/jeff-lewis/async-hook-jl.git"},keywords:["async","async hooks","inspect","async wrap"],license:"MIT",dependencies:{"stack-chain":"^1.3.7"},devDependencies:{async:"1.5.x","cli-color":"1.1.x",eslint:"^3.4.0",endpoint:"0.4.x"},engines:{node:"^4.7 || >=6.9 || >=7.3"}}});var Bc=d((s0,Vc)=>{"use strict";var Zr=process.binding("async_wrap"),nm=Zr.Providers.TIMERWRAP,$c={nextTick:Mc(),promise:Hc(),timers:Uc()},Jr=new Set;function im(){this.enabled=!1,this.counter=0}function oa(){let t=this.initFns=[],e=this.preFns=[],r=this.postFns=[],n=this.destroyFns=[];this.init=function(i,s,a,o){if(s===nm){Jr.add(i);return}for(let u of t)u(i,this,s,a,o)},this.pre=function(i){if(!Jr.has(i))for(let s of e)s(i,this)},this.post=function(i,s){if(!Jr.has(i))for(let a of r)a(i,this,s)},this.destroy=function(i){if(Jr.has(i)){Jr.delete(i);return}for(let s of n)s(i)}}oa.prototype.add=function(t){t.init&&this.initFns.push(t.init),t.pre&&this.preFns.push(t.pre),t.post&&this.postFns.push(t.post),t.destroy&&this.destroyFns.push(t.destroy)};function gi(t,e){let r=t.indexOf(e);r!==-1&&t.splice(r,1)}oa.prototype.remove=function(t){t.init&&gi(this.initFns,t.init),t.pre&&gi(this.preFns,t.pre),t.post&&gi(this.postFns,t.post),t.destroy&&gi(this.destroyFns,t.destroy)};function en(){this._state=new im,this._hooks=new oa,this.version=aa().version,this.providers=Zr.Providers;for(let t of Object.keys($c))$c[t].call(this);process.env.hasOwnProperty("NODE_ASYNC_HOOK_WARNING")&&console.warn("warning: you are using async-hook-jl which is unstable."),Zr.setupHooks({init:this._hooks.init,pre:this._hooks.pre,post:this._hooks.post,destroy:this._hooks.destroy})}Vc.exports=en;en.prototype.addHooks=function(t){this._hooks.add(t)};en.prototype.removeHooks=function(t){this._hooks.remove(t)};en.prototype.enable=function(){this._state.enabled=!0,Zr.enable()};en.prototype.disable=function(){this._state.enabled=!1,Zr.disable()}});var ua=d((a0,sm)=>{sm.exports={name:"stack-chain",description:"API for combining call site modifiers",version:"1.3.7",author:"Andreas Madsen <amwebdk@gmail.com>",scripts:{test:"tap ./test/simple"},repository:{type:"git",url:"git://github.com/AndreasMadsen/stack-chain.git"},keywords:["stack","chain","trace","call site","concat","format"],devDependencies:{tap:"2.x.x","uglify-js":"2.5.x"},license:"MIT"}});var zc=d((o0,Gc)=>{function am(t){try{return Error.prototype.toString.call(t)}catch(e){try{return"<error: "+e+">"}catch{return"<error>"}}}Gc.exports=function(e,r){var n=[];n.push(am(e));for(var i=0;i<r.length;i++){var s=r[i],a;try{a=s.toString()}catch(o){try{a="<error: "+o+">"}catch{a="<error>"}}n.push("    at "+a)}return n.join(`
`)}});var Xc=d((u0,Kc)=>{var mi=zc();function Wc(){this.extend=new tn,this.filter=new tn,this.format=new rn,this.version=ua().version}var la=!1;Wc.prototype.callSite=function t(e){e||(e={}),la=!0;var r={};Error.captureStackTrace(r,t);var n=r.stack;return la=!1,n=n.slice(e.slice||0),e.extend&&(n=this.extend._modify(r,n)),e.filter&&(n=this.filter._modify(r,n)),n};var gt=new Wc;function tn(){this._modifiers=[]}tn.prototype._modify=function(t,e){for(var r=0,n=this._modifiers.length;r<n;r++)e=this._modifiers[r](t,e);return e};tn.prototype.attach=function(t){this._modifiers.push(t)};tn.prototype.deattach=function(t){var e=this._modifiers.indexOf(t);return e===-1?!1:(this._modifiers.splice(e,1),!0)};function rn(){this._formater=mi,this._previous=void 0}rn.prototype.replace=function(t){t?this._formater=t:this.restore()};rn.prototype.restore=function(){this._formater=mi,this._previous=void 0};rn.prototype._backup=function(){this._previous=this._formater};rn.prototype._roolback=function(){this._previous===mi?this.replace(void 0):this.replace(this._previous),this._previous=void 0};Error.prepareStackTrace&&gt.format.replace(Error.prepareStackTrace);var ca=!1;function Qc(t,e){if(la)return e;if(ca)return mi(t,e);var r=e.concat();r=gt.extend._modify(t,r),r=gt.filter._modify(t,r),r=r.slice(0,Error.stackTraceLimit),Object.isExtensible(t)&&Object.getOwnPropertyDescriptor(t,"callSite")===void 0&&(t.callSite={original:e,mutated:r}),ca=!0;var n=gt.format._formater(t,r);return ca=!1,n}Object.defineProperty(Error,"prepareStackTrace",{get:function(){return Qc},set:function(t){t===Qc?gt.format._roolback():(gt.format._backup(),gt.format.replace(t))}});function om(){return this.stack,this.callSite}Object.defineProperty(Error.prototype,"callSite",{get:om,set:function(t){Object.defineProperty(this,"callSite",{value:t,writable:!0,configurable:!0})},configurable:!0});Kc.exports=gt});var fa=d((c0,pa)=>{if(global._stackChain)if(global._stackChain.version===ua().version)pa.exports=global._stackChain;else throw new Error("Conflicting version of stack-chain found");else pa.exports=global._stackChain=Xc()});var Yc=d((l0,da)=>{"use strict";var um=Bc();if(global._asyncHook)if(global._asyncHook.version===aa().version)da.exports=global._asyncHook;else throw new Error("Conflicting version of async-hook-jl found");else fa().filter.attach(function(e,r){return r.filter(function(n){let i=n.getFileName();return!(i&&i.slice(0,__dirname.length)===__dirname)})}),da.exports=global._asyncHook=new um});var nl=d((p0,rl)=>{"use strict";var ee=require("util"),at=require("assert"),cm=vi(),pr=Yc(),nn="cls@contexts",sn="error@context",Zc=[];for(let t in pr.providers)Zc[pr.providers[t]]=t;var Y=process.env.DEBUG_CLS_HOOKED,re=-1;rl.exports={getNamespace:el,createNamespace:lm,destroyNamespace:tl,reset:pm,ERROR_SYMBOL:sn};function Ne(t){this.name=t,this.active=null,this._set=[],this.id=null,this._contexts=new Map}Ne.prototype.set=function(e,r){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");return Y&&Z("    SETTING KEY:"+e+"="+r+" in ns:"+this.name+" uid:"+re+" active:"+ee.inspect(this.active,!0)),this.active[e]=r,r};Ne.prototype.get=function(e){if(!this.active){Y&&Z("    GETTING KEY:"+e+"=undefined "+this.name+" uid:"+re+" active:"+ee.inspect(this.active,!0));return}return Y&&Z("    GETTING KEY:"+e+"="+this.active[e]+" "+this.name+" uid:"+re+" active:"+ee.inspect(this.active,!0)),this.active[e]};Ne.prototype.createContext=function(){Y&&Z("   CREATING Context: "+this.name+" uid:"+re+" len:"+this._set.length+"  active:"+ee.inspect(this.active,!0,2,!0));let e=Object.create(this.active?this.active:Object.prototype);return e._ns_name=this.name,e.id=re,Y&&Z("   CREATED Context: "+this.name+" uid:"+re+" len:"+this._set.length+"  context:"+ee.inspect(e,!0,2,!0)),e};Ne.prototype.run=function(e){let r=this.createContext();this.enter(r);try{return Y&&Z(" BEFORE RUN: "+this.name+" uid:"+re+" len:"+this._set.length+" "+ee.inspect(r)),e(r),r}catch(n){throw n&&(n[sn]=r),n}finally{Y&&Z(" AFTER RUN: "+this.name+" uid:"+re+" len:"+this._set.length+" "+ee.inspect(r)),this.exit(r)}};Ne.prototype.runAndReturn=function(e){var r;return this.run(function(n){r=e(n)}),r};Ne.prototype.runPromise=function(e){let r=this.createContext();this.enter(r);let n=e(r);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return Y&&Z(" BEFORE runPromise: "+this.name+" uid:"+re+" len:"+this._set.length+" "+ee.inspect(r)),n.then(i=>(Y&&Z(" AFTER runPromise: "+this.name+" uid:"+re+" len:"+this._set.length+" "+ee.inspect(r)),this.exit(r),i)).catch(i=>{throw i[sn]=r,Y&&Z(" AFTER runPromise: "+this.name+" uid:"+re+" len:"+this._set.length+" "+ee.inspect(r)),this.exit(r),i})};Ne.prototype.bind=function(e,r){r||(this.active?r=this.active:r=this.createContext());let n=this;return function(){n.enter(r);try{return e.apply(this,arguments)}catch(s){throw s&&(s[sn]=r),s}finally{n.exit(r)}}};Ne.prototype.enter=function(e){at.ok(e,"context must be provided for entering"),Y&&Z("  ENTER "+this.name+" uid:"+re+" len:"+this._set.length+" context: "+ee.inspect(e)),this._set.push(this.active),this.active=e};Ne.prototype.exit=function(e){if(at.ok(e,"context must be provided for exiting"),Y&&Z("  EXIT "+this.name+" uid:"+re+" len:"+this._set.length+" context: "+ee.inspect(e)),this.active===e){at.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let r=this._set.lastIndexOf(e);r<0?(Y&&Z("??ERROR?? context exiting but not entered - ignoring: "+ee.inspect(e)),at.ok(r>=0,`context not currently entered; can't exit. 
`+ee.inspect(this)+`
`+ee.inspect(e))):(at.ok(r,"can't remove top context"),this._set.splice(r,1))};Ne.prototype.bindEmitter=function(e){at.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let r=this,n="context@"+this.name;function i(a){!a||(a[nn]||(a[nn]=Object.create(null)),a[nn][n]={namespace:r,context:r.active})}function s(a){if(!(a&&a[nn]))return a;let o=a,u=a[nn];return Object.keys(u).forEach(function(c){let l=u[c];o=l.namespace.bind(o,l.context)}),o}cm(e,i,s)};Ne.prototype.fromException=function(e){return e[sn]};function el(t){return process.namespaces[t]}function lm(t){at.ok(t,"namespace must be given a name."),Y&&Z("CREATING NAMESPACE "+t);let e=new Ne(t);return e.id=re,pr.addHooks({init(r,n,i,s,a){re=r,s?(e._contexts.set(r,e._contexts.get(s)),Y&&Z("PARENTID: "+t+" uid:"+r+" parent:"+s+" provider:"+i)):e._contexts.set(re,e.active),Y&&Z("INIT "+t+" uid:"+r+" parent:"+s+" provider:"+Zc[i]+" active:"+ee.inspect(e.active,!0))},pre(r,n){re=r;let i=e._contexts.get(r);i?(Y&&Z(" PRE "+t+" uid:"+r+" handle:"+yi(n)+" context:"+ee.inspect(i)),e.enter(i)):Y&&Z(" PRE MISSING CONTEXT "+t+" uid:"+r+" handle:"+yi(n))},post(r,n){re=r;let i=e._contexts.get(r);i?(Y&&Z(" POST "+t+" uid:"+r+" handle:"+yi(n)+" context:"+ee.inspect(i)),e.exit(i)):Y&&Z(" POST MISSING CONTEXT "+t+" uid:"+r+" handle:"+yi(n))},destroy(r){re=r,Y&&Z("DESTROY "+t+" uid:"+r+" context:"+ee.inspect(e._contexts.get(re))+" active:"+ee.inspect(e.active,!0)),e._contexts.delete(r)}}),process.namespaces[t]=e,e}function tl(t){let e=el(t);at.ok(e,`can't delete nonexistent namespace! "`+t+'"'),at.ok(e.id,"don't assign to process.namespaces directly! "+ee.inspect(e)),process.namespaces[t]=null}function pm(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){tl(t)}),process.namespaces=Object.create(null)}process.namespaces={};pr._state&&!pr._state.enabled&&pr.enable();function Z(t){process.env.DEBUG&&process._rawDebug(t)}function yi(t){if(!t)return t;if(typeof t=="function")return t.name?t.name:(t.toString().trim().match(/^function\s*([^\s(]+)/)||[])[1];if(t.constructor&&t.constructor.name)return t.constructor.name}if(Y){ha=fa();for(Jc in ha.filter._modifiers)ha.filter.deattach(Jc)}var ha,Jc});var il=d((f0,va)=>{"use strict";var fm=Jn();process&&fm.gte(process.versions.node,"8.0.0")?va.exports=Nc():va.exports=nl()});var ol=d((d0,al)=>{var dm=fi().wrap,ma=1<<0,ya=1<<1,_a=1<<2,Ci=1<<3,$=[],hm=0,me=!1,mt=[],fr,Ca;function Ea(t,e){var r=t.length,n=e.length,i=[];if(r===0&&n===0)return i;for(var s=0;s<r;s++)i[s]=t[s];if(n===0)return i;for(var a=0;a<n;a++){var o=!0;for(s=0;s<r;s++)if(t[s].uid===e[a].uid){o=!1;break}o&&i.push(e[a])}return i}process._fatalException?(_i=!1,fr=function(e){var r=$.length;if(_i||r===0)return!1;var n=!1;_i=!0;for(var i=0;i<r;++i){var s=$[i];if((s.flags&Ci)!==0){var a=dr&&dr[s.uid];n=s.error(a,e)||n}}return _i=!1,mt.length>0&&($=mt.pop()),dr=void 0,n&&!me},Ca=function(e,r,n){var i=[];me=!0;for(var s=0;s<n;++s){var a=r[s];if(i[a.uid]=a.data,(a.flags&ma)!==0){var o=a.create(a.data);o!==void 0&&(i[a.uid]=o)}}return me=!1,function(){dr=i,mt.push($),$=Ea(r,$),me=!0;for(var u=0;u<n;++u)(r[u].flags&ya)>0&&r[u].before(this,i[r[u].uid]);me=!1;var c=e.apply(this,arguments);for(me=!0,u=0;u<n;++u)(r[u].flags&_a)>0&&r[u].after(this,i[r[u].uid]);return me=!1,$=mt.pop(),dr=void 0,c}},dm(process,"_fatalException",function(t){return function(r){return fr(r)||t(r)}})):(ga=!1,fr=function(e){if(ga)throw e;for(var r=!1,n=$.length,i=0;i<n;++i){var s=$[i];(s.flags&Ci)!==0&&(r=s.error(null,e)||r)}if(!r&&me)throw e},Ca=function(e,r,n){var i=[];me=!0;for(var s=0;s<n;++s){var a=r[s];if(i[a.uid]=a.data,(a.flags&ma)!==0){var o=a.create(a.data);o!==void 0&&(i[a.uid]=o)}}return me=!1,function(){var u=!1,c=!1;mt.push($),$=Ea(r,$),me=!0;for(var l=0;l<n;++l)(r[l].flags&ya)>0&&r[l].before(this,i[r[l].uid]);me=!1;var p;try{p=e.apply(this,arguments)}catch(f){u=!0;for(var l=0;l<n;++l)if(($[l].flags&Ci)!=0)try{c=$[l].error(i[r[l].uid],f)||c}catch(m){throw ga=!0,m}if(!c)throw process.removeListener("uncaughtException",fr),process._originalNextTick(function(){process.addListener("uncaughtException",fr)}),f}finally{if(!u||c){for(me=!0,l=0;l<n;++l)(r[l].flags&_a)>0&&r[l].after(this,i[r[l].uid]);me=!1}$=mt.pop()}return p}},process.addListener("uncaughtException",fr));var _i,dr,ga;function vm(t,e,r){me=!0;for(var n=0;n<r;++n){var i=e[n];i.create&&i.create(i.data)}return me=!1,function(){mt.push($),$=Ea(e,$);var s=t.apply(this,arguments);return $=mt.pop(),s}}function gm(t){var e=$.length;if(e===0)return t;for(var r=$.slice(),n=0;n<e;++n)if(r[n].flags>0)return Ca(t,r,e);return vm(t,r,e)}function Xe(t,e){typeof t.create=="function"&&(this.create=t.create,this.flags|=ma),typeof t.before=="function"&&(this.before=t.before,this.flags|=ya),typeof t.after=="function"&&(this.after=t.after,this.flags|=_a),typeof t.error=="function"&&(this.error=t.error,this.flags|=Ci),this.uid=++hm,this.data=e===void 0?null:e}Xe.prototype.create=void 0;Xe.prototype.before=void 0;Xe.prototype.after=void 0;Xe.prototype.error=void 0;Xe.prototype.data=void 0;Xe.prototype.uid=0;Xe.prototype.flags=0;function sl(t,e){if(typeof t!="object"||!t)throw new TypeError("callbacks argument must be an object");return t instanceof Xe?t:new Xe(t,e)}function mm(t,e){var r;t instanceof Xe?r=t:r=sl(t,e);for(var n=!1,i=0;i<$.length;i++)if(r===$[i]){n=!0;break}return n||$.push(r),r}function ym(t){for(var e=0;e<$.length;e++)if(t===$[e]){$.splice(e,1);break}}process.createAsyncListener=sl;process.addAsyncListener=mm;process.removeAsyncListener=ym;al.exports=gm});var cl=d((v0,ul)=>{"use strict";ul.exports=(t,e)=>class extends t{constructor(n){var i,s;super(o);var a=this;try{n.apply(i,s)}catch(u){s[1](u)}return a;function o(u,c){i=this,s=[l,p];function l(f){return e(a,!1),u(f)}function p(f){return e(a,!1),c(f)}}}}});var gl=d(()=>{"use strict";if(process.addAsyncListener)throw new Error("Don't require polyfill unless needed");var dl=fi(),bi=Jn(),ke=dl.wrap,yt=dl.massWrap,X=ol(),_m=require("util"),Cm=bi.gte(process.version,"6.0.0"),wa=bi.gte(process.version,"7.0.0"),Em=bi.gte(process.version,"8.0.0"),bm=bi.gte(process.version,"11.0.0"),Ye=require("net");wa&&!Ye._normalizeArgs?Ye._normalizeArgs=function(t){if(t.length===0)return[{},null];var e=t[0],r={};typeof e=="object"&&e!==null?r=e:km(e)?r.path=e:(r.port=e,t.length>1&&typeof t[1]=="string"&&(r.host=t[1]));var n=t[t.length-1];return typeof n!="function"?[r,null]:[r,n]}:!wa&&!Ye._normalizeConnectArgs&&(Ye._normalizeConnectArgs=function(t){var e={};function r(i){return(i=Number(i))>=0?i:!1}typeof t[0]=="object"&&t[0]!==null?e=t[0]:typeof t[0]=="string"&&r(t[0])===!1?e.path=t[0]:(e.port=t[0],typeof t[1]=="string"&&(e.host=t[1]));var n=t[t.length-1];return typeof n=="function"?[e,n]:[e]});"_setUpListenHandle"in Ye.Server.prototype?ke(Ye.Server.prototype,"_setUpListenHandle",ll):ke(Ye.Server.prototype,"_listen2",ll);function ll(t){return function(){this.on("connection",function(e){e._handle&&(e._handle.onread=X(e._handle.onread))});try{return t.apply(this,arguments)}finally{this._handle&&this._handle.onconnection&&(this._handle.onconnection=X(this._handle.onconnection))}}}function hl(t){if(t&&t._handle){var e=t._handle;e._originalOnread||(e._originalOnread=e.onread),e.onread=X(e._originalOnread)}}ke(Ye.Socket.prototype,"connect",function(t){return function(){var e;Em&&Array.isArray(arguments[0])&&Object.getOwnPropertySymbols(arguments[0]).length>0?e=arguments[0]:e=wa?Ye._normalizeArgs(arguments):Ye._normalizeConnectArgs(arguments),e[1]&&(e[1]=X(e[1]));var r=t.apply(this,e);return hl(this),r}});var Tm=require("http");ke(Tm.Agent.prototype,"addRequest",function(t){return function(e){var r=e.onSocket;return e.onSocket=X(function(n){return hl(n),r.apply(this,arguments)}),t.apply(this,arguments)}});var ba=require("child_process");function pl(t){Array.isArray(t.stdio)&&t.stdio.forEach(function(e){e&&e._handle&&(e._handle.onread=X(e._handle.onread),ke(e._handle,"close",Ti))}),t._handle&&(t._handle.onexit=X(t._handle.onexit))}ba.ChildProcess?ke(ba.ChildProcess.prototype,"spawn",function(t){return function(){var e=t.apply(this,arguments);return pl(this),e}}):yt(ba,["execFile","fork","spawn"],function(t){return function(){var e=t.apply(this,arguments);return pl(e),e}});process._fatalException||(process._originalNextTick=process.nextTick);var ka=[];process._nextDomainTick&&ka.push("_nextDomainTick");process._tickDomainCallback&&ka.push("_tickDomainCallback");yt(process,ka,Je);ke(process,"nextTick",Ti);var Sa=["setTimeout","setInterval"];global.setImmediate&&Sa.push("setImmediate");var vl=require("timers"),wm=global.setTimeout===vl.setTimeout;yt(vl,Sa,Ti);wm&&yt(global,Sa,Ti);var Ia=require("dns");yt(Ia,["lookup","resolve","resolve4","resolve6","resolveCname","resolveMx","resolveNs","resolveTxt","resolveSrv","reverse"],Je);Ia.resolveNaptr&&ke(Ia,"resolveNaptr",Je);var Nt=require("fs");yt(Nt,["watch","rename","truncate","chown","fchown","chmod","fchmod","stat","lstat","fstat","link","symlink","readlink","realpath","unlink","rmdir","mkdir","readdir","close","open","utimes","futimes","fsync","write","read","readFile","writeFile","appendFile","watchFile","unwatchFile","exists"],Je);Nt.lchown&&ke(Nt,"lchown",Je);Nt.lchmod&&ke(Nt,"lchmod",Je);Nt.ftruncate&&ke(Nt,"ftruncate",Je);var an;try{an=require("zlib")}catch{}an&&an.Deflate&&an.Deflate.prototype&&(qt=Object.getPrototypeOf(an.Deflate.prototype),qt._transform?ke(qt,"_transform",Je):qt.write&&qt.flush&&qt.end&&yt(qt,["write","flush","end"],Je));var qt,xa;try{xa=require("crypto")}catch{}xa&&(Ta=["pbkdf2","randomBytes"],bm||Ta.push("pseudoRandomBytes"),yt(xa,Ta,Je));var Ta,Ei=!!global.Promise&&Promise.toString()==="function Promise() { [native code] }"&&Promise.toString.toString()==="function toString() { [native code] }";Ei&&(fl=process.addAsyncListener({create:function(){Ei=!1}}),global.Promise.resolve(!0).then(function(){Ei=!1}),process.removeAsyncListener(fl));var fl;Ei&&Im();function Im(){var t=global.Promise;function e(a){if(!(this instanceof e))return t(a);if(typeof a!="function")return new t(a);var o,u,c=new t(l);c.__proto__=e.prototype;try{a.apply(o,u)}catch(p){u[1](p)}return c;function l(p,f){o=this,u=[h,m];function h(E){return n(c,!1),p(E)}function m(E){return n(c,!1),f(E)}}}if(_m.inherits(e,t),ke(t.prototype,"then",s),t.prototype.chain&&ke(t.prototype,"chain",s),Cm)global.Promise=cl()(t,n);else{var r=["all","race","reject","resolve","accept","defer"];r.forEach(function(a){typeof t[a]=="function"&&(e[a]=t[a])}),global.Promise=e}function n(a,o){(!a.__asl_wrapper||o)&&(a.__asl_wrapper=X(i))}function i(a,o,u,c){var l;try{return l=o.call(a,u),{returnVal:l,error:!1}}catch(p){return{errorVal:p,error:!0}}finally{l instanceof t?c.__asl_wrapper=function(){var f=l.__asl_wrapper||i;return f.apply(this,arguments)}:n(c,!0)}}function s(a){return function(){var u=this,c=a.apply(u,Array.prototype.map.call(arguments,l));return c.__asl_wrapper=function(f,h,m,E){return u.__asl_wrapper?(u.__asl_wrapper(f,function(){},null,c),c.__asl_wrapper(f,h,m,E)):i(f,h,m,E)},c;function l(p){return typeof p!="function"?p:X(function(f){var h=(u.__asl_wrapper||i)(this,p,f,c);if(h.error)throw h.errorVal;return h.returnVal})}}}}function Je(t){var e=function(){var r,n=arguments.length-1;if(typeof arguments[n]=="function"){r=Array(arguments.length);for(var i=0;i<arguments.length-1;i++)r[i]=arguments[i];r[n]=X(arguments[n])}return t.apply(this,r||arguments)};switch(t.length){case 1:return function(r){return arguments.length!==1?e.apply(this,arguments):(typeof r=="function"&&(r=X(r)),t.call(this,r))};case 2:return function(r,n){return arguments.length!==2?e.apply(this,arguments):(typeof n=="function"&&(n=X(n)),t.call(this,r,n))};case 3:return function(r,n,i){return arguments.length!==3?e.apply(this,arguments):(typeof i=="function"&&(i=X(i)),t.call(this,r,n,i))};case 4:return function(r,n,i,s){return arguments.length!==4?e.apply(this,arguments):(typeof s=="function"&&(s=X(s)),t.call(this,r,n,i,s))};case 5:return function(r,n,i,s,a){return arguments.length!==5?e.apply(this,arguments):(typeof a=="function"&&(a=X(a)),t.call(this,r,n,i,s,a))};case 6:return function(r,n,i,s,a,o){return arguments.length!==6?e.apply(this,arguments):(typeof o=="function"&&(o=X(o)),t.call(this,r,n,i,s,a,o))};default:return e}}function Ti(t){var e=function(){var r;if(typeof arguments[0]=="function"){r=Array(arguments.length),r[0]=X(arguments[0]);for(var n=1;n<arguments.length;n++)r[n]=arguments[n]}return t.apply(this,r||arguments)};switch(t.length){case 1:return function(r){return arguments.length!==1?e.apply(this,arguments):(typeof r=="function"&&(r=X(r)),t.call(this,r))};case 2:return function(r,n){return arguments.length!==2?e.apply(this,arguments):(typeof r=="function"&&(r=X(r)),t.call(this,r,n))};case 3:return function(r,n,i){return arguments.length!==3?e.apply(this,arguments):(typeof r=="function"&&(r=X(r)),t.call(this,r,n,i))};case 4:return function(r,n,i,s){return arguments.length!==4?e.apply(this,arguments):(typeof r=="function"&&(r=X(r)),t.call(this,r,n,i,s))};case 5:return function(r,n,i,s,a){return arguments.length!==5?e.apply(this,arguments):(typeof r=="function"&&(r=X(r)),t.call(this,r,n,i,s,a))};case 6:return function(r,n,i,s,a,o){return arguments.length!==6?e.apply(this,arguments):(typeof r=="function"&&(r=X(r)),t.call(this,r,n,i,s,a,o))};default:return e}}function xm(t){return(t=Number(t))>=0?t:!1}function km(t){return typeof t=="string"&&xm(t)===!1}});var El=d((y0,Cl)=>{"use strict";var ot=require("assert"),Sm=vi(),on="cls@contexts",Pa="error@context";process.addAsyncListener||gl();function Ve(t){this.name=t,this.active=null,this._set=[],this.id=null}Ve.prototype.set=function(t,e){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");return this.active[t]=e,e};Ve.prototype.get=function(t){if(!!this.active)return this.active[t]};Ve.prototype.createContext=function(){return Object.create(this.active)};Ve.prototype.run=function(t){var e=this.createContext();this.enter(e);try{return t(e),e}catch(r){throw r&&(r[Pa]=e),r}finally{this.exit(e)}};Ve.prototype.runAndReturn=function(t){var e;return this.run(function(r){e=t(r)}),e};Ve.prototype.bind=function(t,e){e||(this.active?e=this.active:e=this.createContext());var r=this;return function(){r.enter(e);try{return t.apply(this,arguments)}catch(n){throw n&&(n[Pa]=e),n}finally{r.exit(e)}}};Ve.prototype.enter=function(t){ot.ok(t,"context must be provided for entering"),this._set.push(this.active),this.active=t};Ve.prototype.exit=function(t){if(ot.ok(t,"context must be provided for exiting"),this.active===t){ot.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}var e=this._set.lastIndexOf(t);ot.ok(e>=0,"context not currently entered; can't exit"),ot.ok(e,"can't remove top context"),this._set.splice(e,1)};Ve.prototype.bindEmitter=function(t){ot.ok(t.on&&t.addListener&&t.emit,"can only bind real EEs");var e=this,r="context@"+this.name;function n(s){!s||(s[on]||(s[on]=Object.create(null)),s[on][r]={namespace:e,context:e.active})}function i(s){if(!(s&&s[on]))return s;var a=s,o=s[on];return Object.keys(o).forEach(function(u){var c=o[u];a=c.namespace.bind(a,c.context)}),a}Sm(t,n,i)};Ve.prototype.fromException=function(t){return t[Pa]};function ml(t){return process.namespaces[t]}function Pm(t){ot.ok(t,"namespace must be given a name!");var e=new Ve(t);return e.id=process.addAsyncListener({create:function(){return e.active},before:function(r,n){n&&e.enter(n)},after:function(r,n){n&&e.exit(n)},error:function(r){r&&e.exit(r)}}),process.namespaces[t]=e,e}function yl(t){var e=ml(t);ot.ok(e,"can't delete nonexistent namespace!"),ot.ok(e.id,"don't assign to process.namespaces directly!"),process.removeAsyncListener(e.id),process.namespaces[t]=null}function _l(){process.namespaces&&Object.keys(process.namespaces).forEach(function(t){yl(t)}),process.namespaces=Object.create(null)}process.namespaces||_l();Cl.exports={getNamespace:ml,createNamespace:Pm,destroyNamespace:yl,reset:_l}});var wt=d(Da=>{"use strict";Object.defineProperty(Da,"__esModule",{value:!0});var Tl=ae(),Am=si(),un=Qr(),Aa=qs(),bl=ta(),Dm=function(){function t(){}return t.getCurrentContext=function(){if(!t.enabled)return null;var e=t.session.get(t.CONTEXT_NAME);return e===void 0?null:e},t.generateContextObject=function(e,r,n,i,s,a){return r=r||e,this.enabled?{operation:{name:n,id:e,parentId:r,traceparent:s,tracestate:a},customProperties:new Rm(i)}:null},t.spanToContextObject=function(e,r,n){var i=new un;return i.traceId=e.traceId,i.spanId=e.spanId,i.traceFlag=e.traceFlags||un.DEFAULT_TRACE_FLAG,i.parentId=r,t.generateContextObject(i.traceId,i.parentId,n,null,i)},t.runWithContext=function(e,r){if(t.enabled)return t.session.bind(r,(n={},n[t.CONTEXT_NAME]=e,n))();return r();var n},t.wrapEmitter=function(e){t.enabled&&t.session.bindEmitter(e)},t.wrapCallback=function(e,r){if(t.enabled)return t.session.bind(e,r?(n={},n[t.CONTEXT_NAME]=r,n):void 0);return e;var n},t.enable=function(e){if(!this.enabled){if(!this.isNodeVersionCompatible()){this.enabled=!1;return}t.hasEverEnabled||(this.forceClsHooked=e,this.hasEverEnabled=!0,typeof this.cls>"u"&&(t.forceClsHooked===!0||t.forceClsHooked===void 0&&t.shouldUseClsHooked()?this.cls=il():this.cls=El()),t.session=this.cls.createNamespace("AI-CLS-Session"),Am.registerContextPreservation(function(r){return t.session.bind(r)})),this.enabled=!0}},t.startOperation=function(e,r){var n=e&&e.traceContext||null,i=e&&e.traceId?e:null,s=e&&e.headers;if(i){var a=new un("00-"+i.traceId+"-"+i.spanId+"-01"),o=new Aa(i.tracestate),u=t.generateContextObject(i.traceId,"|"+i.traceId+"."+i.spanId+".",typeof r=="string"?r:"",void 0,a,o);return u}if(n){var a=new un(n.traceparent),o=new Aa(n.tracestate),c=typeof r=="object"?new bl(r):null,u=t.generateContextObject(a.traceId,a.parentId,typeof r=="string"?r:c.getOperationName({}),c&&c.getCorrelationContextHeader()||void 0,a,o);return u}if(s){var a=new un(s.traceparent),o=new Aa(s.tracestate),c=new bl(e),u=t.generateContextObject(a.traceId,a.parentId,c.getOperationName({}),c.getCorrelationContextHeader(),a,o);return u}return Tl.warn("startOperation was called with invalid arguments",arguments),null},t.disable=function(){this.enabled=!1},t.reset=function(){t.hasEverEnabled&&(t.session=null,t.session=this.cls.createNamespace("AI-CLS-Session"))},t.isNodeVersionCompatible=function(){var e=process.versions.node.split(".");return parseInt(e[0])>3||parseInt(e[0])>2&&parseInt(e[1])>2},t.shouldUseClsHooked=function(){var e=process.versions.node.split(".");return parseInt(e[0])>8||parseInt(e[0])>=8&&parseInt(e[1])>=2},t.canUseClsHooked=function(){var e=process.versions.node.split("."),r=parseInt(e[0])>8||parseInt(e[0])>=8&&parseInt(e[1])>=0,n=parseInt(e[0])<8||parseInt(e[0])<=8&&parseInt(e[1])<2,i=parseInt(e[0])>4||parseInt(e[0])>=4&&parseInt(e[1])>=7;return!(r&&n)&&i},t.enabled=!1,t.hasEverEnabled=!1,t.forceClsHooked=void 0,t.CONTEXT_NAME="ApplicationInsights-Context",t}();Da.CorrelationContextManager=Dm;var Rm=function(){function t(e){this.props=[],this.addHeaderData(e)}return t.prototype.addHeaderData=function(e){var r=e?e.split(", "):[];this.props=r.map(function(n){var i=n.split("=");return{key:i[0],value:i[1]}}).concat(this.props)},t.prototype.serializeToHeader=function(){return this.props.map(function(e){return e.key+"="+e.value}).join(", ")},t.prototype.getProperty=function(e){for(var r=0;r<this.props.length;++r){var n=this.props[r];if(n.key===e)return n.value}},t.prototype.setProperty=function(e,r){if(t.bannedCharacters.test(e)||t.bannedCharacters.test(r)){Tl.warn("Correlation context property keys and values must not contain ',' or '='. setProperty was called with key: "+e+" and value: "+r);return}for(var n=0;n<this.props.length;++n){var i=this.props[n];if(i.key===e){i.value=r;return}}this.props.push({key:e,value:r})},t.bannedCharacters=/[,=]/,t}()});var Il=d(wi=>{"use strict";Object.defineProperty(wi,"__esModule",{value:!0});var wl=De(),Ra=J(),Lt=[],Oa=function(t){var e=t.data.message;Lt.forEach(function(r){e instanceof Error?r.trackException({exception:e}):(e.lastIndexOf(`
`)==e.length-1&&(e=e.substring(0,e.length-1)),r.trackTrace({message:e,severity:t.data.stderr?wl.SeverityLevel.Warning:wl.SeverityLevel.Information}))})};function Om(t,e){t?(Lt.length===0&&Ra.channel.subscribe("console",Oa),Lt.push(e)):(Lt=Lt.filter(function(r){return r!=e}),Lt.length===0&&Ra.channel.unsubscribe("console",Oa))}wi.enable=Om;function qm(){Ra.channel.unsubscribe("console",Oa),Lt=[]}wi.dispose=qm});var xl=d(Ii=>{"use strict";Object.defineProperty(Ii,"__esModule",{value:!0});var hr=De(),qa=J(),Mt=[],Nm={10:hr.SeverityLevel.Verbose,20:hr.SeverityLevel.Verbose,30:hr.SeverityLevel.Information,40:hr.SeverityLevel.Warning,50:hr.SeverityLevel.Error,60:hr.SeverityLevel.Critical},Na=function(t){var e=t.data.result;Mt.forEach(function(r){var n=Nm[t.data.level];e instanceof Error?r.trackException({exception:e}):r.trackTrace({message:e,severity:n})})};function Lm(t,e){t?(Mt.length===0&&qa.channel.subscribe("bunyan",Na),Mt.push(e)):(Mt=Mt.filter(function(r){return r!=e}),Mt.length===0&&qa.channel.unsubscribe("bunyan",Na))}Ii.enable=Lm;function Mm(){qa.channel.unsubscribe("bunyan",Na),Mt=[]}Ii.dispose=Mm});var kl=d(xi=>{"use strict";Object.defineProperty(xi,"__esModule",{value:!0});var he=De(),La=J(),Ft=[],Fm={syslog:function(t){var e={emerg:he.SeverityLevel.Critical,alert:he.SeverityLevel.Critical,crit:he.SeverityLevel.Critical,error:he.SeverityLevel.Error,warning:he.SeverityLevel.Warning,notice:he.SeverityLevel.Information,info:he.SeverityLevel.Information,debug:he.SeverityLevel.Verbose};return e[t]===void 0?he.SeverityLevel.Information:e[t]},npm:function(t){var e={error:he.SeverityLevel.Error,warn:he.SeverityLevel.Warning,info:he.SeverityLevel.Information,verbose:he.SeverityLevel.Verbose,debug:he.SeverityLevel.Verbose,silly:he.SeverityLevel.Verbose};return e[t]===void 0?he.SeverityLevel.Information:e[t]},unknown:function(t){return he.SeverityLevel.Information}},Ma=function(t){var e=t.data.message;Ft.forEach(function(r){if(e instanceof Error)r.trackException({exception:e,properties:t.data.meta});else{var n=Fm[t.data.levelKind](t.data.level);r.trackTrace({message:e,severity:n,properties:t.data.meta})}})};function Hm(t,e){t?(Ft.length===0&&La.channel.subscribe("winston",Ma),Ft.push(e)):(Ft=Ft.filter(function(r){return r!=e}),Ft.length===0&&La.channel.unsubscribe("winston",Ma))}xi.enable=Hm;function jm(){La.channel.unsubscribe("winston",Ma),Ft=[]}xi.dispose=jm});var Pl=d((T0,Sl)=>{"use strict";var Um=si(),$m=function(){function t(e){if(t.INSTANCE)throw new Error("Console logging adapter tracking should be configured from the applicationInsights object");this._client=e,t.INSTANCE=this}return t.prototype.enable=function(e,r){Um.IsInitialized&&(Il().enable(e&&r,this._client),xl().enable(e,this._client),kl().enable(e,this._client))},t.prototype.isInitialized=function(){return this._isInitialized},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1,!1)},t._methodNames=["debug","info","log","warn","error"],t}();Sl.exports=$m});var Dl=d((w0,Al)=>{"use strict";var Vm=function(){function t(e){if(t.INSTANCE)throw new Error("Exception tracking should be configured from the applicationInsights object");t.INSTANCE=this,this._client=e;var r=process.versions.node.split(".");t._canUseUncaughtExceptionMonitor=parseInt(r[0])>13||parseInt(r[0])===13&&parseInt(r[1])>=7}return t.prototype.isInitialized=function(){return this._isInitialized},t.prototype.enable=function(e){var r=this;if(e){this._isInitialized=!0;var n=this;if(!this._exceptionListenerHandle){var i=function(s,a,o){o===void 0&&(o=new Error(t._FALLBACK_ERROR_MESSAGE)),r._client.trackException({exception:o}),r._client.flush({isAppCrashing:!0}),s&&a&&process.listeners(a).length===1&&(console.error(o),process.exit(1))};t._canUseUncaughtExceptionMonitor?(this._exceptionListenerHandle=i.bind(this,!1,void 0),process.on(t.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME,this._exceptionListenerHandle)):(this._exceptionListenerHandle=i.bind(this,!0,t.UNCAUGHT_EXCEPTION_HANDLER_NAME),this._rejectionListenerHandle=i.bind(this,!1,void 0),process.on(t.UNCAUGHT_EXCEPTION_HANDLER_NAME,this._exceptionListenerHandle),process.on(t.UNHANDLED_REJECTION_HANDLER_NAME,this._rejectionListenerHandle))}}else this._exceptionListenerHandle&&(t._canUseUncaughtExceptionMonitor?process.removeListener(t.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME,this._exceptionListenerHandle):(process.removeListener(t.UNCAUGHT_EXCEPTION_HANDLER_NAME,this._exceptionListenerHandle),process.removeListener(t.UNHANDLED_REJECTION_HANDLER_NAME,this._rejectionListenerHandle)),this._exceptionListenerHandle=void 0,this._rejectionListenerHandle=void 0,delete this._exceptionListenerHandle,delete this._rejectionListenerHandle)},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t.INSTANCE=null,t.UNCAUGHT_EXCEPTION_MONITOR_HANDLER_NAME="uncaughtExceptionMonitor",t.UNCAUGHT_EXCEPTION_HANDLER_NAME="uncaughtException",t.UNHANDLED_REJECTION_HANDLER_NAME="unhandledRejection",t._RETHROW_EXIT_MESSAGE="Application Insights Rethrow Exception Handler",t._FALLBACK_ERROR_MESSAGE="A promise was rejected without providing an error. Application Insights generated this error stack for you.",t._canUseUncaughtExceptionMonitor=!1,t}();Al.exports=Vm});var _t=d(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.DEFAULT_BREEZE_ENDPOINT="https://dc.services.visualstudio.com";N.DEFAULT_LIVEMETRICS_ENDPOINT="https://rt.services.visualstudio.com";N.DEFAULT_LIVEMETRICS_HOST="rt.services.visualstudio.com";var ye;(function(t){t.COMMITTED_BYTES="\\Memory\\Committed Bytes",t.PROCESSOR_TIME="\\Processor(_Total)\\% Processor Time",t.REQUEST_RATE="\\ApplicationInsights\\Requests/Sec",t.REQUEST_FAILURE_RATE="\\ApplicationInsights\\Requests Failed/Sec",t.REQUEST_DURATION="\\ApplicationInsights\\Request Duration",t.DEPENDENCY_RATE="\\ApplicationInsights\\Dependency Calls/Sec",t.DEPENDENCY_FAILURE_RATE="\\ApplicationInsights\\Dependency Calls Failed/Sec",t.DEPENDENCY_DURATION="\\ApplicationInsights\\Dependency Call Duration",t.EXCEPTION_RATE="\\ApplicationInsights\\Exceptions/Sec"})(ye=N.QuickPulseCounter||(N.QuickPulseCounter={}));var ki;(function(t){t.PRIVATE_BYTES="\\Process(??APP_WIN32_PROC??)\\Private Bytes",t.AVAILABLE_BYTES="\\Memory\\Available Bytes",t.PROCESSOR_TIME="\\Processor(_Total)\\% Processor Time",t.PROCESS_TIME="\\Process(??APP_WIN32_PROC??)\\% Processor Time",t.REQUEST_RATE="\\ASP.NET Applications(??APP_W3SVC_PROC??)\\Requests/Sec",t.REQUEST_DURATION="\\ASP.NET Applications(??APP_W3SVC_PROC??)\\Request Execution Time"})(ki=N.PerformanceCounter||(N.PerformanceCounter={}));N.PerformanceToQuickPulseCounter=(Be={},Be[ki.PROCESSOR_TIME]=ye.PROCESSOR_TIME,Be[ki.REQUEST_RATE]=ye.REQUEST_RATE,Be[ki.REQUEST_DURATION]=ye.REQUEST_DURATION,Be[ye.COMMITTED_BYTES]=ye.COMMITTED_BYTES,Be[ye.REQUEST_FAILURE_RATE]=ye.REQUEST_FAILURE_RATE,Be[ye.DEPENDENCY_RATE]=ye.DEPENDENCY_RATE,Be[ye.DEPENDENCY_FAILURE_RATE]=ye.DEPENDENCY_FAILURE_RATE,Be[ye.DEPENDENCY_DURATION]=ye.DEPENDENCY_DURATION,Be[ye.EXCEPTION_RATE]=ye.EXCEPTION_RATE,Be);N.QuickPulseDocumentType={Event:"Event",Exception:"Exception",Trace:"Trace",Metric:"Metric",Request:"Request",Dependency:"RemoteDependency",Availability:"Availability",PageView:"PageView"};N.QuickPulseType={Event:"EventTelemetryDocument",Exception:"ExceptionTelemetryDocument",Trace:"TraceTelemetryDocument",Metric:"MetricTelemetryDocument",Request:"RequestTelemetryDocument",Dependency:"DependencyTelemetryDocument",Availability:"AvailabilityTelemetryDocument",PageView:"PageViewTelemetryDocument"};N.TelemetryTypeStringToQuickPulseType={EventData:N.QuickPulseType.Event,ExceptionData:N.QuickPulseType.Exception,MessageData:N.QuickPulseType.Trace,MetricData:N.QuickPulseType.Metric,RequestData:N.QuickPulseType.Request,RemoteDependencyData:N.QuickPulseType.Dependency,AvailabilityData:N.QuickPulseType.Availability,PageViewData:N.QuickPulseType.PageView};N.TelemetryTypeStringToQuickPulseDocumentType={EventData:N.QuickPulseDocumentType.Event,ExceptionData:N.QuickPulseDocumentType.Exception,MessageData:N.QuickPulseDocumentType.Trace,MetricData:N.QuickPulseDocumentType.Metric,RequestData:N.QuickPulseDocumentType.Request,RemoteDependencyData:N.QuickPulseDocumentType.Dependency,AvailabilityData:N.QuickPulseDocumentType.Availability,PageViewData:N.QuickPulseDocumentType.PageView};N.SpanAttribute={HttpHost:"http.host",HttpMethod:"http.method",HttpPort:"http.port",HttpStatusCode:"http.status_code",HttpUrl:"http.url",HttpUserAgent:"http.user_agent",GrpcMethod:"grpc.method",GrpcService:"rpc.service"};N.DependencyTypeName={Grpc:"GRPC",Http:"HTTP",InProc:"InProc"};N.HeartBeatMetricName="HeartBeat";var Be});var Pi=d((x0,Rl)=>{"use strict";var Si=require("os"),Le=_t(),Bm=function(){function t(e,r,n){r===void 0&&(r=6e4),n===void 0&&(n=!1),this._lastIntervalRequestExecutionTime=0,this._lastIntervalDependencyExecutionTime=0,t.INSTANCE||(t.INSTANCE=this),this._isInitialized=!1,this._client=e,this._collectionInterval=r,this._enableLiveMetricsCounters=n}return t.prototype.enable=function(e,r){var n=this;this._isEnabled=e,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),e?this._handle||(this._lastCpus=Si.cpus(),this._lastRequests={totalRequestCount:t._totalRequestCount,totalFailedRequestCount:t._totalFailedRequestCount,time:+new Date},this._lastDependencies={totalDependencyCount:t._totalDependencyCount,totalFailedDependencyCount:t._totalFailedDependencyCount,time:+new Date},this._lastExceptions={totalExceptionCount:t._totalExceptionCount,time:+new Date},typeof process.cpuUsage=="function"&&(this._lastAppCpuUsage=process.cpuUsage()),this._lastHrtime=process.hrtime(),this._collectionInterval=r||this._collectionInterval,this._handle=setInterval(function(){return n.trackPerformance()},this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=void 0)},t.countRequest=function(e,r){var n;if(!!t.isEnabled()){if(typeof e=="string")n=+new Date("1970-01-01T"+e+"Z");else if(typeof e=="number")n=e;else return;t._intervalRequestExecutionTime+=n,r===!1&&t._totalFailedRequestCount++,t._totalRequestCount++}},t.countException=function(){t._totalExceptionCount++},t.countDependency=function(e,r){var n;if(!!t.isEnabled()){if(typeof e=="string")n=+new Date("1970-01-01T"+e+"Z");else if(typeof e=="number")n=e;else return;t._intervalDependencyExecutionTime+=n,r===!1&&t._totalFailedDependencyCount++,t._totalDependencyCount++}},t.prototype.isInitialized=function(){return this._isInitialized},t.isEnabled=function(){return t.INSTANCE&&t.INSTANCE._isEnabled},t.prototype.trackPerformance=function(){this._trackCpu(),this._trackMemory(),this._trackNetwork(),this._trackDependencyRate(),this._trackExceptionRate()},t.prototype._trackCpu=function(){var e=Si.cpus();if(e&&e.length&&this._lastCpus&&e.length===this._lastCpus.length){for(var r=0,n=0,i=0,s=0,a=0,o=0;!!e&&o<e.length;o++){var u=e[o],c=this._lastCpus[o],l="% cpu("+o+") ",p=u.model,f=u.speed,h=u.times,m=c.times,E=h.user-m.user||0;r+=E;var I=h.sys-m.sys||0;n+=I;var q=h.nice-m.nice||0;i+=q;var Q=h.idle-m.idle||0;s+=Q;var U=h.irq-m.irq||0;a+=U}var le=void 0;if(typeof process.cpuUsage=="function"){var ve=process.cpuUsage(),He=process.hrtime(),Qe=ve.user-this._lastAppCpuUsage.user+(ve.system-this._lastAppCpuUsage.system)||0;if(typeof this._lastHrtime<"u"&&this._lastHrtime.length===2){var dt=(He[0]-this._lastHrtime[0])*1e6+(He[1]-this._lastHrtime[1])/1e3||0;le=100*Qe/(dt*e.length)}this._lastAppCpuUsage=ve,this._lastHrtime=He}var bt=r+n+i+s+a||1;this._client.trackMetric({name:Le.PerformanceCounter.PROCESSOR_TIME,value:(bt-s)/bt*100}),this._client.trackMetric({name:Le.PerformanceCounter.PROCESS_TIME,value:le||r/bt*100})}this._lastCpus=e},t.prototype._trackMemory=function(){var e=Si.freemem(),r=process.memoryUsage().rss,n=Si.totalmem()-e;this._client.trackMetric({name:Le.PerformanceCounter.PRIVATE_BYTES,value:r}),this._client.trackMetric({name:Le.PerformanceCounter.AVAILABLE_BYTES,value:e}),this._enableLiveMetricsCounters&&this._client.trackMetric({name:Le.QuickPulseCounter.COMMITTED_BYTES,value:n})},t.prototype._trackNetwork=function(){var e=this._lastRequests,r={totalRequestCount:t._totalRequestCount,totalFailedRequestCount:t._totalFailedRequestCount,time:+new Date},n=r.totalRequestCount-e.totalRequestCount||0,i=r.totalFailedRequestCount-e.totalFailedRequestCount||0,s=r.time-e.time,a=s/1e3,o=(t._intervalRequestExecutionTime-this._lastIntervalRequestExecutionTime)/n||0;if(this._lastIntervalRequestExecutionTime=t._intervalRequestExecutionTime,s>0){var u=n/a,c=i/a;this._client.trackMetric({name:Le.PerformanceCounter.REQUEST_RATE,value:u}),(!this._enableLiveMetricsCounters||n>0)&&this._client.trackMetric({name:Le.PerformanceCounter.REQUEST_DURATION,value:o}),this._enableLiveMetricsCounters&&this._client.trackMetric({name:Le.QuickPulseCounter.REQUEST_FAILURE_RATE,value:c})}this._lastRequests=r},t.prototype._trackDependencyRate=function(){if(this._enableLiveMetricsCounters){var e=this._lastDependencies,r={totalDependencyCount:t._totalDependencyCount,totalFailedDependencyCount:t._totalFailedDependencyCount,time:+new Date},n=r.totalDependencyCount-e.totalDependencyCount||0,i=r.totalFailedDependencyCount-e.totalFailedDependencyCount||0,s=r.time-e.time,a=s/1e3,o=(t._intervalDependencyExecutionTime-this._lastIntervalDependencyExecutionTime)/n||0;if(this._lastIntervalDependencyExecutionTime=t._intervalDependencyExecutionTime,s>0){var u=n/a,c=i/a;this._client.trackMetric({name:Le.QuickPulseCounter.DEPENDENCY_RATE,value:u}),this._client.trackMetric({name:Le.QuickPulseCounter.DEPENDENCY_FAILURE_RATE,value:c}),(!this._enableLiveMetricsCounters||n>0)&&this._client.trackMetric({name:Le.QuickPulseCounter.DEPENDENCY_DURATION,value:o})}this._lastDependencies=r}},t.prototype._trackExceptionRate=function(){if(this._enableLiveMetricsCounters){var e=this._lastExceptions,r={totalExceptionCount:t._totalExceptionCount,time:+new Date},n=r.totalExceptionCount-e.totalExceptionCount||0,i=r.time-e.time,s=i/1e3;if(i>0){var a=n/s;this._client.trackMetric({name:Le.QuickPulseCounter.EXCEPTION_RATE,value:a})}this._lastExceptions=r}},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t._totalRequestCount=0,t._totalFailedRequestCount=0,t._lastRequestExecutionTime=0,t._totalDependencyCount=0,t._totalFailedDependencyCount=0,t._lastDependencyExecutionTime=0,t._totalExceptionCount=0,t._intervalDependencyExecutionTime=0,t._intervalRequestExecutionTime=0,t}();Rl.exports=Bm});var cn=d((k0,Ll)=>{"use strict";var ut=require("os"),Ol=require("fs"),ql=require("path"),Gm=De(),Nl=ae(),zm=function(){function t(e){this.keys=new Gm.ContextTagKeys,this.tags={},this._loadApplicationContext(e),this._loadDeviceContext(),this._loadInternalContext()}return t.prototype._loadApplicationContext=function(e){if(e=e||ql.resolve(__dirname,"../../../../package.json"),!t.appVersion[e]){t.appVersion[e]="unknown";try{var r=JSON.parse(Ol.readFileSync(e,"utf8"));r&&typeof r.version=="string"&&(t.appVersion[e]=r.version)}catch(n){Nl.info("unable to read app version: ",n)}}this.tags[this.keys.applicationVersion]=t.appVersion[e]},t.prototype._loadDeviceContext=function(){this.tags[this.keys.deviceId]="",this.tags[this.keys.cloudRoleInstance]=ut&&ut.hostname(),this.tags[this.keys.deviceOSVersion]=ut&&ut.type()+" "+ut.release(),this.tags[this.keys.cloudRole]=t.DefaultRoleName,this.tags["ai.device.osArchitecture"]=ut&&ut.arch(),this.tags["ai.device.osPlatform"]=ut&&ut.platform()},t.prototype._loadInternalContext=function(){var e=ql.resolve(__dirname,"../../package.json");if(!t.sdkVersion){t.sdkVersion="unknown";try{var r=JSON.parse(Ol.readFileSync(e,"utf8"));r&&typeof r.version=="string"&&(t.sdkVersion=r.version)}catch(n){Nl.info("unable to read app version: ",n)}}this.tags[this.keys.internalSdkVersion]="node:"+t.sdkVersion},t.DefaultRoleName="Web",t.appVersion={},t.sdkVersion=null,t}();Ll.exports=zm});var Fl=d((Ha,Ml)=>{"use strict";var Qm=Ha&&Ha.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ge=require("url"),Fa=De(),Wm=Ae(),Km=ur(),Xm=Js(),Ym=At(),Jm=function(t){Qm(e,t);function e(r,n){var i=t.call(this)||this;return n&&n.method&&r&&(i.method=n.method,i.url=e._getUrlFromRequestOptions(r,n),i.startTime=+new Date),i}return e.prototype.onError=function(r){this._setStatus(void 0,r)},e.prototype.onResponse=function(r){this._setStatus(r.statusCode,void 0),this.correlationId=Wm.getCorrelationContextTarget(r,Km.requestContextTargetKey)},e.prototype.getDependencyTelemetry=function(r,n){var i=Ge.parse(this.url);i.search=void 0,i.hash=void 0;var s=this.method.toUpperCase()+" "+i.pathname,a=Fa.RemoteDependencyDataConstants.TYPE_HTTP,o=i.hostname;i.port&&(o+=":"+i.port),this.correlationId?(a=Fa.RemoteDependencyDataConstants.TYPE_AI,this.correlationId!==Ym.correlationIdPrefix&&(o+=" | "+this.correlationId)):a=Fa.RemoteDependencyDataConstants.TYPE_HTTP;var u={id:n,name:s,data:this.url,duration:this.duration,success:this._isSuccess(),resultCode:this.statusCode?this.statusCode.toString():null,properties:this.properties||{},dependencyTypeName:a,target:o};if(r&&r.time?u.time=r.time:this.startTime&&(u.time=new Date(this.startTime)),r){for(var c in r)u[c]||(u[c]=r[c]);if(r.properties)for(var c in r.properties)u.properties[c]=r.properties[c]}return u},e._getUrlFromRequestOptions=function(r,n){if(typeof r=="string")if(r.indexOf("http://")===0||r.indexOf("https://")===0)r=Ge.parse(r);else{var i=Ge.parse(r);i.host==="443"?r=Ge.parse("https://"+r):r=Ge.parse("http://"+r)}else{if(r&&typeof Ge.URL=="function"&&r instanceof Ge.URL)return Ge.format(r);var s=r;r={},s&&Object.keys(s).forEach(function(u){r[u]=s[u]})}if(r.path){var a=Ge.parse(r.path);r.pathname=a.pathname,r.search=a.search}if(r.host&&r.port){var o=Ge.parse("http://"+r.host);!o.port&&r.port&&(r.hostname=r.host,delete r.host)}return r.protocol=r.protocol||n.agent&&n.agent.protocol||n.protocol||void 0,r.hostname=r.hostname||"localhost",Ge.format(r)},e}(Xm);Ml.exports=Jm});var jl=d(ln=>{"use strict";var Hl=ln&&ln.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(ln,"__esModule",{value:!0});var Zm=$n(),Se=_t();function ja(t){var e=Hl({},t);return Object.keys(Se.SpanAttribute).forEach(function(r){delete e[r]}),e}function ey(t){var e="|"+t.context().traceId+"."+t.context().spanId+".",r=Math.round(t._duration[0]*1e3+t._duration[1]/1e6),n=t.attributes["peer.address"]?t.attributes["peer.address"].toString():"",i=t.attributes.component?t.attributes.component.toString():"",s=i.toUpperCase()===Se.DependencyTypeName.Http||!!t.attributes[Se.SpanAttribute.HttpUrl],a=i.toLowerCase()===Se.DependencyTypeName.Grpc;if(s){var o=t.attributes[Se.SpanAttribute.HttpMethod]||"GET",u=new URL(t.attributes[Se.SpanAttribute.HttpUrl].toString()),c=t.attributes[Se.SpanAttribute.HttpHost]||u.host,l=t.attributes[Se.SpanAttribute.HttpPort]||u.port||null,p=u.pathname||"/",f=o+" "+p,h=Se.DependencyTypeName.Http,m=l?(c+":"+l).toString():c.toString(),E=u.toString(),I=t.attributes[Se.SpanAttribute.HttpStatusCode]||t.status.code||0,q=I<400;return{id:e,name:f,dependencyTypeName:h,target:m,data:E,success:q,duration:r,url:E,resultCode:String(I),properties:ja(t.attributes)}}else if(a){var o=t.attributes[Se.SpanAttribute.GrpcMethod]||"rpc",Q=t.attributes[Se.SpanAttribute.GrpcService],U=Q?o+" "+Q:t.name;return{id:e,duration:r,name:U,target:Q.toString(),data:Q.toString()||U,url:Q.toString()||U,dependencyTypeName:Se.DependencyTypeName.Grpc,resultCode:String(t.status.code||0),success:t.status.code===0,properties:ja(t.attributes)}}else{var le=t.name,ve=t.links&&t.links.map(function(He){return{operation_Id:He.context.traceId,id:He.context.spanId}});return{id:e,duration:r,name:le,target:n,data:n||le,url:n||le,dependencyTypeName:t.kind===Zm.SpanKind.INTERNAL?Se.DependencyTypeName.InProc:i||t.name,resultCode:String(t.status.code||0),success:t.status.code===0,properties:Hl({},ja(t.attributes),{"_MS.links":ve||void 0})}}}ln.spanToTelemetryContract=ey});var $l=d(gr=>{"use strict";Object.defineProperty(gr,"__esModule",{value:!0});var Ul=J(),ty=Qr(),ry=jl(),Ai=$n(),vr=[];gr.subscriber=function(t){var e=t.data,r=ry.spanToTelemetryContract(e),n=e.context(),i=new ty;i.traceId=n.traceId,i.spanId=n.spanId,i.traceFlag=n.traceFlags.toString(),i.parentId=e.parentSpanId?"|"+n.traceId+"."+e.parentSpanId+".":null,Ai.AsyncScopeManager.with(e,function(){vr.forEach(function(s){e.kind===Ai.SpanKind.SERVER?s.trackRequest(r):(e.kind===Ai.SpanKind.CLIENT||e.kind===Ai.SpanKind.INTERNAL)&&s.trackDependency(r)})})};function ny(t,e){t?(vr.length===0&&Ul.channel.subscribe("azure-coretracing",gr.subscriber),vr.push(e)):(vr=vr.filter(function(r){return r!=e}),vr.length===0&&Ul.channel.unsubscribe("azure-coretracing",gr.subscriber))}gr.enable=ny});var Bl=d(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});var Vl=J(),mr=[];yr.subscriber=function(t){t.data.event.commandName!=="ismaster"&&mr.forEach(function(e){var r=t.data.startedData&&t.data.startedData.databaseName||"Unknown database";e.trackDependency({target:r,data:t.data.event.commandName,name:t.data.event.commandName,duration:t.data.event.duration,success:t.data.succeeded,resultCode:t.data.succeeded?"0":"1",time:t.data.startedData.time,dependencyTypeName:"mongodb"})})};function iy(t,e){t?(mr.length===0&&Vl.channel.subscribe("mongodb",yr.subscriber),mr.push(e)):(mr=mr.filter(function(r){return r!=e}),mr.length===0&&Vl.channel.unsubscribe("mongodb",yr.subscriber))}yr.enable=iy});var zl=d(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});var Gl=J(),_r=[];Cr.subscriber=function(t){_r.forEach(function(e){var r=t.data.query||{},n=r.sql||"Unknown query",i=!t.data.err,s=r._connection||{},a=s.config||{},o=a.socketPath?a.socketPath:(a.host||"localhost")+":"+a.port;e.trackDependency({target:o,data:n,name:n,duration:t.data.duration,success:i,resultCode:i?"0":"1",time:t.data.time,dependencyTypeName:"mysql"})})};function sy(t,e){t?(_r.length===0&&Gl.channel.subscribe("mysql",Cr.subscriber),_r.push(e)):(_r=_r.filter(function(r){return r!=e}),_r.length===0&&Gl.channel.unsubscribe("mysql",Cr.subscriber))}Cr.enable=sy});var Wl=d(br=>{"use strict";Object.defineProperty(br,"__esModule",{value:!0});var Ql=J(),Er=[];br.subscriber=function(t){Er.forEach(function(e){t.data.commandObj.command!=="info"&&e.trackDependency({target:t.data.address,name:t.data.commandObj.command,data:t.data.commandObj.command,duration:t.data.duration,success:!t.data.err,resultCode:t.data.err?"1":"0",time:t.data.time,dependencyTypeName:"redis"})})};function ay(t,e){t?(Er.length===0&&Ql.channel.subscribe("redis",br.subscriber),Er.push(e)):(Er=Er.filter(function(r){return r!=e}),Er.length===0&&Ql.channel.unsubscribe("redis",br.subscriber))}br.enable=ay});var Xl=d(wr=>{"use strict";Object.defineProperty(wr,"__esModule",{value:!0});var Kl=J(),Tr=[];wr.subscriber=function(t){Tr.forEach(function(e){var r=t.data.query,n=r.preparable&&r.preparable.text||r.plan||r.text||"unknown query",i=!t.data.error,s=t.data.database.host+":"+t.data.database.port;e.trackDependency({target:s,data:n,name:n,duration:t.data.duration,success:i,resultCode:i?"0":"1",time:t.data.time,dependencyTypeName:"postgres"})})};function oy(t,e){t?(Tr.length===0&&Kl.channel.subscribe("postgres",wr.subscriber),Tr.push(e)):(Tr=Tr.filter(function(r){return r!=e}),Tr.length===0&&Kl.channel.unsubscribe("postgres",wr.subscriber))}wr.enable=oy});var xr=d((q0,ep)=>{"use strict";var Ht=require("http"),Ir=require("https"),Ua=ae(),Yl=Ae(),Ct=ur(),uy=Fl(),Jl=wt(),Zl=At(),$a=Qr(),cy=si(),ly=function(){function t(e){if(t.INSTANCE)throw new Error("Client request tracking should be configured from the applicationInsights object");t.INSTANCE=this,this._client=e}return t.prototype.enable=function(e){this._isEnabled=e,this._isEnabled&&!this._isInitialized&&this._initialize(),cy.IsInitialized&&($l().enable(!0,this._client),Bl().enable(e,this._client),zl().enable(e,this._client),Wl().enable(e,this._client),Xl().enable(e,this._client))},t.prototype.isInitialized=function(){return this._isInitialized},t.prototype._initialize=function(){var e=this;this._isInitialized=!0;var r=Ht.get,n=Ht.request,i=Ir.request,s=function(a,o){var u=!o[t.disableCollectionRequestOption]&&!a[t.alreadyAutoCollectedFlag];o.headers&&o.headers["user-agent"]&&o.headers["user-agent"].toString().indexOf("azsdk-js")!==-1&&(u=!1),a[t.alreadyAutoCollectedFlag]=!0,a&&o&&u&&(Jl.CorrelationContextManager.wrapEmitter(a),t.trackRequest(e._client,{options:o,request:a}))};Ht.request=function(a){for(var o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];var c=n.call.apply(n,[Ht,a].concat(o));return s(c,a),c},Ir.request=function(a){for(var o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];var c=i.call.apply(i,[Ir,a].concat(o));return s(c,a),c},Ht.get=function(a){for(var o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];var c=(l=Ht.request).call.apply(l,[Ht,a].concat(o));return c.end(),c;var l},Ir.get=function(a){for(var o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];var c=(l=Ir.request).call.apply(l,[Ir,a].concat(o));return c.end(),c;var l}},t.trackRequest=function(e,r){if(!r.options||!r.request||!e){Ua.info("AutoCollectHttpDependencies.trackRequest was called with invalid parameters: ",!r.options,!r.request,!e);return}var n=new uy(r.options,r.request),i=Jl.CorrelationContextManager.getCurrentContext(),s,a;if(i&&i.operation&&i.operation.traceparent&&$a.isValidTraceId(i.operation.traceparent.traceId))i.operation.traceparent.updateSpanId(),s=i.operation.traceparent.getBackCompatRequestId();else if(Zl.w3cEnabled){var o=new $a;a=o.toString(),s=o.getBackCompatRequestId()}else s=i&&i.operation&&i.operation.parentId+t.requestNumber+++".";if(Yl.canIncludeCorrelationHeader(e,n.getUrl())&&r.request.getHeader&&r.request.setHeader&&e.config&&e.config.correlationId){var u=r.request.getHeader(Ct.requestContextHeader);try{Yl.safeIncludeCorrelationHeader(e,r.request,u)}catch(p){Ua.warn("Request-Context header could not be set. Correlation of requests may be lost",p)}if(i&&i.operation)try{if(r.request.setHeader(Ct.requestIdHeader,s),e.config.ignoreLegacyHeaders||(r.request.setHeader(Ct.parentIdHeader,i.operation.id),r.request.setHeader(Ct.rootIdHeader,s)),a||i.operation.traceparent)r.request.setHeader(Ct.traceparentHeader,a||i.operation.traceparent.toString());else if(Zl.w3cEnabled){var o=new $a().toString();r.request.setHeader(Ct.traceparentHeader,o)}if(i.operation.tracestate){var c=i.operation.tracestate.toString();c&&r.request.setHeader(Ct.traceStateHeader,c)}var l=i.customProperties.serializeToHeader();l&&r.request.setHeader(Ct.correlationContextHeader,l)}catch(p){Ua.warn("Correlation headers could not be set. Correlation of requests may be lost.",p)}}r.request.on&&(r.request.on("response",function(p){n.onResponse(p);var f=n.getDependencyTelemetry(r,s);f.contextObjects=f.contextObjects||{},f.contextObjects["http.RequestOptions"]=r.options,f.contextObjects["http.ClientRequest"]=r.request,f.contextObjects["http.ClientResponse"]=p,e.trackDependency(f)}),r.request.on("error",function(p){n.onError(p);var f=n.getDependencyTelemetry(r,s);f.contextObjects=f.contextObjects||{},f.contextObjects["http.RequestOptions"]=r.options,f.contextObjects["http.ClientRequest"]=r.request,f.contextObjects.Error=p,e.trackDependency(f)}))},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t.disableCollectionRequestOption="disableAppInsightsAutoCollection",t.requestNumber=1,t.alreadyAutoCollectedFlag="_appInsightsAutoCollected",t}();ep.exports=ly});var np=d((N0,rp)=>{"use strict";var py=require("os"),tp=_t(),fy=Ae(),dy=cn(),hy=xr(),vy="http://169.254.169.254/metadata/instance/compute",gy="api-version=2017-12-01",my="format=json",yy="ENETUNREACH",_y=function(){function t(e){this._collectionInterval=9e5,this._vmData={},this._azInst_vmId="",this._azInst_subscriptionId="",this._azInst_osType="",t.INSTANCE||(t.INSTANCE=this),this._isInitialized=!1,this._client=e}return t.prototype.enable=function(e,r){var n=this;this._isEnabled=e,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),e?this._handle||(this._handle=setInterval(function(){return n.trackHeartBeat(r,function(){})},this._collectionInterval),this._handle.unref()):this._handle&&(clearInterval(this._handle),this._handle=null)},t.prototype.isInitialized=function(){return this._isInitialized},t.isEnabled=function(){return t.INSTANCE&&t.INSTANCE._isEnabled},t.prototype.trackHeartBeat=function(e,r){var n=this,i=!1,s={},a=dy.sdkVersion;s.sdk=a,s.osType=py.type(),process.env.WEBSITE_SITE_NAME?(s.appSrv_SiteName=process.env.WEBSITE_SITE_NAME||"",s.appSrv_wsStamp=process.env.WEBSITE_HOME_STAMPNAME||"",s.appSrv_wsHost=process.env.WEBSITE_HOSTNAME||""):process.env.FUNCTIONS_WORKER_RUNTIME?s.azfunction_appId=process.env.WEBSITE_HOSTNAME:e&&(this._isVM===void 0?(i=!0,this._getAzureComputeMetadata(e,function(){n._isVM&&Object.keys(n._vmData).length>0&&(s.azInst_vmId=n._vmData.vmId||"",s.azInst_subscriptionId=n._vmData.subscriptionId||"",s.azInst_osType=n._vmData.osType||"",n._azInst_vmId=n._vmData.vmId||"",n._azInst_subscriptionId=n._vmData.subscriptionId||"",n._azInst_osType=n._vmData.osType||""),n._client.trackMetric({name:tp.HeartBeatMetricName,value:0,properties:s}),r()})):this._isVM&&(s.azInst_vmId=this._azInst_vmId,s.azInst_subscriptionId=this._azInst_subscriptionId,s.azInst_osType=this._azInst_osType)),i||(this._client.trackMetric({name:tp.HeartBeatMetricName,value:0,properties:s}),r())},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1},t.prototype._getAzureComputeMetadata=function(e,r){var n=this,i=vy+"?"+gy+"&"+my,s=(o={method:"GET"},o[hy.disableCollectionRequestOption]=!0,o.headers={Metadata:"True"},o),a=fy.makeRequest(e,i,s,function(u){if(u.statusCode===200){n._isVM=!0;var c="";u.on("data",function(l){c+=l}),u.on("end",function(){n._vmData=n._isJSON(c)?JSON.parse(c):{},r()})}else r()});a&&(a.on("error",function(u){u&&u.message&&u.message.indexOf(yy)>-1&&(n._isVM=!1),r()}),a.end());var o},t.prototype._isJSON=function(e){try{return JSON.parse(e)&&!!e}catch{return!1}},t}();rp.exports=_y});var Ba=d((L0,up)=>{"use strict";var ip=require("http"),sp=require("https"),ap=ae(),op=Ae(),Cy=ur(),Va=ta(),ct=wt(),Ey=Pi(),by=function(){function t(e){if(t.INSTANCE)throw new Error("Server request tracking should be configured from the applicationInsights object");t.INSTANCE=this,this._client=e}return t.prototype.enable=function(e){this._isEnabled=e,(this._isAutoCorrelating||this._isEnabled||Ey.isEnabled())&&!this._isInitialized&&(this.useAutoCorrelation(this._isAutoCorrelating),this._initialize())},t.prototype.useAutoCorrelation=function(e,r){e&&!this._isAutoCorrelating?ct.CorrelationContextManager.enable(r):!e&&this._isAutoCorrelating&&ct.CorrelationContextManager.disable(),this._isAutoCorrelating=e},t.prototype.isInitialized=function(){return this._isInitialized},t.prototype.isAutoCorrelating=function(){return this._isAutoCorrelating},t.prototype._generateCorrelationContext=function(e){if(!!this._isAutoCorrelating)return ct.CorrelationContextManager.generateContextObject(e.getOperationId(this._client.context.tags),e.getRequestId(),e.getOperationName(this._client.context.tags),e.getCorrelationContextHeader(),e.getTraceparent(),e.getTracestate())},t.prototype._initialize=function(){var e=this;this._isInitialized=!0;var r=function(a){if(!!a){if(typeof a!="function")throw new Error("onRequest handler must be a function");return function(o,u){ct.CorrelationContextManager.wrapEmitter(o),ct.CorrelationContextManager.wrapEmitter(u);var c=o&&!o[t.alreadyAutoCollectedFlag];if(o&&c){var l=new Va(o),p=e._generateCorrelationContext(l);ct.CorrelationContextManager.runWithContext(p,function(){e._isEnabled&&(o[t.alreadyAutoCollectedFlag]=!0,t.trackRequest(e._client,{request:o,response:u},l)),typeof a=="function"&&a(o,u)})}else typeof a=="function"&&a(o,u)}}},n=function(a){var o=a.addListener.bind(a);a.addListener=function(u,c){switch(u){case"request":case"checkContinue":return o(u,r(c));default:return o(u,c)}},a.on=a.addListener},i=ip.createServer;ip.createServer=function(a,o){if(o&&typeof o=="function"){var u=i(a,r(o));return n(u),u}else{var u=i(r(a));return n(u),u}};var s=sp.createServer;sp.createServer=function(a,o){var u=s(a,r(o));return n(u),u}},t.trackRequestSync=function(e,r){if(!r.request||!r.response||!e){ap.info("AutoCollectHttpRequests.trackRequestSync was called with invalid parameters: ",!r.request,!r.response,!e);return}t.addResponseCorrelationIdHeader(e,r.response);var n=ct.CorrelationContextManager.getCurrentContext(),i=new Va(r.request,n&&n.operation.parentId);n&&(n.operation.id=i.getOperationId(e.context.tags)||n.operation.id,n.operation.name=i.getOperationName(e.context.tags)||n.operation.name,n.operation.parentId=i.getRequestId()||n.operation.parentId,n.customProperties.addHeaderData(i.getCorrelationContextHeader())),t.endRequest(e,i,r,r.duration,r.error)},t.trackRequest=function(e,r,n){if(!r.request||!r.response||!e){ap.info("AutoCollectHttpRequests.trackRequest was called with invalid parameters: ",!r.request,!r.response,!e);return}var i=ct.CorrelationContextManager.getCurrentContext(),s=n||new Va(r.request,i&&i.operation.parentId);op.canIncludeCorrelationHeader(e,s.getUrl())&&t.addResponseCorrelationIdHeader(e,r.response),i&&!n&&(i.operation.id=s.getOperationId(e.context.tags)||i.operation.id,i.operation.name=s.getOperationName(e.context.tags)||i.operation.name,i.operation.parentId=s.getOperationParentId(e.context.tags)||i.operation.parentId,i.customProperties.addHeaderData(s.getCorrelationContextHeader())),r.response.once&&r.response.once("finish",function(){t.endRequest(e,s,r,null,null)}),r.request.on&&r.request.on("error",function(a){t.endRequest(e,s,r,null,a)})},t.addResponseCorrelationIdHeader=function(e,r){if(e.config&&e.config.correlationId&&r.getHeader&&r.setHeader&&!r.headersSent){var n=r.getHeader(Cy.requestContextHeader);op.safeIncludeCorrelationHeader(e,r,n)}},t.endRequest=function(e,r,n,i,s){s?r.onError(s,i):r.onResponse(n.response,i);var a=r.getRequestTelemetry(n);if(a.tagOverrides=r.getRequestTags(e.context.tags),n.tagOverrides)for(var o in n.tagOverrides)a.tagOverrides[o]=n.tagOverrides[o];var u=r.getLegacyRootId();u&&(a.properties.ai_legacyRootId=u),a.contextObjects=a.contextObjects||{},a.contextObjects["http.ServerRequest"]=n.request,a.contextObjects["http.ServerResponse"]=n.response,e.trackRequest(a)},t.prototype.dispose=function(){t.INSTANCE=null,this.enable(!1),this._isInitialized=!1,ct.CorrelationContextManager.disable(),this._isAutoCorrelating=!1},t.alreadyAutoCollectedFlag="_appInsightsAutoCollected",t}();up.exports=by});var pp=d((M0,lp)=>{"use strict";var cp=_t(),Ty=function(){function t(){}return t.parse=function(e){if(!e)return{};var r=e.split(t._FIELDS_SEPARATOR),n=r.reduce(function(s,a){var o=a.split(t._FIELD_KEY_VALUE_SEPARATOR);if(o.length===2){var u=o[0].toLowerCase(),c=o[1];s[u]=c}return s},{});if(Object.keys(n).length>0){if(n.endpointsuffix){var i=n.location?n.location+".":"";n.ingestionendpoint=n.ingestionendpoint||"https://"+i+"dc."+n.endpointsuffix,n.liveendpoint=n.liveendpoint||"https://"+i+"live."+n.endpointsuffix}n.ingestionendpoint=n.ingestionendpoint||cp.DEFAULT_BREEZE_ENDPOINT,n.liveendpoint=n.liveendpoint||cp.DEFAULT_LIVEMETRICS_ENDPOINT}return n},t._FIELDS_SEPARATOR=";",t._FIELD_KEY_VALUE_SEPARATOR="=",t}();lp.exports=Ty});var Di=d((F0,hp)=>{"use strict";var Ga=At(),fp=pp(),wy=ae(),dp=_t(),Iy=require("url"),xy=function(){function t(e){var r=this;this.endpointBase=dp.DEFAULT_BREEZE_ENDPOINT;var n=process.env[t.ENV_connectionString],i=fp.parse(e),s=fp.parse(n),a=!i.instrumentationkey&&Object.keys(i).length>0?null:e;this.instrumentationKey=i.instrumentationkey||a||s.instrumentationkey||t._getInstrumentationKey(),t._validateInstrumentationKey(this.instrumentationKey)||wy.warn("An invalid instrumentation key was provided. There may be resulting telemetry loss",this.instrumentationKey),this.endpointUrl=(i.ingestionendpoint||s.ingestionendpoint||this.endpointBase)+"/v2/track",this.maxBatchSize=250,this.maxBatchIntervalMs=15e3,this.disableAppInsights=!1,this.samplingPercentage=100,this.correlationIdRetryIntervalMs=30*1e3,this.correlationHeaderExcludedDomains=["*.core.windows.net","*.core.chinacloudapi.cn","*.core.cloudapi.de","*.core.usgovcloudapi.net","*.core.microsoft.scloud","*.core.eaglex.ic.gov"],this.setCorrelationId=function(o){return r.correlationId=o},this.proxyHttpUrl=process.env[t.ENV_http_proxy]||void 0,this.proxyHttpsUrl=process.env[t.ENV_https_proxy]||void 0,this.httpAgent=void 0,this.httpsAgent=void 0,this.profileQueryEndpoint=i.ingestionendpoint||s.ingestionendpoint||process.env[t.ENV_profileQueryEndpoint]||this.endpointBase,this._quickPulseHost=i.liveendpoint||s.liveendpoint||process.env[t.ENV_quickPulseHost]||dp.DEFAULT_LIVEMETRICS_HOST,this._quickPulseHost.match(/^https?:\/\//)&&(this._quickPulseHost=Iy.parse(this._quickPulseHost).host)}return Object.defineProperty(t.prototype,"profileQueryEndpoint",{get:function(){return this._profileQueryEndpoint},set:function(e){Ga.cancelCorrelationIdQuery(this,this.setCorrelationId),this._profileQueryEndpoint=e,this.correlationId=Ga.correlationIdPrefix,Ga.queryCorrelationId(this,this.setCorrelationId)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quickPulseHost",{get:function(){return this._quickPulseHost},set:function(e){this._quickPulseHost=e},enumerable:!0,configurable:!0}),t._getInstrumentationKey=function(){var e=process.env[t.ENV_iKey]||process.env[t.ENV_azurePrefix+t.ENV_iKey]||process.env[t.legacy_ENV_iKey]||process.env[t.ENV_azurePrefix+t.legacy_ENV_iKey];if(!e||e=="")throw new Error("Instrumentation key not found, pass the key in the config to this method or set the key in the environment variable APPINSIGHTS_INSTRUMENTATIONKEY before starting the server");return e},t._validateInstrumentationKey=function(e){var r="^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",n=new RegExp(r);return n.test(e)},t.ENV_azurePrefix="APPSETTING_",t.ENV_iKey="APPINSIGHTS_INSTRUMENTATIONKEY",t.legacy_ENV_iKey="APPINSIGHTS_INSTRUMENTATION_KEY",t.ENV_profileQueryEndpoint="APPINSIGHTS_PROFILE_QUERY_ENDPOINT",t.ENV_quickPulseHost="APPINSIGHTS_QUICKPULSE_HOST",t.ENV_connectionString="APPLICATIONINSIGHTS_CONNECTION_STRING",t.ENV_nativeMetricsDisablers="APPLICATION_INSIGHTS_DISABLE_EXTENDED_METRIC",t.ENV_nativeMetricsDisableAll="APPLICATION_INSIGHTS_DISABLE_ALL_EXTENDED_METRICS",t.ENV_http_proxy="http_proxy",t.ENV_https_proxy="https_proxy",t}();hp.exports=xy});var mp=d((Qa,gp)=>{"use strict";var pn=Qa&&Qa.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},za=require("os"),jt=De(),vp=_t(),ky=Ae(),Sy=ae(),Py=ky.w3cTraceId(),Ay=function(){function t(){}return t.createQuickPulseEnvelope=function(e,r,n,i){var s=za&&typeof za.hostname=="function"&&za.hostname()||"Unknown",a=i.tags&&i.keys&&i.keys.cloudRoleInstance&&i.tags[i.keys.cloudRoleInstance]||s,o={Documents:r.length>0?r:null,InstrumentationKey:n.instrumentationKey||"",Metrics:e.length>0?e:null,InvariantVersion:1,Timestamp:"/Date("+Date.now()+")/",Version:i.tags[i.keys.internalSdkVersion],StreamId:Py,MachineName:s,Instance:a};return o},t.createQuickPulseMetric=function(e){var r;return r={Name:e.name,Value:e.value,Weight:e.count||1},r},t.telemetryEnvelopeToQuickPulseDocument=function(e){switch(e.data.baseType){case jt.TelemetryTypeString.Event:return t.createQuickPulseEventDocument(e);case jt.TelemetryTypeString.Exception:return t.createQuickPulseExceptionDocument(e);case jt.TelemetryTypeString.Trace:return t.createQuickPulseTraceDocument(e);case jt.TelemetryTypeString.Dependency:return t.createQuickPulseDependencyDocument(e);case jt.TelemetryTypeString.Request:return t.createQuickPulseRequestDocument(e)}return null},t.createQuickPulseEventDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData.name,i=pn({},r,{Name:n});return i},t.createQuickPulseTraceDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData.severityLevel||0,i=pn({},r,{Message:e.data.baseData.message,SeverityLevel:jt.SeverityLevel[n]});return i},t.createQuickPulseExceptionDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData.exceptions,i="",s="",a="";n&&n.length>0&&(n[0].parsedStack&&n[0].parsedStack.length>0?n[0].parsedStack.forEach(function(u){i+=u.assembly+`
`}):n[0].stack&&n[0].stack.length>0&&(i=n[0].stack),s=n[0].message,a=n[0].typeName);var o=pn({},r,{Exception:i,ExceptionMessage:s,ExceptionType:a});return o},t.createQuickPulseRequestDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData,i=pn({},r,{Name:n.name,Success:n.success,Duration:n.duration,ResponseCode:n.responseCode,OperationName:n.name});return i},t.createQuickPulseDependencyDocument=function(e){var r=t.createQuickPulseDocument(e),n=e.data.baseData,i=pn({},r,{Name:n.name,Target:n.target,Success:n.success,Duration:n.duration,ResultCode:n.resultCode,CommandName:n.data,OperationName:r.OperationId,DependencyTypeName:n.type});return i},t.createQuickPulseDocument=function(e){var r,n,i,s;e.data.baseType?(n=vp.TelemetryTypeStringToQuickPulseType[e.data.baseType],r=vp.TelemetryTypeStringToQuickPulseDocumentType[e.data.baseType]):Sy.warn("Document type invalid; not sending live metric document",e.data.baseType),i=e.tags[t.keys.operationId],s=t.aggregateProperties(e);var a={DocumentType:r,__type:n,OperationId:i,Version:"1.0",Properties:s};return a},t.aggregateProperties=function(e){var r=[],n=e.data.baseData.measurements||{};for(var i in n)if(n.hasOwnProperty(i)){var s=n[i],a={key:i,value:s};r.push(a)}var o=e.data.baseData.properties||{};for(var i in o)if(o.hasOwnProperty(i)){var s=o[i],a={key:i,value:s};r.push(a)}return r},t.keys=new jt.ContextTagKeys,t}();gp.exports=Ay});var _p=d((H0,yp)=>{"use strict";var Dy=function(){return(Date.now()+621355968e5)*1e4};yp.exports={getTransmissionTime:Dy}});var bp=d((j0,Ep)=>{"use strict";var Ry=require("https"),Oy=xr(),Cp=ae(),qy=_p(),Ny=Ae(),Wa={method:"POST",time:"x-ms-qps-transmission-time",subscribed:"x-ms-qps-subscribed"},Ly=function(){function t(e){this._config=e,this._consecutiveErrors=0}return t.prototype.ping=function(e,r){this._submitData(e,r,"ping")},t.prototype.post=function(e,r){this._submitData([e],r,"post")},t.prototype._submitData=function(e,r,n){var i=this,s=JSON.stringify(e),a=(u={},u[Oy.disableCollectionRequestOption]=!0,u.host=this._config.quickPulseHost,u.method=Wa.method,u.path="/QuickPulseService.svc/"+n+"?ikey="+this._config.instrumentationKey,u.headers=(c={Expect:"100-continue"},c[Wa.time]=qy.getTransmissionTime(),c["Content-Type"]="application/json",c["Content-Length"]=Buffer.byteLength(s),c),u);this._config.httpsAgent?a.agent=this._config.httpsAgent:a.agent=Ny.tlsRestrictedAgent;var o=Ry.request(a,function(l){var p=l.headers[Wa.subscribed]==="true";i._consecutiveErrors=0,r(p,l)});o.on("error",function(l){i._consecutiveErrors++;var p="Transient error connecting to the Live Metrics endpoint. This packet will not appear in your Live Metrics Stream. Error:";i._consecutiveErrors%t.MAX_QPS_FAILURES_BEFORE_WARN===0?(p="Live Metrics endpoint could not be reached "+i._consecutiveErrors+" consecutive times. Most recent error:",Cp.warn(t.TAG,p,l)):Cp.info(t.TAG,p,l),r()}),o.write(s),o.end();var u,c},t.TAG="QuickPulseSender",t.MAX_QPS_FAILURES_BEFORE_WARN=25,t}();Ep.exports=Ly});var wp=d((U0,Tp)=>{"use strict";var My=ae(),Fy=Di(),Ka=mp(),Hy=bp(),jy=_t(),Uy=cn(),$y=function(){function t(e,r){this._isCollectingData=!1,this._lastSuccessTime=Date.now(),this._lastSendSucceeded=!0,this._metrics={},this._documents=[],this._collectors=[],this.config=new Fy(e),this.context=r||new Uy,this._sender=new Hy(this.config),this._isEnabled=!1}return t.prototype.addCollector=function(e){this._collectors.push(e)},t.prototype.trackMetric=function(e){this._addMetric(e)},t.prototype.addDocument=function(e){var r=Ka.telemetryEnvelopeToQuickPulseDocument(e);r&&this._documents.push(r)},t.prototype.enable=function(e){e&&!this._isEnabled?(this._isEnabled=!0,this._goQuickPulse()):!e&&this._isEnabled&&(this._isEnabled=!1,clearTimeout(this._handle),this._handle=void 0)},t.prototype.enableCollectors=function(e){this._collectors.forEach(function(r){r.enable(e)})},t.prototype._addMetric=function(e){var r=e.value,n=e.count||1,i=jy.PerformanceToQuickPulseCounter[e.name];i&&(this._metrics[i]?(this._metrics[i].Value=(this._metrics[i].Value*this._metrics[i].Weight+r*n)/(this._metrics[i].Weight+n),this._metrics[i].Weight+=n):(this._metrics[i]=Ka.createQuickPulseMetric(e),this._metrics[i].Name=i,this._metrics[i].Weight=1))},t.prototype._resetQuickPulseBuffer=function(){delete this._metrics,this._metrics={},this._documents.length=0},t.prototype._goQuickPulse=function(){var e=this,r=Object.keys(this._metrics).map(function(s){return e._metrics[s]}),n=Ka.createQuickPulseEnvelope(r,this._documents.slice(),this.config,this.context);this._resetQuickPulseBuffer(),this._isCollectingData?this._post(n):this._ping(n);var i=this._isCollectingData?t.POST_INTERVAL:t.PING_INTERVAL;this._isCollectingData&&Date.now()-this._lastSuccessTime>=t.MAX_POST_WAIT_TIME&&!this._lastSendSucceeded?(this._isCollectingData=!1,i=t.FALLBACK_INTERVAL):!this._isCollectingData&&Date.now()-this._lastSuccessTime>=t.MAX_PING_WAIT_TIME&&!this._lastSendSucceeded&&(i=t.FALLBACK_INTERVAL),this._lastSendSucceeded=null,this._handle=setTimeout(this._goQuickPulse.bind(this),i),this._handle.unref()},t.prototype._ping=function(e){this._sender.ping(e,this._quickPulseDone.bind(this))},t.prototype._post=function(e){this._sender.post(e,this._quickPulseDone.bind(this))},t.prototype._quickPulseDone=function(e,r){e!=null?(this._isCollectingData!==e&&(My.info("Live Metrics sending data",e),this.enableCollectors(e)),this._isCollectingData=e,r&&r.statusCode<300&&r.statusCode>=200?(this._lastSuccessTime=Date.now(),this._lastSendSucceeded=!0):this._lastSendSucceeded=!1):this._lastSendSucceeded=!1},t.MAX_POST_WAIT_TIME=2e4,t.MAX_PING_WAIT_TIME=6e4,t.FALLBACK_INTERVAL=6e4,t.PING_INTERVAL=5e3,t.POST_INTERVAL=1e3,t}();Tp.exports=$y});var xp=d(dn=>{"use strict";var Vy=dn&&dn.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(dn,"__esModule",{value:!0});var Ip=Di(),fn=cn(),By=ae(),Gy=function(){function t(e){this._disabledMetrics={},t.INSTANCE&&t.INSTANCE.dispose(),t.INSTANCE=this,this._client=e}return t.isNodeVersionCompatible=function(){var e=process.versions.node.split(".");return parseInt(e[0])>=6},t.prototype.enable=function(e,r,n){var i=this;if(r===void 0&&(r={}),n===void 0&&(n=6e4),!!t.isNodeVersionCompatible()){if(t._metricsAvailable==null&&e&&!this._isInitialized)try{var s=require("applicationinsights-native-metrics");t._emitter=new s,t._metricsAvailable=!0,By.info("Native metrics module successfully loaded!")}catch{t._metricsAvailable=!1;return}this._isEnabled=e,this._disabledMetrics=r,this._isEnabled&&!this._isInitialized&&(this._isInitialized=!0),this._isEnabled&&t._emitter?(t._emitter.enable(!0,n),this._handle=setInterval(function(){return i._trackNativeMetrics()},n),this._handle.unref()):t._emitter&&(t._emitter.enable(!1),this._handle&&(clearInterval(this._handle),this._handle=void 0))}},t.prototype.dispose=function(){this.enable(!1)},t.parseEnabled=function(e){var r=process.env[Ip.ENV_nativeMetricsDisableAll],n=process.env[Ip.ENV_nativeMetricsDisablers];if(r)return{isEnabled:!1,disabledMetrics:{}};if(n){var i=n.split(","),s={};if(i.length>0)for(var a=0,o=i;a<o.length;a++){var u=o[a];s[u]=!0}return typeof e=="object"?{isEnabled:!0,disabledMetrics:Vy({},e,s)}:{isEnabled:e,disabledMetrics:s}}return typeof e=="boolean"?{isEnabled:e,disabledMetrics:{}}:{isEnabled:!0,disabledMetrics:e}},t.prototype._trackNativeMetrics=function(){var e=!0;typeof this._isEnabled!="object"&&(e=this._isEnabled),e&&(this._trackGarbageCollection(),this._trackEventLoop(),this._trackHeapUsage())},t.prototype._trackGarbageCollection=function(){if(!this._disabledMetrics.gc){var e=t._emitter.getGCData();for(var r in e){var n=e[r].metrics,i=r+" Garbage Collection Duration",s=Math.sqrt(n.sumSquares/n.count-Math.pow(n.total/n.count,2))||0;this._client.trackMetric({name:i,value:n.total,count:n.count,max:n.max,min:n.min,stdDev:s,tagOverrides:(a={},a[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+fn.sdkVersion,a)})}var a}},t.prototype._trackEventLoop=function(){if(!this._disabledMetrics.loop){var e=t._emitter.getLoopData(),r=e.loopUsage;if(r.count!=0){var n="Event Loop CPU Time",i=Math.sqrt(r.sumSquares/r.count-Math.pow(r.total/r.count,2))||0;this._client.trackMetric({name:n,value:r.total,count:r.count,min:r.min,max:r.max,stdDev:i,tagOverrides:(s={},s[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+fn.sdkVersion,s)});var s}}},t.prototype._trackHeapUsage=function(){if(!this._disabledMetrics.heap){var e=process.memoryUsage(),r=e.heapUsed,n=e.heapTotal,i=e.rss;this._client.trackMetric({name:"Memory Usage (Heap)",value:r,count:1,tagOverrides:(s={},s[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+fn.sdkVersion,s)}),this._client.trackMetric({name:"Memory Total (Heap)",value:n,count:1,tagOverrides:(a={},a[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+fn.sdkVersion,a)}),this._client.trackMetric({name:"Memory Usage (Non-Heap)",value:i-n,count:1,tagOverrides:(o={},o[this._client.context.keys.internalSdkVersion]="node-nativeperf:"+fn.sdkVersion,o)});var s,a,o}},t}();dn.AutoCollectNativePerformance=Gy});var Pp=d((V0,Sp)=>{"use strict";var kp=ae(),zy=function(){function t(e,r,n,i){this._buffer=[],this._lastSend=0,this._isDisabled=e,this._getBatchSize=r,this._getBatchIntervalMs=n,this._sender=i}return t.prototype.setUseDiskRetryCaching=function(e,r,n){this._sender.setDiskRetryMode(e,r,n)},t.prototype.send=function(e){var r=this;if(!this._isDisabled()){if(!e){kp.warn("Cannot send null/undefined telemetry");return}var n=this._stringify(e);if(typeof n=="string"){if(this._buffer.push(n),this._buffer.length>=this._getBatchSize()){this.triggerSend(!1);return}!this._timeoutHandle&&this._buffer.length>0&&(this._timeoutHandle=setTimeout(function(){r._timeoutHandle=null,r.triggerSend(!1)},this._getBatchIntervalMs()))}}},t.prototype.triggerSend=function(e,r){var n=this._buffer.length<1;if(!n){var i=this._buffer.join(`
`);e?(this._sender.saveOnCrash(i),typeof r=="function"&&r("data saved on crash")):this._sender.send(Buffer.from?Buffer.from(i):new Buffer(i),r)}this._lastSend=+new Date,this._buffer.length=0,clearTimeout(this._timeoutHandle),this._timeoutHandle=null,n&&typeof r=="function"&&r("no data to send")},t.prototype._stringify=function(e){try{return JSON.stringify(e)}catch(r){kp.warn("Failed to serialize payload",r,e)}},t}();Sp.exports=zy});var Ap=d(Xa=>{"use strict";Object.defineProperty(Xa,"__esModule",{value:!0});function Qy(t,e){process.env.WEBSITE_SITE_NAME&&(t.tags[e.keys.cloudRole]=process.env.WEBSITE_SITE_NAME)}Xa.azureRoleEnvironmentTelemetryProcessor=Qy});var Op=d(Ri=>{"use strict";Object.defineProperty(Ri,"__esModule",{value:!0});var Dp=De();function Wy(t,e){var r=t.sampleRate,n=!1;return r==null||r>=100||t.data&&Dp.TelemetryType.Metric===Dp.baseTypeToTelemetryType(t.data.baseType)?!0:(e.correlationContext&&e.correlationContext.operation?n=Rp(e.correlationContext.operation.id)<r:n=Math.random()*100<r,n)}Ri.samplingTelemetryProcessor=Wy;function Rp(t){var e=-2147483648,r=2147483647,n=5381;if(!t)return 0;for(;t.length<8;)t=t+t;for(var i=0;i<t.length;i++)n=((n<<5)+n|0)+t.charCodeAt(i)|0;return n=n<=e?r:Math.abs(n),n/r*100}Ri.getSamplingHashCode=Rp});var qp=d(Za=>{"use strict";Object.defineProperty(Za,"__esModule",{value:!0});var Ya=Pi(),Ja=De();function Ky(t,e){switch(e&&e.addDocument(t),t.data.baseType){case Ja.TelemetryTypeString.Exception:Ya.countException();break;case Ja.TelemetryTypeString.Request:var r=t.data.baseData;Ya.countRequest(r.duration,r.success);break;case Ja.TelemetryTypeString.Dependency:var n=t.data.baseData;Ya.countDependency(n.duration,n.success);break}return!0}Za.performanceMetricsTelemetryProcessor=Ky});var Np=d(Oi=>{"use strict";function eo(t){for(var e in t)Oi.hasOwnProperty(e)||(Oi[e]=t[e])}Object.defineProperty(Oi,"__esModule",{value:!0});eo(Ap());eo(Op());eo(qp())});var Mp=d((W0,Lp)=>{"use strict";var Te=require("fs"),qi=require("os"),lt=require("path"),Xy=require("zlib"),kr=require("child_process"),_e=ae(),Yy=xr(),Jy=Ae(),Zy=function(){function t(e,r,n){if(this._config=e,this._onSuccess=r,this._onError=n,this._enableDiskRetryMode=!1,this._resendInterval=t.WAIT_BETWEEN_RESEND,this._maxBytesOnDisk=t.MAX_BYTES_ON_DISK,this._numConsecutiveFailures=0,this._resendTimer=null,!t.OS_PROVIDES_FILE_PROTECTION)if(t.USE_ICACLS){try{t.OS_PROVIDES_FILE_PROTECTION=Te.existsSync(t.ICACLS_PATH)}catch{}t.OS_PROVIDES_FILE_PROTECTION||_e.warn(t.TAG,"Could not find ICACLS in expected location! This is necessary to use disk retry mode on Windows.")}else t.OS_PROVIDES_FILE_PROTECTION=!0}return t.prototype.setDiskRetryMode=function(e,r,n){this._enableDiskRetryMode=t.OS_PROVIDES_FILE_PROTECTION&&e,typeof r=="number"&&r>=0&&(this._resendInterval=Math.floor(r)),typeof n=="number"&&n>=0&&(this._maxBytesOnDisk=Math.floor(n)),e&&!t.OS_PROVIDES_FILE_PROTECTION&&(this._enableDiskRetryMode=!1,_e.warn(t.TAG,"Ignoring request to enable disk retry mode. Sufficient file protection capabilities were not detected."))},t.prototype.send=function(e,r){var n=this,i=this._config.endpointUrl,s={method:"POST",withCredentials:!1,headers:{"Content-Type":"application/x-json-stream"}};Xy.gzip(e,function(a,o){var u=o;a?(_e.warn(a),u=e,s.headers["Content-Length"]=e.length.toString()):(s.headers["Content-Encoding"]="gzip",s.headers["Content-Length"]=o.length),_e.info(t.TAG,s),s[Yy.disableCollectionRequestOption]=!0;var c=function(p){p.setEncoding("utf-8");var f="";p.on("data",function(h){f+=h}),p.on("end",function(){n._numConsecutiveFailures=0,_e.info(t.TAG,f),typeof n._onSuccess=="function"&&n._onSuccess(f),typeof r=="function"&&r(f),n._enableDiskRetryMode&&(p.statusCode===200?n._resendTimer||(n._resendTimer=setTimeout(function(){n._resendTimer=null,n._sendFirstFileOnDisk()},n._resendInterval),n._resendTimer.unref()):(p.statusCode===408||p.statusCode===429||p.statusCode===439||p.statusCode===500||p.statusCode===503)&&n._storeToDisk(e))})},l=Jy.makeRequest(n._config,i,s,c);l.on("error",function(p){if(n._numConsecutiveFailures++,!n._enableDiskRetryMode||n._numConsecutiveFailures>0&&n._numConsecutiveFailures%t.MAX_CONNECTION_FAILURES_BEFORE_WARN===0){var f="Ingestion endpoint could not be reached. This batch of telemetry items has been lost. Use Disk Retry Caching to enable resending of failed telemetry. Error:";n._enableDiskRetryMode&&(f="Ingestion endpoint could not be reached "+n._numConsecutiveFailures+" consecutive times. There may be resulting telemetry loss. Most recent error:"),_e.warn(t.TAG,f,p)}else{var f="Transient failure to reach ingestion endpoint. This batch of telemetry items will be retried. Error:";_e.info(t.TAG,f,p)}if(n._onErrorHelper(p),typeof r=="function"){var h="error sending telemetry";p&&typeof p.toString=="function"&&(h=p.toString()),r(h)}n._enableDiskRetryMode&&n._storeToDisk(e)}),l.write(u),l.end()})},t.prototype.saveOnCrash=function(e){this._enableDiskRetryMode&&this._storeToDiskSync(e)},t.prototype._runICACLS=function(e,r){var n=kr.spawn(t.ICACLS_PATH,e,{windowsHide:!0});n.on("error",function(i){return r(i)}),n.on("close",function(i,s){return r(i===0?null:new Error("Setting ACL restrictions did not succeed (ICACLS returned code "+i+")"))})},t.prototype._runICACLSSync=function(e){if(kr.spawnSync){var r=kr.spawnSync(t.ICACLS_PATH,e,{windowsHide:!0});if(r.error)throw r.error;if(r.status!==0)throw new Error("Setting ACL restrictions did not succeed (ICACLS returned code "+r.status+")")}else throw new Error("Could not synchronously call ICACLS under current version of Node.js")},t.prototype._getACLIdentity=function(e){if(t.ACL_IDENTITY)return e(null,t.ACL_IDENTITY);var r=kr.spawn(t.POWERSHELL_PATH,["-Command","[System.Security.Principal.WindowsIdentity]::GetCurrent().Name"],{windowsHide:!0,stdio:["ignore","pipe","pipe"]}),n="";r.stdout.on("data",function(i){return n+=i}),r.on("error",function(i){return e(i,null)}),r.on("close",function(i,s){return t.ACL_IDENTITY=n&&n.trim(),e(i===0?null:new Error("Getting ACL identity did not succeed (PS returned code "+i+")"),t.ACL_IDENTITY)})},t.prototype._getACLIdentitySync=function(){if(t.ACL_IDENTITY)return t.ACL_IDENTITY;if(kr.spawnSync){var e=kr.spawnSync(t.POWERSHELL_PATH,["-Command","[System.Security.Principal.WindowsIdentity]::GetCurrent().Name"],{windowsHide:!0,stdio:["ignore","pipe","pipe"]});if(e.error)throw e.error;if(e.status!==0)throw new Error("Getting ACL identity did not succeed (PS returned code "+e.status+")");return t.ACL_IDENTITY=e.stdout&&e.stdout.toString().trim(),t.ACL_IDENTITY}else throw new Error("Could not synchronously get ACL identity under current version of Node.js")},t.prototype._getACLArguments=function(e,r){return[e,"/grant","*S-1-5-32-544:(OI)(CI)F","/grant",r+":(OI)(CI)F","/inheritance:r"]},t.prototype._applyACLRules=function(e,r){var n=this;if(!t.USE_ICACLS)return r(null);if(t.ACLED_DIRECTORIES[e]===void 0)t.ACLED_DIRECTORIES[e]=!1,this._getACLIdentity(function(i,s){if(i)return t.ACLED_DIRECTORIES[e]=!1,r(i);n._runICACLS(n._getACLArguments(e,s),function(a){return t.ACLED_DIRECTORIES[e]=!a,r(a)})});else return r(t.ACLED_DIRECTORIES[e]?null:new Error("Setting ACL restrictions did not succeed (cached result)"))},t.prototype._applyACLRulesSync=function(e){if(t.USE_ICACLS){if(t.ACLED_DIRECTORIES[e]===void 0){this._runICACLSSync(this._getACLArguments(e,this._getACLIdentitySync())),t.ACLED_DIRECTORIES[e]=!0;return}else if(!t.ACLED_DIRECTORIES[e])throw new Error("Setting ACL restrictions did not succeed (cached result)")}},t.prototype._confirmDirExists=function(e,r){var n=this;Te.lstat(e,function(i,s){i&&i.code==="ENOENT"?Te.mkdir(e,function(a){a&&a.code!=="EEXIST"?r(a):n._applyACLRules(e,r)}):!i&&s.isDirectory()?n._applyACLRules(e,r):r(i||new Error("Path existed but was not a directory"))})},t.prototype._getShallowDirectorySize=function(e,r){Te.readdir(e,function(n,i){if(n)return r(n,-1);var s=null,a=0,o=0;if(i.length===0){r(null,0);return}for(var u=0;u<i.length;u++)Te.stat(lt.join(e,i[u]),function(c,l){o++,c?s=c:l.isFile()&&(a+=l.size),o===i.length&&(s?r(s,-1):r(s,a))})})},t.prototype._getShallowDirectorySizeSync=function(e){for(var r=Te.readdirSync(e),n=0,i=0;i<r.length;i++)n+=Te.statSync(lt.join(e,r[i])).size;return n},t.prototype._storeToDisk=function(e){var r=this,n=lt.join(qi.tmpdir(),t.TEMPDIR_PREFIX+this._config.instrumentationKey);_e.info(t.TAG,"Checking existence of data storage directory: "+n),this._confirmDirExists(n,function(i){if(i){_e.warn(t.TAG,"Error while checking/creating directory: "+(i&&i.message)),r._onErrorHelper(i);return}r._getShallowDirectorySize(n,function(s,a){if(s||a<0){_e.warn(t.TAG,"Error while checking directory size: "+(s&&s.message)),r._onErrorHelper(s);return}else if(a>r._maxBytesOnDisk){_e.warn(t.TAG,"Not saving data due to max size limit being met. Directory size in bytes is: "+a);return}var o=new Date().getTime()+".ai.json",u=lt.join(n,o);_e.info(t.TAG,"saving data to disk at: "+u),Te.writeFile(u,e,{mode:384},function(c){return r._onErrorHelper(c)})})})},t.prototype._storeToDiskSync=function(e){var r=lt.join(qi.tmpdir(),t.TEMPDIR_PREFIX+this._config.instrumentationKey);try{_e.info(t.TAG,"Checking existence of data storage directory: "+r),Te.existsSync(r)||Te.mkdirSync(r),this._applyACLRulesSync(r);var n=this._getShallowDirectorySizeSync(r);if(n>this._maxBytesOnDisk){_e.info(t.TAG,"Not saving data due to max size limit being met. Directory size in bytes is: "+n);return}var i=new Date().getTime()+".ai.json",s=lt.join(r,i);_e.info(t.TAG,"saving data before crash to disk at: "+s),Te.writeFileSync(s,e,{mode:384})}catch(a){_e.warn(t.TAG,"Error while saving data to disk: "+(a&&a.message)),this._onErrorHelper(a)}},t.prototype._sendFirstFileOnDisk=function(){var e=this,r=lt.join(qi.tmpdir(),t.TEMPDIR_PREFIX+this._config.instrumentationKey);Te.exists(r,function(n){n&&Te.readdir(r,function(i,s){if(i)e._onErrorHelper(i);else if(s=s.filter(function(u){return lt.basename(u).indexOf(".ai.json")>-1}),s.length>0){var a=s[0],o=lt.join(r,a);Te.readFile(o,function(u,c){u?e._onErrorHelper(u):Te.unlink(o,function(l){l?e._onErrorHelper(l):e.send(c)})})}})})},t.prototype._onErrorHelper=function(e){typeof this._onError=="function"&&this._onError(e)},t.TAG="Sender",t.ICACLS_PATH=process.env.systemdrive+"/windows/system32/icacls.exe",t.POWERSHELL_PATH=process.env.systemdrive+"/windows/system32/windowspowershell/v1.0/powershell.exe",t.ACLED_DIRECTORIES={},t.ACL_IDENTITY=null,t.WAIT_BETWEEN_RESEND=60*1e3,t.MAX_BYTES_ON_DISK=50*1e3*1e3,t.MAX_CONNECTION_FAILURES_BEFORE_WARN=5,t.TEMPDIR_PREFIX="appInsights-node",t.OS_PROVIDES_FILE_PROTECTION=!1,t.USE_ICACLS=qi.type()==="Windows_NT",t}();Lp.exports=Zy});var jp=d((K0,Hp)=>{"use strict";var w=De(),Me=Ae(),e_=wt(),t_=function(){function t(){}return t.createEnvelope=function(e,r,n,i,s){var a=null;switch(r){case w.TelemetryType.Trace:a=t.createTraceData(e);break;case w.TelemetryType.Dependency:a=t.createDependencyData(e);break;case w.TelemetryType.Event:a=t.createEventData(e);break;case w.TelemetryType.Exception:a=t.createExceptionData(e);break;case w.TelemetryType.Request:a=t.createRequestData(e);break;case w.TelemetryType.Metric:a=t.createMetricData(e);break;case w.TelemetryType.Availability:a=t.createAvailabilityData(e);break;case w.TelemetryType.PageView:a=t.createPageViewData(e);break}if(n&&w.domainSupportsProperties(a.baseData)){if(a&&a.baseData)if(!a.baseData.properties)a.baseData.properties=n;else for(var o in n)a.baseData.properties[o]||(a.baseData.properties[o]=n[o]);a.baseData.properties=Me.validateStringMap(a.baseData.properties)}var u=s&&s.instrumentationKey||"",c=new w.Envelope;return c.data=a,c.iKey=u,c.name="Microsoft.ApplicationInsights."+u.replace(/-/g,"")+"."+a.baseType.substr(0,a.baseType.length-4),c.tags=this.getTags(i,e.tagOverrides),c.time=new Date().toISOString(),c.ver=1,c.sampleRate=s?s.samplingPercentage:100,r===w.TelemetryType.Metric&&(c.sampleRate=100),c},t.createTraceData=function(e){var r=new w.MessageData;r.message=e.message,r.properties=e.properties,isNaN(e.severity)?r.severityLevel=w.SeverityLevel.Information:r.severityLevel=e.severity;var n=new w.Data;return n.baseType=w.telemetryTypeToBaseType(w.TelemetryType.Trace),n.baseData=r,n},t.createDependencyData=function(e){var r=new w.RemoteDependencyData;typeof e.name=="string"&&(r.name=e.name.length>1024?e.name.slice(0,1021)+"...":e.name),r.data=e.data,r.target=e.target,r.duration=Me.msToTimeSpan(e.duration),r.success=e.success,r.type=e.dependencyTypeName,r.properties=e.properties,r.resultCode=e.resultCode?e.resultCode+"":"",e.id?r.id=e.id:r.id=Me.w3cTraceId();var n=new w.Data;return n.baseType=w.telemetryTypeToBaseType(w.TelemetryType.Dependency),n.baseData=r,n},t.createEventData=function(e){var r=new w.EventData;r.name=e.name,r.properties=e.properties,r.measurements=e.measurements;var n=new w.Data;return n.baseType=w.telemetryTypeToBaseType(w.TelemetryType.Event),n.baseData=r,n},t.createExceptionData=function(e){var r=new w.ExceptionData;r.properties=e.properties,isNaN(e.severity)?r.severityLevel=w.SeverityLevel.Error:r.severityLevel=e.severity,r.measurements=e.measurements,r.exceptions=[];var n=e.exception.stack,i=new w.ExceptionDetails;i.message=e.exception.message,i.typeName=e.exception.name,i.parsedStack=this.parseStack(n),i.hasFullStack=Me.isArray(i.parsedStack)&&i.parsedStack.length>0,r.exceptions.push(i);var s=new w.Data;return s.baseType=w.telemetryTypeToBaseType(w.TelemetryType.Exception),s.baseData=r,s},t.createRequestData=function(e){var r=new w.RequestData;e.id?r.id=e.id:r.id=Me.w3cTraceId(),r.name=e.name,r.url=e.url,r.source=e.source,r.duration=Me.msToTimeSpan(e.duration),r.responseCode=e.resultCode?e.resultCode+"":"",r.success=e.success,r.properties=e.properties;var n=new w.Data;return n.baseType=w.telemetryTypeToBaseType(w.TelemetryType.Request),n.baseData=r,n},t.createMetricData=function(e){var r=new w.MetricData;r.metrics=[];var n=new w.DataPoint;n.count=isNaN(e.count)?1:e.count,n.kind=w.DataPointType.Aggregation,n.max=isNaN(e.max)?e.value:e.max,n.min=isNaN(e.min)?e.value:e.min,n.name=e.name,n.stdDev=isNaN(e.stdDev)?0:e.stdDev,n.value=e.value,r.metrics.push(n),r.properties=e.properties;var i=new w.Data;return i.baseType=w.telemetryTypeToBaseType(w.TelemetryType.Metric),i.baseData=r,i},t.createAvailabilityData=function(e){var r=new w.AvailabilityData;e.id?r.id=e.id:r.id=Me.w3cTraceId(),r.name=e.name,r.duration=Me.msToTimeSpan(e.duration),r.success=e.success,r.runLocation=e.runLocation,r.message=e.message,r.measurements=e.measurements,r.properties=e.properties;var n=new w.Data;return n.baseType=w.telemetryTypeToBaseType(w.TelemetryType.Availability),n.baseData=r,n},t.createPageViewData=function(e){var r=new w.PageViewData;r.name=e.name,r.duration=Me.msToTimeSpan(e.duration),r.url=e.url,r.measurements=e.measurements,r.properties=e.properties;var n=new w.Data;return n.baseType=w.telemetryTypeToBaseType(w.TelemetryType.PageView),n.baseData=r,n},t.getTags=function(e,r){var n=e_.CorrelationContextManager.getCurrentContext(),i={};if(e&&e.tags)for(var s in e.tags)i[s]=e.tags[s];if(r)for(var s in r)i[s]=r[s];return n&&(i[e.keys.operationId]=i[e.keys.operationId]||n.operation.id,i[e.keys.operationName]=i[e.keys.operationName]||n.operation.name,i[e.keys.operationParentId]=i[e.keys.operationParentId]||n.operation.parentId),i},t.parseStack=function(e){var r=void 0;if(typeof e=="string"){var n=e.split(`
`);r=[];for(var i=0,s=0,a=0;a<=n.length;a++){var o=n[a];if(Fp.regex.test(o)){var u=new Fp(n[a],i++);s+=u.sizeInBytes,r.push(u)}}var c=32*1024;if(s>c)for(var l=0,p=r.length-1,f=0,h=l,m=p;l<p;){var E=r[l].sizeInBytes,I=r[p].sizeInBytes;if(f+=E+I,f>c){var q=m-h+1;r.splice(h,q);break}h=l,m=p,l++,p--}}return r},t}(),Fp=function(){function t(e,r){this.sizeInBytes=0,this.level=r,this.method="<no_method>",this.assembly=Me.trim(e);var n=e.match(t.regex);n&&n.length>=5&&(this.method=Me.trim(n[2])||this.method,this.fileName=Me.trim(n[4])||"<no_filename>",this.line=parseInt(n[5])||0),this.sizeInBytes+=this.method.length,this.sizeInBytes+=this.fileName.length,this.sizeInBytes+=this.assembly.length,this.sizeInBytes+=t.baseSize,this.sizeInBytes+=this.level.toString().length,this.sizeInBytes+=this.line.toString().length}return t.regex=/^(\s+at)?(.*?)(\@|\s\(|\s)([^\(\n]+):(\d+):(\d+)(\)?)$/,t.baseSize=58,t}();Hp.exports=t_});var Bp=d((X0,Vp)=>{"use strict";var r_=require("url"),n_=Di(),i_=cn(),pt=De(),s_=Pp(),to=Np(),Up=wt(),a_=Mp(),o_=Ae(),$p=ae(),u_=jp(),c_=function(){function t(e){this._telemetryProcessors=[],this._enableAzureProperties=!1;var r=new n_(e);this.config=r,this.context=new i_,this.commonProperties={};var n=new a_(this.config);this.channel=new s_(function(){return r.disableAppInsights},function(){return r.maxBatchSize},function(){return r.maxBatchIntervalMs},n)}return t.prototype.trackAvailability=function(e){this.track(e,pt.TelemetryType.Availability)},t.prototype.trackPageView=function(e){this.track(e,pt.TelemetryType.PageView)},t.prototype.trackTrace=function(e){this.track(e,pt.TelemetryType.Trace)},t.prototype.trackMetric=function(e){this.track(e,pt.TelemetryType.Metric)},t.prototype.trackException=function(e){e&&e.exception&&!o_.isError(e.exception)&&(e.exception=new Error(e.exception.toString())),this.track(e,pt.TelemetryType.Exception)},t.prototype.trackEvent=function(e){this.track(e,pt.TelemetryType.Event)},t.prototype.trackRequest=function(e){this.track(e,pt.TelemetryType.Request)},t.prototype.trackDependency=function(e){e&&!e.target&&e.data&&(e.target=r_.parse(e.data).host),this.track(e,pt.TelemetryType.Dependency)},t.prototype.flush=function(e){this.channel.triggerSend(e?!!e.isAppCrashing:!1,e?e.callback:void 0)},t.prototype.track=function(e,r){if(e&&pt.telemetryTypeToBaseType(r)){var n=u_.createEnvelope(e,r,this.commonProperties,this.context,this.config);e.time&&(n.time=e.time.toISOString()),this._enableAzureProperties&&to.azureRoleEnvironmentTelemetryProcessor(n,this.context);var i=this.runTelemetryProcessors(n,e.contextObjects);i=i&&to.samplingTelemetryProcessor(n,{correlationContext:Up.CorrelationContextManager.getCurrentContext()}),i&&(to.performanceMetricsTelemetryProcessor(n,this.quickPulseClient),this.channel.send(n))}else $p.warn("track() requires telemetry object and telemetryType to be specified.")},t.prototype.setAutoPopulateAzureProperties=function(e){this._enableAzureProperties=e},t.prototype.addTelemetryProcessor=function(e){this._telemetryProcessors.push(e)},t.prototype.clearTelemetryProcessors=function(){this._telemetryProcessors=[]},t.prototype.runTelemetryProcessors=function(e,r){var n=!0,i=this._telemetryProcessors.length;if(i===0)return n;r=r||{},r.correlationContext=Up.CorrelationContextManager.getCurrentContext();for(var s=0;s<i;++s)try{var a=this._telemetryProcessors[s];if(a&&a.apply(null,[e,r])===!1){n=!1;break}}catch(o){n=!0,$p.warn("One of telemetry processors failed, telemetry item will be sent.",o,e)}return n},t}();Vp.exports=c_});var Qp=d((ro,zp)=>{"use strict";var l_=ro&&ro.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])};return function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),p_=Bp(),Gp=Ba(),f_=xr(),Ni=ae(),d_=function(t){l_(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.trackNodeHttpRequestSync=function(r){r&&r.request&&r.response&&r.duration?Gp.trackRequestSync(this,r):Ni.warn("trackNodeHttpRequestSync requires NodeHttpRequestTelemetry object with request, response and duration specified.")},e.prototype.trackNodeHttpRequest=function(r){(r.duration||r.error)&&Ni.warn("trackNodeHttpRequest will ignore supplied duration and error parameters. These values are collected from the request and response objects."),r&&r.request&&r.response?Gp.trackRequest(this,r):Ni.warn("trackNodeHttpRequest requires NodeHttpRequestTelemetry object with request and response specified.")},e.prototype.trackNodeHttpDependency=function(r){r&&r.request?f_.trackRequest(this,r):Ni.warn("trackNodeHttpDependency requires NodeHttpDependencyTelemetry object with request specified.")},e}(p_);zp.exports=d_});var Kp=d(Wp=>{"use strict";Object.defineProperty(Wp,"__esModule",{value:!0})});var gf=d(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var no=wt(),h_=Pl(),v_=Dl(),Yp=Pi(),g_=np(),m_=xr(),y_=Ba(),Jp=At(),hn=ae(),__=wp(),Zp=xp();T.TelemetryClient=Qp();T.Contracts=De();T.azureFunctionsTypes=Kp();var ef;(function(t){t[t.AI=0]="AI",t[t.AI_AND_W3C=1]="AI_AND_W3C"})(ef=T.DistributedTracingModes||(T.DistributedTracingModes={}));var tf=!0,rf=!1,nf=!0,sf=!0,af=!1,of=!0,uf=!0,cf=!0,io=!0,lf,Li=!1,pf=!0,ff,df=void 0,hf=void 0,vn,gn,mn,yn,Sr,Ut,_n,ft=!1,Xp;function C_(t){return T.defaultClient?hn.info("The default client is already setup"):(T.defaultClient=new T.TelemetryClient(t),vn=new h_(T.defaultClient),gn=new v_(T.defaultClient),mn=new Yp(T.defaultClient),yn=new g_(T.defaultClient),Ut=new y_(T.defaultClient),_n=new m_(T.defaultClient),Sr||(Sr=new Zp.AutoCollectNativePerformance(T.defaultClient))),T.defaultClient&&T.defaultClient.channel&&T.defaultClient.channel.setUseDiskRetryCaching(cf,df,hf),so}T.setup=C_;function vf(){return T.defaultClient?(ft=!0,vn.enable(tf,rf),gn.enable(nf),mn.enable(sf),yn.enable(af,T.defaultClient.config),Sr.enable(pf,ff),Ut.useAutoCorrelation(io,lf),Ut.enable(of),_n.enable(uf),T.liveMetricsClient&&Li&&T.liveMetricsClient.enable(Li)):hn.warn("Start cannot be called before setup"),so}T.start=vf;function E_(){return io?no.CorrelationContextManager.getCurrentContext():null}T.getCorrelationContext=E_;function b_(t,e){return no.CorrelationContextManager.startOperation(t,e)}T.startOperation=b_;function T_(t,e){return no.CorrelationContextManager.wrapCallback(t,e)}T.wrapWithCorrelationContext=T_;var so=function(){function t(){}return t.setDistributedTracingMode=function(e){return Jp.w3cEnabled=e===ef.AI_AND_W3C,t},t.setAutoCollectConsole=function(e,r){return r===void 0&&(r=!1),tf=e,rf=r,ft&&vn.enable(e,r),t},t.setAutoCollectExceptions=function(e){return nf=e,ft&&gn.enable(e),t},t.setAutoCollectPerformance=function(e,r){r===void 0&&(r=!0),sf=e;var n=Zp.AutoCollectNativePerformance.parseEnabled(r);return pf=n.isEnabled,ff=n.disabledMetrics,ft&&(mn.enable(e),Sr.enable(n.isEnabled,n.disabledMetrics)),t},t.setAutoCollectHeartbeat=function(e){return af=e,ft&&yn.enable(e,T.defaultClient.config),t},t.setAutoCollectRequests=function(e){return of=e,ft&&Ut.enable(e),t},t.setAutoCollectDependencies=function(e){return uf=e,ft&&_n.enable(e),t},t.setAutoDependencyCorrelation=function(e,r){return io=e,lf=r,ft&&Ut.useAutoCorrelation(e,r),t},t.setUseDiskRetryCaching=function(e,r,n){return cf=e,df=r,hf=n,T.defaultClient&&T.defaultClient.channel&&T.defaultClient.channel.setUseDiskRetryCaching(e,r,n),t},t.setInternalLogging=function(e,r){return e===void 0&&(e=!1),r===void 0&&(r=!0),hn.enableDebug=e,hn.disableWarnings=!r,t},t.setSendLiveMetrics=function(e){return e===void 0&&(e=!1),T.defaultClient?(!T.liveMetricsClient&&e?(T.liveMetricsClient=new __(T.defaultClient.config.instrumentationKey),Xp=new Yp(T.liveMetricsClient,1e3,!0),T.liveMetricsClient.addCollector(Xp),T.defaultClient.quickPulseClient=T.liveMetricsClient):T.liveMetricsClient&&T.liveMetricsClient.enable(e),Li=e,t):(hn.warn("Live metrics client cannot be setup without the default client"),t)},t.start=vf,t}();T.Configuration=so;function w_(){Jp.w3cEnabled=!0,T.defaultClient=null,ft=!1,vn&&vn.dispose(),gn&&gn.dispose(),mn&&mn.dispose(),yn&&yn.dispose(),Sr&&Sr.dispose(),Ut&&Ut.dispose(),_n&&_n.dispose(),T.liveMetricsClient&&(T.liveMetricsClient.enable(!1),Li=!1,T.liveMetricsClient=void 0)}T.dispose=w_});var ao=d((Mi,mf)=>{"use strict";Object.defineProperty(Mi,"__esModule",{value:!0});Mi.default=k_;var I_=x_(require("crypto"));function x_(t){return t&&t.__esModule?t:{default:t}}function k_(){return I_.default.randomBytes(16)}mf.exports=Mi.default});var Fi=d((En,_f)=>{"use strict";Object.defineProperty(En,"__esModule",{value:!0});En.default=void 0;var yf=[];for(Cn=0;Cn<256;++Cn)yf[Cn]=(Cn+256).toString(16).substr(1);var Cn;function S_(t,e){var r=e||0,n=yf;return[n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]]].join("")}var P_=S_;En.default=P_;_f.exports=En.default});var Tf=d((bn,bf)=>{"use strict";Object.defineProperty(bn,"__esModule",{value:!0});bn.default=void 0;var A_=Ef(ao()),D_=Ef(Fi());function Ef(t){return t&&t.__esModule?t:{default:t}}var Cf,oo,uo=0,co=0;function R_(t,e,r){var n=e&&r||0,i=e||[];t=t||{};var s=t.node||Cf,a=t.clockseq!==void 0?t.clockseq:oo;if(s==null||a==null){var o=t.random||(t.rng||A_.default)();s==null&&(s=Cf=[o[0]|1,o[1],o[2],o[3],o[4],o[5]]),a==null&&(a=oo=(o[6]<<8|o[7])&16383)}var u=t.msecs!==void 0?t.msecs:new Date().getTime(),c=t.nsecs!==void 0?t.nsecs:co+1,l=u-uo+(c-co)/1e4;if(l<0&&t.clockseq===void 0&&(a=a+1&16383),(l<0||u>uo)&&t.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");uo=u,co=c,oo=a,u+=122192928e5;var p=((u&268435455)*1e4+c)%4294967296;i[n++]=p>>>24&255,i[n++]=p>>>16&255,i[n++]=p>>>8&255,i[n++]=p&255;var f=u/4294967296*1e4&268435455;i[n++]=f>>>8&255,i[n++]=f&255,i[n++]=f>>>24&15|16,i[n++]=f>>>16&255,i[n++]=a>>>8|128,i[n++]=a&255;for(var h=0;h<6;++h)i[n+h]=s[h];return e||(0,D_.default)(i)}var O_=R_;bn.default=O_;bf.exports=bn.default});var lo=d($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.default=F_;$t.URL=$t.DNS=void 0;var q_=N_(Fi());function N_(t){return t&&t.__esModule?t:{default:t}}function L_(t){var e=[];return t.replace(/[a-fA-F0-9]{2}/g,function(r){e.push(parseInt(r,16))}),e}function M_(t){t=unescape(encodeURIComponent(t));for(var e=new Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}var wf="6ba7b810-9dad-11d1-80b4-00c04fd430c8";$t.DNS=wf;var If="6ba7b811-9dad-11d1-80b4-00c04fd430c8";$t.URL=If;function F_(t,e,r){var n=function(i,s,a,o){var u=a&&o||0;if(typeof i=="string"&&(i=M_(i)),typeof s=="string"&&(s=L_(s)),!Array.isArray(i))throw TypeError("value must be an array of bytes");if(!Array.isArray(s)||s.length!==16)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var c=r(s.concat(i));if(c[6]=c[6]&15|e,c[8]=c[8]&63|128,a)for(var l=0;l<16;++l)a[u+l]=c[l];return a||(0,q_.default)(c)};try{n.name=t}catch{}return n.DNS=wf,n.URL=If,n}});var kf=d((Tn,xf)=>{"use strict";Object.defineProperty(Tn,"__esModule",{value:!0});Tn.default=void 0;var H_=j_(require("crypto"));function j_(t){return t&&t.__esModule?t:{default:t}}function U_(t){return Array.isArray(t)?t=Buffer.from(t):typeof t=="string"&&(t=Buffer.from(t,"utf8")),H_.default.createHash("md5").update(t).digest()}var $_=U_;Tn.default=$_;xf.exports=Tn.default});var Af=d((wn,Pf)=>{"use strict";Object.defineProperty(wn,"__esModule",{value:!0});wn.default=void 0;var V_=Sf(lo()),B_=Sf(kf());function Sf(t){return t&&t.__esModule?t:{default:t}}var G_=(0,V_.default)("v3",48,B_.default),z_=G_;wn.default=z_;Pf.exports=wn.default});var Of=d((In,Rf)=>{"use strict";Object.defineProperty(In,"__esModule",{value:!0});In.default=void 0;var Q_=Df(ao()),W_=Df(Fi());function Df(t){return t&&t.__esModule?t:{default:t}}function K_(t,e,r){var n=e&&r||0;typeof t=="string"&&(e=t==="binary"?new Array(16):null,t=null),t=t||{};var i=t.random||(t.rng||Q_.default)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e)for(var s=0;s<16;++s)e[n+s]=i[s];return e||(0,W_.default)(i)}var X_=K_;In.default=X_;Rf.exports=In.default});var Nf=d((xn,qf)=>{"use strict";Object.defineProperty(xn,"__esModule",{value:!0});xn.default=void 0;var Y_=J_(require("crypto"));function J_(t){return t&&t.__esModule?t:{default:t}}function Z_(t){return Array.isArray(t)?t=Buffer.from(t):typeof t=="string"&&(t=Buffer.from(t,"utf8")),Y_.default.createHash("sha1").update(t).digest()}var eC=Z_;xn.default=eC;qf.exports=xn.default});var Ff=d((kn,Mf)=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.default=void 0;var tC=Lf(lo()),rC=Lf(Nf());function Lf(t){return t&&t.__esModule?t:{default:t}}var nC=(0,tC.default)("v5",80,rC.default),iC=nC;kn.default=iC;Mf.exports=kn.default});var Hf=d(Pr=>{"use strict";Object.defineProperty(Pr,"__esModule",{value:!0});Object.defineProperty(Pr,"v1",{enumerable:!0,get:function(){return sC.default}});Object.defineProperty(Pr,"v3",{enumerable:!0,get:function(){return aC.default}});Object.defineProperty(Pr,"v4",{enumerable:!0,get:function(){return oC.default}});Object.defineProperty(Pr,"v5",{enumerable:!0,get:function(){return uC.default}});var sC=Hi(Tf()),aC=Hi(Af()),oC=Hi(Of()),uC=Hi(Ff());function Hi(t){return t&&t.__esModule?t:{default:t}}});var Bf=d((rb,Vf)=>{"use strict";function cC(t){for(var e=5381,r=t.length;r;)e=e*33^t.charCodeAt(--r);return e>>>0}Vf.exports=cC});var ad=d(()=>{"use strict";var sd=require("url"),Bt=require("https"),id="__agent_base_https_request_patched__";Bt.request[id]||(Bt.request=function(t){return function(e,r){let n;return typeof e=="string"?n=sd.parse(e):n=Object.assign({},e),n.port==null&&(n.port=443),n.secureEndpoint=!0,t.call(Bt,n,r)}}(Bt.request),Bt.request[id]=!0);Bt.get=function(t,e,r){let n;typeof t=="string"&&e&&typeof e!="function"?n=Object.assign({},sd.parse(t),e):!e&&!r?n=t:r||(n=t,r=e);let i=Bt.request(n,r);return i.end(),i}});var od=d((yo,_o)=>{(function(t,e){typeof yo=="object"&&typeof _o<"u"?_o.exports=e():typeof define=="function"&&define.amd?define(e):t.ES6Promise=e()})(yo,function(){"use strict";function t(v){var y=typeof v;return v!==null&&(y==="object"||y==="function")}function e(v){return typeof v=="function"}var r=void 0;Array.isArray?r=Array.isArray:r=function(v){return Object.prototype.toString.call(v)==="[object Array]"};var n=r,i=0,s=void 0,a=void 0,o=function(y,_){le[i]=y,le[i+1]=_,i+=2,i===2&&(a?a(ve):Qe())};function u(v){a=v}function c(v){o=v}var l=typeof window<"u"?window:void 0,p=l||{},f=p.MutationObserver||p.WebKitMutationObserver,h=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",m=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function E(){return function(){return process.nextTick(ve)}}function I(){return typeof s<"u"?function(){s(ve)}:U()}function q(){var v=0,y=new f(ve),_=document.createTextNode("");return y.observe(_,{characterData:!0}),function(){_.data=v=++v%2}}function Q(){var v=new MessageChannel;return v.port1.onmessage=ve,function(){return v.port2.postMessage(0)}}function U(){var v=setTimeout;return function(){return v(ve,1)}}var le=new Array(1e3);function ve(){for(var v=0;v<i;v+=2){var y=le[v],_=le[v+1];y(_),le[v]=void 0,le[v+1]=void 0}i=0}function He(){try{var v=Function("return this")().require("vertx");return s=v.runOnLoop||v.runOnContext,I()}catch{return U()}}var Qe=void 0;h?Qe=E():f?Qe=q():m?Qe=Q():l===void 0&&typeof require=="function"?Qe=He():Qe=U();function dt(v,y){var _=this,b=new this.constructor(Qt);b[Fn]===void 0&&Oo(b);var S=_._state;if(S){var P=arguments[S-1];o(function(){return Do(S,b,P,_._result)})}else Ji(_,b,v,y);return b}function bt(v){var y=this;if(v&&typeof v=="object"&&v.constructor===y)return v;var _=new y(Qt);return Or(_,v),_}var Fn=Math.random().toString(36).substring(2);function Qt(){}var Wt=void 0,Rr=1,Kt=2;function Qd(){return new TypeError("You cannot resolve a promise with itself")}function Wd(){return new TypeError("A promises callback cannot return that same promise.")}function Kd(v,y,_,b){try{v.call(y,_,b)}catch(S){return S}}function Xd(v,y,_){o(function(b){var S=!1,P=Kd(_,y,function(ie){S||(S=!0,y!==ie?Or(b,ie):et(b,ie))},function(ie){S||(S=!0,Ce(b,ie))},"Settle: "+(b._label||" unknown promise"));!S&&P&&(S=!0,Ce(b,P))},v)}function Yd(v,y){y._state===Rr?et(v,y._result):y._state===Kt?Ce(v,y._result):Ji(y,void 0,function(_){return Or(v,_)},function(_){return Ce(v,_)})}function Ao(v,y,_){y.constructor===v.constructor&&_===dt&&y.constructor.resolve===bt?Yd(v,y):_===void 0?et(v,y):e(_)?Xd(v,y,_):et(v,y)}function Or(v,y){if(v===y)Ce(v,Qd());else if(t(y)){var _=void 0;try{_=y.then}catch(b){Ce(v,b);return}Ao(v,y,_)}else et(v,y)}function Jd(v){v._onerror&&v._onerror(v._result),Zi(v)}function et(v,y){v._state===Wt&&(v._result=y,v._state=Rr,v._subscribers.length!==0&&o(Zi,v))}function Ce(v,y){v._state===Wt&&(v._state=Kt,v._result=y,o(Jd,v))}function Ji(v,y,_,b){var S=v._subscribers,P=S.length;v._onerror=null,S[P]=y,S[P+Rr]=_,S[P+Kt]=b,P===0&&v._state&&o(Zi,v)}function Zi(v){var y=v._subscribers,_=v._state;if(y.length!==0){for(var b=void 0,S=void 0,P=v._result,ie=0;ie<y.length;ie+=3)b=y[ie],S=y[ie+_],b?Do(_,b,S,P):S(P);v._subscribers.length=0}}function Do(v,y,_,b){var S=e(_),P=void 0,ie=void 0,Xt=!0;if(S){try{P=_(b)}catch(Hn){Xt=!1,ie=Hn}if(y===P){Ce(y,Wd());return}}else P=b;y._state!==Wt||(S&&Xt?Or(y,P):Xt===!1?Ce(y,ie):v===Rr?et(y,P):v===Kt&&Ce(y,P))}function Zd(v,y){try{y(function(b){Or(v,b)},function(b){Ce(v,b)})}catch(_){Ce(v,_)}}var Ro=0;function eh(){return Ro++}function Oo(v){v[Fn]=Ro++,v._state=void 0,v._result=void 0,v._subscribers=[]}function th(){return new Error("Array Methods must be provided an Array")}var rh=function(){function v(y,_){this._instanceConstructor=y,this.promise=new y(Qt),this.promise[Fn]||Oo(this.promise),n(_)?(this.length=_.length,this._remaining=_.length,this._result=new Array(this.length),this.length===0?et(this.promise,this._result):(this.length=this.length||0,this._enumerate(_),this._remaining===0&&et(this.promise,this._result))):Ce(this.promise,th())}return v.prototype._enumerate=function(_){for(var b=0;this._state===Wt&&b<_.length;b++)this._eachEntry(_[b],b)},v.prototype._eachEntry=function(_,b){var S=this._instanceConstructor,P=S.resolve;if(P===bt){var ie=void 0,Xt=void 0,Hn=!1;try{ie=_.then}catch(ts){Hn=!0,Xt=ts}if(ie===dt&&_._state!==Wt)this._settledAt(_._state,b,_._result);else if(typeof ie!="function")this._remaining--,this._result[b]=_;else if(S===Ie){var es=new S(Qt);Hn?Ce(es,Xt):Ao(es,_,ie),this._willSettleAt(es,b)}else this._willSettleAt(new S(function(ts){return ts(_)}),b)}else this._willSettleAt(P(_),b)},v.prototype._settledAt=function(_,b,S){var P=this.promise;P._state===Wt&&(this._remaining--,_===Kt?Ce(P,S):this._result[b]=S),this._remaining===0&&et(P,this._result)},v.prototype._willSettleAt=function(_,b){var S=this;Ji(_,void 0,function(P){return S._settledAt(Rr,b,P)},function(P){return S._settledAt(Kt,b,P)})},v}();function nh(v){return new rh(this,v).promise}function ih(v){var y=this;return n(v)?new y(function(_,b){for(var S=v.length,P=0;P<S;P++)y.resolve(v[P]).then(_,b)}):new y(function(_,b){return b(new TypeError("You must pass an array to race."))})}function sh(v){var y=this,_=new y(Qt);return Ce(_,v),_}function ah(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function oh(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var Ie=function(){function v(y){this[Fn]=eh(),this._result=this._state=void 0,this._subscribers=[],Qt!==y&&(typeof y!="function"&&ah(),this instanceof v?Zd(this,y):oh())}return v.prototype.catch=function(_){return this.then(null,_)},v.prototype.finally=function(_){var b=this,S=b.constructor;return e(_)?b.then(function(P){return S.resolve(_()).then(function(){return P})},function(P){return S.resolve(_()).then(function(){throw P})}):b.then(_,_)},v}();Ie.prototype.then=dt,Ie.all=nh,Ie.race=ih,Ie.resolve=bt,Ie.reject=sh,Ie._setScheduler=u,Ie._setAsap=c,Ie._asap=o;function uh(){var v=void 0;if(typeof global<"u")v=global;else if(typeof self<"u")v=self;else try{v=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var y=v.Promise;if(y){var _=null;try{_=Object.prototype.toString.call(y.resolve())}catch{}if(_==="[object Promise]"&&!y.cast)return}v.Promise=Ie}return Ie.polyfill=uh,Ie.Promise=Ie,Ie})});var cd=d((fT,ud)=>{"use strict";ud.exports=function(){"use strict";var t=void 0;function e(n){return typeof n=="function"}global!==void 0?t=global:window!==void 0&&window.document?t=window:t=self;var r=function(){if(!t.hasOwnProperty("Promise"))return!1;var n=t.Promise;return!n.hasOwnProperty("resolve")||!n.hasOwnProperty("reject")||!n.hasOwnProperty("all")||!n.hasOwnProperty("race")?!1:function(){var i=void 0,s=new t.Promise(function(a){i=a});return s?e(i):!1}()}();return r?t.Promise:od().Promise}()});var pd=d((dT,ld)=>{"use strict";ld.exports=function(){"use strict";var t=cd();function e(r){return r&&typeof r.then=="function"&&typeof r.catch=="function"}return function(n,i){return function(){for(var s=arguments.length,a=Array(s),o=0;o<s;o++)a[o]=arguments[o];var u=i&&i.multiArgs,c=void 0;return i&&i.thisArg?c=i.thisArg:i&&(c=i),new t(function(l,p){a.push(function(m){if(m)return p(m);for(var E=arguments.length,I=Array(E>1?E-1:0),q=1;q<E;q++)I[q-1]=arguments[q];if(!u)return l(I[0]);l(I)});var f=n.apply(c,a);e(f)&&l(f)})}}}()});var Co=d((hT,dd)=>{"use strict";ad();var gC=require("util").inherits,mC=pd(),fd=require("events").EventEmitter;dd.exports=Gt;function yC(t){return t&&typeof t.addRequest=="function"}function Gt(t,e){if(!(this instanceof Gt))return new Gt(t,e);fd.call(this),this._promisifiedCallback=!1;let r=e;typeof t=="function"?this.callback=t:t&&(r=t),this.timeout=r&&r.timeout||null,this.options=r}gC(Gt,fd);Gt.prototype.callback=function(e,r){throw new Error('"agent-base" has no default implementation, you must subclass and override `callback()`')};Gt.prototype.addRequest=function(e,r){let n=Object.assign({},r);n.host==null&&(n.host="localhost"),n.port==null&&(n.port=n.secureEndpoint?443:80);let i=Object.assign({},this.options,n);i.host&&i.path&&delete i.path,delete i.agent,delete i.hostname,delete i._defaultAgent,delete i.defaultPort,delete i.createConnection,e._last=!0,e.shouldKeepAlive=!1;let s,a=!1,o=this.timeout,u=this.freeSocket;function c(h){e._hadError||(e.emit("error",h),e._hadError=!0)}function l(){s=null,a=!0;let h=new Error('A "socket" was not created for HTTP request before '+o+"ms");h.code="ETIMEOUT",c(h)}function p(h){a||(s!=null&&(clearTimeout(s),s=null),c(h))}function f(h){if(!a)if(s!=null&&(clearTimeout(s),s=null),yC(h))h.addRequest(e,i);else if(h){let m=function(){u(h,i)};h.on("free",m),e.onSocket(h)}else{let m=new Error("no Duplex stream was returned to agent-base for `"+e.method+" "+e.path+"`");c(m)}}!this._promisifiedCallback&&this.callback.length>=3&&(this.callback=mC(this.callback,this),this._promisifiedCallback=!0),o>0&&(s=setTimeout(l,o));try{Promise.resolve(this.callback(e,i)).then(f,p)}catch(h){Promise.reject(h).catch(p)}};Gt.prototype.freeSocket=function(e,r){e.destroy()}});var vd=d((vT,hd)=>{var Rn=1e3,On=Rn*60,qn=On*60,Nn=qn*24,_C=Nn*365.25;hd.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return CC(t);if(r==="number"&&isNaN(t)===!1)return e.long?bC(t):EC(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function CC(t){if(t=String(t),!(t.length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!!e){var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*_C;case"days":case"day":case"d":return r*Nn;case"hours":case"hour":case"hrs":case"hr":case"h":return r*qn;case"minutes":case"minute":case"mins":case"min":case"m":return r*On;case"seconds":case"second":case"secs":case"sec":case"s":return r*Rn;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function EC(t){return t>=Nn?Math.round(t/Nn)+"d":t>=qn?Math.round(t/qn)+"h":t>=On?Math.round(t/On)+"m":t>=Rn?Math.round(t/Rn)+"s":t+"ms"}function bC(t){return Bi(t,Nn,"day")||Bi(t,qn,"hour")||Bi(t,On,"minute")||Bi(t,Rn,"second")||t+" ms"}function Bi(t,e,r){if(!(t<e))return t<e*1.5?Math.floor(t/e)+" "+r:Math.ceil(t/e)+" "+r+"s"}});var bo=d((A,gd)=>{A=gd.exports=Eo.debug=Eo.default=Eo;A.coerce=SC;A.disable=xC;A.enable=IC;A.enabled=kC;A.humanize=vd();A.instances=[];A.names=[];A.skips=[];A.formatters={};function TC(t){var e=0,r;for(r in t)e=(e<<5)-e+t.charCodeAt(r),e|=0;return A.colors[Math.abs(e)%A.colors.length]}function Eo(t){var e;function r(){if(!!r.enabled){var n=r,i=+new Date,s=i-(e||i);n.diff=s,n.prev=e,n.curr=i,e=i;for(var a=new Array(arguments.length),o=0;o<a.length;o++)a[o]=arguments[o];a[0]=A.coerce(a[0]),typeof a[0]!="string"&&a.unshift("%O");var u=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(l,p){if(l==="%%")return l;u++;var f=A.formatters[p];if(typeof f=="function"){var h=a[u];l=f.call(n,h),a.splice(u,1),u--}return l}),A.formatArgs.call(n,a);var c=r.log||A.log||console.log.bind(console);c.apply(n,a)}}return r.namespace=t,r.enabled=A.enabled(t),r.useColors=A.useColors(),r.color=TC(t),r.destroy=wC,typeof A.init=="function"&&A.init(r),A.instances.push(r),r}function wC(){var t=A.instances.indexOf(this);return t!==-1?(A.instances.splice(t,1),!0):!1}function IC(t){A.save(t),A.names=[],A.skips=[];var e,r=(typeof t=="string"?t:"").split(/[\s,]+/),n=r.length;for(e=0;e<n;e++)!r[e]||(t=r[e].replace(/\*/g,".*?"),t[0]==="-"?A.skips.push(new RegExp("^"+t.substr(1)+"$")):A.names.push(new RegExp("^"+t+"$")));for(e=0;e<A.instances.length;e++){var i=A.instances[e];i.enabled=A.enabled(i.namespace)}}function xC(){A.enable("")}function kC(t){if(t[t.length-1]==="*")return!0;var e,r;for(e=0,r=A.skips.length;e<r;e++)if(A.skips[e].test(t))return!1;for(e=0,r=A.names.length;e<r;e++)if(A.names[e].test(t))return!0;return!1}function SC(t){return t instanceof Error?t.stack||t.message:t}});var _d=d((we,yd)=>{we=yd.exports=bo();we.log=DC;we.formatArgs=AC;we.save=RC;we.load=md;we.useColors=PC;we.storage=typeof chrome<"u"&&typeof chrome.storage<"u"?chrome.storage.local:OC();we.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function PC(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}we.formatters.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function AC(t){var e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+we.humanize(this.diff),!!e){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(s){s!=="%%"&&(n++,s==="%c"&&(i=n))}),t.splice(i,0,r)}}function DC(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function RC(t){try{t==null?we.storage.removeItem("debug"):we.storage.debug=t}catch{}}function md(){var t;try{t=we.storage.debug}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}we.enable(md());function OC(){try{return window.localStorage}catch{}}});var Ed=d((gT,Cd)=>{"use strict";Cd.exports=(t,e=process.argv)=>{let r=t.startsWith("-")?"":t.length===1?"-":"--",n=e.indexOf(r+t),i=e.indexOf("--");return n!==-1&&(i===-1||n<i)}});var wd=d((mT,Td)=>{"use strict";var qC=require("os"),bd=require("tty"),Fe=Ed(),{env:ue}=process,Gi;Fe("no-color")||Fe("no-colors")||Fe("color=false")||Fe("color=never")?Gi=0:(Fe("color")||Fe("colors")||Fe("color=true")||Fe("color=always"))&&(Gi=1);function NC(){if("FORCE_COLOR"in ue)return ue.FORCE_COLOR==="true"?1:ue.FORCE_COLOR==="false"?0:ue.FORCE_COLOR.length===0?1:Math.min(Number.parseInt(ue.FORCE_COLOR,10),3)}function LC(t){return t===0?!1:{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}function MC(t,{streamIsTTY:e,sniffFlags:r=!0}={}){let n=NC();n!==void 0&&(Gi=n);let i=r?Gi:n;if(i===0)return 0;if(r){if(Fe("color=16m")||Fe("color=full")||Fe("color=truecolor"))return 3;if(Fe("color=256"))return 2}if(t&&!e&&i===void 0)return 0;let s=i||0;if(ue.TERM==="dumb")return s;if(process.platform==="win32"){let a=qC.release().split(".");return Number(a[0])>=10&&Number(a[2])>=10586?Number(a[2])>=14931?3:2:1}if("CI"in ue)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(a=>a in ue)||ue.CI_NAME==="codeship"?1:s;if("TEAMCITY_VERSION"in ue)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(ue.TEAMCITY_VERSION)?1:0;if(ue.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in ue){let a=Number.parseInt((ue.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(ue.TERM_PROGRAM){case"iTerm.app":return a>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(ue.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(ue.TERM)||"COLORTERM"in ue?1:s}function To(t,e={}){let r=MC(t,{streamIsTTY:t&&t.isTTY,...e});return LC(r)}Td.exports={supportsColor:To,stdout:To({isTTY:bd.isatty(1)}),stderr:To({isTTY:bd.isatty(2)})}});var kd=d((ne,xd)=>{var FC=require("tty"),zi=require("util");ne=xd.exports=bo();ne.init=BC;ne.log=$C;ne.formatArgs=jC;ne.save=VC;ne.load=Id;ne.useColors=HC;ne.colors=[6,2,3,4,5,1];try{wo=wd(),wo&&wo.level>=2&&(ne.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}var wo;ne.inspectOpts=Object.keys(process.env).filter(function(t){return/^debug_/i.test(t)}).reduce(function(t,e){var r=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(i,s){return s.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),t[r]=n,t},{});function HC(){return"colors"in ne.inspectOpts?Boolean(ne.inspectOpts.colors):FC.isatty(process.stderr.fd)}ne.formatters.o=function(t){return this.inspectOpts.colors=this.useColors,zi.inspect(t,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};ne.formatters.O=function(t){return this.inspectOpts.colors=this.useColors,zi.inspect(t,this.inspectOpts)};function jC(t){var e=this.namespace,r=this.useColors;if(r){var n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),s="  "+i+";1m"+e+" \x1B[0m";t[0]=s+t[0].split(`
`).join(`
`+s),t.push(i+"m+"+ne.humanize(this.diff)+"\x1B[0m")}else t[0]=UC()+e+" "+t[0]}function UC(){return ne.inspectOpts.hideDate?"":new Date().toISOString()+" "}function $C(){return process.stderr.write(zi.format.apply(zi,arguments)+`
`)}function VC(t){t==null?delete process.env.DEBUG:process.env.DEBUG=t}function Id(){return process.env.DEBUG}function BC(t){t.inspectOpts={};for(var e=Object.keys(ne.inspectOpts),r=0;r<e.length;r++)t.inspectOpts[e[r]]=ne.inspectOpts[e[r]]}ne.enable(Id())});var xo=d((yT,Io)=>{typeof process>"u"||process.type==="renderer"?Io.exports=_d():Io.exports=kd()});var Ad=d((_T,Pd)=>{var GC=require("net"),zC=require("tls"),ko=require("url"),Sd=Co(),QC=require("util").inherits,Qi=xo()("http-proxy-agent");Pd.exports=Ln;function Ln(t){if(!(this instanceof Ln))return new Ln(t);if(typeof t=="string"&&(t=ko.parse(t)),!t)throw new Error("an HTTP(S) proxy server `host` and `port` must be specified!");Qi("creating new HttpProxyAgent instance: %o",t),Sd.call(this,t);var e=Object.assign({},t);this.secureProxy=e.protocol?/^https:?$/i.test(e.protocol):!1,e.host=e.hostname||e.host,e.port=+e.port||(this.secureProxy?443:80),e.host&&e.path&&(delete e.path,delete e.pathname),this.proxy=e}QC(Ln,Sd);Ln.prototype.callback=function(e,r,n){var i=this.proxy,s=ko.parse(e.path);s.protocol==null&&(s.protocol="http:"),s.hostname==null&&(s.hostname=r.hostname||r.host),s.port==null&&(s.port=r.port),s.port==80&&delete s.port;var a=ko.format(s);e.path=a,i.auth&&e.setHeader("Proxy-Authorization","Basic "+Buffer.from(i.auth).toString("base64"));var o;if(this.secureProxy?o=zC.connect(i):o=GC.connect(i),e._header&&(Qi("regenerating stored HTTP header string for request"),e._header=null,e._implicitHeader(),e.output&&e.output.length>0)){Qi("patching connection write() output buffer with updated header");var u=e.output[0],c=u.indexOf(`\r
\r
`)+4;e.output[0]=e._header+u.substring(c),Qi("output buffer: %o",e.output)}n(null,o)}});var Nd=d((CT,qd)=>{var Dd=require("net"),Rd=require("tls"),WC=require("url"),KC=require("assert"),Od=Co(),XC=require("util").inherits,zt=xo()("https-proxy-agent");qd.exports=Mn;function Mn(t){if(!(this instanceof Mn))return new Mn(t);if(typeof t=="string"&&(t=WC.parse(t)),!t)throw new Error("an HTTP(S) proxy server `host` and `port` must be specified!");zt("creating new HttpsProxyAgent instance: %o",t),Od.call(this,t);var e=Object.assign({},t);this.secureProxy=e.protocol?/^https:?$/i.test(e.protocol):!1,e.host=e.hostname||e.host,e.port=+e.port||(this.secureProxy?443:80),this.secureProxy&&!("ALPNProtocols"in e)&&(e.ALPNProtocols=["http 1.1"]),e.host&&e.path&&(delete e.path,delete e.pathname),this.proxy=e,this.defaultPort=443}XC(Mn,Od);Mn.prototype.callback=function(e,r,n){var i=this.proxy,s;this.secureProxy?s=Rd.connect(i):s=Dd.connect(i);var a=[],o=0;function u(){var U=s.read();U?h(U):s.once("readable",u)}function c(){s.removeListener("end",p),s.removeListener("error",f),s.removeListener("close",l),s.removeListener("readable",u)}function l(U){zt("onclose had error %o",U)}function p(){zt("onend")}function f(U){c(),n(U)}function h(U){a.push(U),o+=U.length;var le=Buffer.concat(a,o),ve=le.toString("ascii");if(!~ve.indexOf(`\r
\r
`)){zt("have not received end of HTTP headers yet..."),u();return}var He=ve.substring(0,ve.indexOf(`\r
`)),Qe=+He.split(" ")[1];if(zt("got proxy server response: %o",He),Qe==200){var dt=s;a=le=null,r.secureEndpoint&&(zt("upgrading proxy-connected socket to TLS connection: %o",r.host),r.socket=s,r.servername=r.servername||r.host,r.host=null,r.hostname=null,r.port=null,dt=Rd.connect(r)),c(),e.once("socket",YC),n(null,dt)}else c(),s.destroy(),s=new Dd.Socket,s.readable=!0,a=le,e.once("socket",m),n(null,s)}function m(U){zt("replaying proxy buffer for failed request"),KC(U.listenerCount("data")>0),U.push(a),a=null}s.on("error",f),s.on("close",l),s.on("end",p),u();var E=r.host+":"+r.port,I="CONNECT "+E+` HTTP/1.1\r
`,q=Object.assign({},i.headers);i.auth&&(q["Proxy-Authorization"]="Basic "+Buffer.from(i.auth).toString("base64"));var Q=r.host;JC(r.port,r.secureEndpoint)||(Q+=":"+r.port),q.Host=Q,q.Connection="close",Object.keys(q).forEach(function(U){I+=U+": "+q[U]+`\r
`}),s.write(I+`\r
`)};function YC(t){t.resume()}function JC(t,e){return Boolean(!e&&t===80||e&&t===443)}});var lE={};hh(lE,{activate:()=>uE,deactivate:()=>cE});module.exports=vh(lE);var zd=require("vscode");var O=require("vscode");var rs=require("console"),Un=require("fs"),pe=require("vscode");function We(t,e,r){return{range:t,kind:e,value:r}}var se=class{constructor(){}clearCache(){this._cache=void 0}parse(e){let r;return this._cache&&this._cache.uri==e.uri&&this._cache.version==e.version?r=this._cache.value:(r=se.parseValue(this.tokenize(e)),this._cache={uri:e.uri,version:e.version,value:r}),r}static next(e){if(e){let r=e.next();if(r&&!r.done)return r.value}}static parseValue(e){let r=se.next(e);if(r){let n=r.range.end;switch(r.kind){case 8:case 9:case 10:case 6:return{range:r.range,value:r.value};case 2:let i=[],s=[];for(;;){let u=se.parseValue(e);if(u)i.push(u),s.push(u.value);else break;let c=se.next(e);if(c==null||(n=c.range.end,c.kind==3))break;if(c.kind==4)continue;break}return{range:new pe.Range(r.range.start,n),value:s,items:i};case 0:let a=[],o={};for(;;){let u=!1,c=se.next(e);if(c==null)break;for(n=c.range.end;;){let f=se.next(e);if(f==null||f.kind!=5){if(a.push({name:c,value:void 0}),o[c.value]=void 0,f&&f.kind==6){c=f;continue}u=!0;break}break}if(u)break;let l=se.parseValue(e);if(a.push({name:c,value:l}),o[c.value]=l==null?void 0:l.value,l==null)break;n=l.range.end;let p=se.next(e);if(p==null||(n=p.range.end,p.kind==1))break;if(p.kind!=4)break}return{properties:a,range:new pe.Range(r.range.start,n),value:o};default:break}}}traverse(e,r,n,i){return C(this,null,function*(){if(e==null)return;let s=yield Promise.resolve(r(e,i));if(typeof s!="undefined")return s;let a=e;if(Array.isArray(a.items)){let o=0;for(let u of a.items)if(s=yield this.traverse(u,r,n,`${i}[${o++}]`),typeof s!="undefined")return s}else if(a.properties)for(let o of a.properties){if(s=yield Promise.resolve(n(o.name,o.value,i)),typeof s!="undefined")return s;let u=i?`${i}.${o.name.value}`:o.name.value;if(s=yield this.traverse(o.value,r,n,u),typeof s!="undefined")return s}})}*tokenize(e){let r=e.getText();for(let n=0;n<r.length;){let i=r[n],s=e.positionAt(n),a=new pe.Range(s,new pe.Position(s.line,s.character+1));switch(i){case"{":yield We(a,0);break;case"}":yield We(a,1);break;case"[":yield We(a,2);break;case"]":yield We(a,3);break;case",":yield We(a,4);break;case":":yield We(a,5);break;case'"':let o=se.parseString(r,n);yield We(new pe.Range(s,e.positionAt(o.end)),6,o.value),n=o.end;continue;default:if(i>="0"&&i<="9"||i=="-"){let c=se.parseNumber(r,n);if(c){yield We(new pe.Range(s,e.positionAt(n+c.length)),7,c.value),n+=c.length;continue}}let u=se.tryParseLiteral(r,n);if(u){yield We(new pe.Range(s,e.positionAt(n+u.length)),u.token,u.value),n+=u.length;continue}if(se.isIdentifierChar(i)){let c=se.parseIdentifier(r,n);if(c&&c.length>0){yield We(new pe.Range(s,e.positionAt(n+c.length)),6,c.value),n+=c.length;continue}}break}n++}}static isIdentifierChar(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="\\"||e=="/"||e=="_"}static parseIdentifier(e,r){let n=r;for(;r<e.length&&se.isIdentifierChar(e[r]);r++);return{start:n,end:r,length:r-n,value:e.substring(n,r)}}static tryParseLiteral(e,r){let n={null:[null,8],true:[!0,9],false:[!1,10]},i=e[r];for(let s in n)if(i==s[0]&&e.substring(r).match(`/^${s}/i`))return{length:s.length,value:n[s][0],token:n[s][1]}}static parseNumber(e,r){let n=e.substring(r).match(/^-?[0-9]*(\.[0-9]*)?([eE][+\-]?[0-9]+)?/i);if(n){let i=n[0],s;return i.includes(".")||i.includes("e")||i.includes("E")?s=parseFloat(i):s=parseInt(i),{value:s,length:i.length}}}static parseString(e,r){(0,rs.assert)(r<e.length,"argument out of range"),(0,rs.assert)(e[r]=='"',"expecting double quote");let n=r,i=!1,s="",a=!1;for(r++;r<e.length&&!a;r++){let o=e[r];if(i){switch(o){case"b":s+="\b";break;case"f":s+="\f";break;case"n":s+=`
`;break;case"r":s+="\r";break;case"t":s+="	";break;case"u":let u=e.substring(r+1).match(/^[0-9a-z]{1,4}/i);u?s+=String.fromCodePoint(parseInt(u[0],16)):s+="u";break;default:s+=o;break}i=!1}else switch(o){case"\\":i=!0;break;case'"':a=!0;break;default:s+=o;break}}return{value:s,start:n,end:r}}},Pe=class extends se{constructor(){super()}static parseComposerJson(e){return C(this,null,function*(){if(e&&(0,Un.existsSync)(e.fsPath))try{let r=yield pe.workspace.fs.readFile(e);if(r&&r.length!=0)return JSON.parse(Buffer.from(r).toString("utf-8"))}catch(r){}})}static parseComposerLock(e){return C(this,null,function*(){let r=pe.Uri.joinPath(e,"..","composer.lock");if((0,Un.existsSync)(r.fsPath))try{let n=yield pe.workspace.fs.readFile(r);if(n&&n.length!=0)return JSON.parse(Buffer.from(n).toString("utf-8"))}catch(n){}})}static parseComposerInstalledJson(e){return C(this,null,function*(){let r=pe.Uri.joinPath(e,"..","vendor/composer/installed.json");if((0,Un.existsSync)(r.fsPath))try{let n=yield pe.workspace.fs.readFile(r);if(n&&n.length!=0)return JSON.parse(Buffer.from(n).toString("utf-8"))}catch(n){}})}static parsePackagesMeta(e){let r={};if(e)for(let n of["packages","packages-dev"]){let i=e[n];Array.isArray(i)&&i.forEach(s=>{s.name&&(r[s.name]=s)})}return r}resolvePackagesMeta(e){return C(this,null,function*(){let r={};return r=Object.assign(r,Pe.parsePackagesMeta(yield Pe.parseComposerLock(e))),r=Object.assign(r,Pe.parsePackagesMeta(yield Pe.parseComposerInstalledJson(e))),r})}},Jt=new Pe;var Kf=require("fs");var ji=qr(gf()),po=require("os"),zf=require("vscode"),Qf=qr(Hf());var jf=require("fs");function Uf(t){return t.map(e=>String.fromCharCode(e)).join("")}function $f(t,e){return C(this,null,function*(){let r=yield new Promise(n=>{(0,jf.writeFile)(t,e,i=>{n(i)})});if(r)throw r})}var oe=class{constructor(){this.disposables=[]}push(e){this.disposables.push(e)}onDispose(){}dispose(){try{this.onDispose()}catch(e){}for(let e of this.disposables)e.dispose();this.disposables=[]}};var lC=qr(Ks()),Ar,pC=[101,56,52,97,53,57,53,55,45,100,54,56,48,45,52,99,99,53,45,57,50,54,55,45,53,101,53,101,51,100,48,97,56,100,53,55],Gf={};function Wf(t){ji.Configuration.setAutoCollectExceptions(!0).setUseDiskRetryCaching(!0).setAutoCollectConsole(!0,!0).setInternalLogging(!0,!0),Ar=new ji.TelemetryClient(Uf(pC)),Ar.context.tags["ai.device.model"]="Visual Studio Code "+zf.version,Ar.context.tags["ai.user.id"]=(0,po.userInfo)().username,Ar.context.tags["ai.user.accountId"]=Bf()((0,po.userInfo)().username).toString(),Ar.context.tags["ai.session.id"]=(0,Qf.v1)(),Sn("extension loaded (composer)")}function Sn(t,e){e==null&&(e={});for(let r in Gf)e[r]=Gf[r];Ar.trackEvent({name:t,properties:e})}var fo=class{constructor(){this.dictionary={};this.locale="en";let e=JSON.parse(process.env.VSCODE_NLS_CONFIG);e&&typeof e.locale=="string"&&(this.locale=e.locale)}read_i18n(e){try{let r=Buffer.from((0,Kf.readFileSync)(e)).toString("utf-8");return JSON.parse(r)}catch(r){return{}}}localize(e){return this.dictionary[e]}load(e){Sn("composer.localize.load",{locale:this.locale}),this.dictionary=Object.assign({},this.read_i18n(e.asAbsolutePath("package.nls.json")),this.read_i18n(e.asAbsolutePath("package.nls.en.json")),this.read_i18n(e.asAbsolutePath(`package.nls.${this.locale}.json`)))}},Xf=new fo;function Yf(t){return C(this,null,function*(){yield Xf.load(t)})}function F(t,e){return fC(t,e)}function fC(t,e){var r,n;return(n=(r=Xf.localize(t))!=null?r:e)!=null?n:t}var B=class{static get description(){return F("description")}static get installed_version(){return F("installed_version")}static get action_update(){return F("action.update")}static get action_remove(){return F("action.remove")}static get composer_workingPath_description(){return F("composer.workingPath.description")}static get error_missingComposerLock(){return F("error.missingComposerLock")}static get task_composer_args_description(){return F("task.composer.args.description")}static get task_composer_command_description(){return F("task.composer.command.description")}static get commands_download_title(){return F("commands.download.title")}static get error_couldntGetComposer(){return F("error.couldntGetComposer")}static get codelens_install(){return F("codelens.install")}static get action_choose_folder(){return F("action.choose-folder")}static get action_open_folder(){return F("action.open-folder")}static get authors(){return F("authors")}static get composer_diagnosticsEnabled_description(){return F("composer.diagnosticsEnabled.description")}static get abandoned(){return F("abandoned")}static get title(){return F("title")}static get open_folder_title(){return F("open-folder.title")}static get codelens_update(){return F("codelens.update")}static get action_dontshowagain(){return F("action.dontshowagain")}static get action_install(){return F("action.install")}static get commands_search_title(){return F("commands.search.title")}static get capabilities_virtualWorkspaces_description(){return F("capabilities.virtualWorkspaces.description")}static get capabilities_untrustedWorkspaces_description(){return F("capabilities.untrustedWorkspaces.description")}static get error_nonEmptyFolder(){return F("error.nonEmptyFolder")}static get composer_bin_description(){return F("composer.bin.description")}static get codelens_check(){return F("codelens.check")}static get composer_inlayVersionEnabled_description(){return F("composer.inlayVersionEnabled.description")}static get action_dismiss(){return F("action.dismiss")}};var Jf=require("fs");function Zf(t){return new Promise((e,r)=>{(0,Jf.readdir)(t,(n,i)=>{n?e(!0):i&&i.length!=0?e(!1):e(!0)})})}var ho=require("vscode");function ed(t){return t==null?!1:ho.tasks.taskExecutions.includes(t)==!1?!0:new Promise(e=>{let r=ho.tasks.onDidEndTask(n=>{n.execution==t&&(r.dispose(),e(!0))})})}var Pn=require("vscode");function An(t){var e=Pn.workspace.getConfiguration(null,t).get("composer.workingPath","");return e&&e!=""&&e!="."?Pn.Uri.joinPath(t,e):t}function td(){var t=Pn.workspace.getConfiguration(null).get("composer.bin","");if(t&&t!=""&&t!=null&&typeof t=="string")return t}var vo=class extends oe{constructor(r,n){super();this.taskProvider=r;this.packagist=n;this.parser=Jt}registerCommand(r,n,i){this.push(O.commands.registerCommand(r,(...s)=>C(this,null,function*(){let a;if(n&&(n.requiresCwd||n.requiresComposerJson)&&(a=yield this.pickCwd(s,n&&n.requiresComposerJson,n&&n.enableOpenFolder),typeof a=="undefined"))return!1;s&&s.length!=0&&typeof s[0]=="string"&&s[0].endsWith("composer.json")&&s.shift(),i(a,...s)})))}QuickPickPackage(r,n,i){return new Promise(s=>{let a=O.window.createQuickPick(),o="require",u="packagist.org";a.canSelectMany=!1,a.title=r!=null?r:"Search package to install ...",a.placeholder=n!=null?n:"package name",a.items=[],a.onDidAccept(c=>C(this,null,function*(){let l=a.selectedItems&&a.selectedItems.length!=0?a.selectedItems[0].label:a.value.trim();s(l),a.hide()})),a.onDidHide(c=>s(void 0)),a.onDidChangeValue(c=>C(this,null,function*(){let l=i?[{tooltip:o,iconPath:new O.ThemeIcon("cloud-download")},{tooltip:u,iconPath:new O.ThemeIcon("link-external")}]:void 0,p=yield this.packagist.search(c.trim());if(a.value==c&&p&&Array.isArray(p.results)){let f=[];p.results.forEach(h=>{var I,q;let m=(I=h.downloads)!=null?I:0,E=(q=h.favers)!=null?q:0;f.push({label:h.name,description:`    $(extensions-install-count) ${m.toLocaleString("en-US",{maximumFractionDigits:0})}  $(star-full) ${E.toLocaleString("en-US",{maximumFractionDigits:0})}`,detail:h.description,buttons:l})}),a.items=f}})),a.onDidTriggerItemButton(c=>C(this,null,function*(){switch(c.button.tooltip){case o:yield this.taskProvider.executeComposerTask("require",[c.item.label],void 0);break;case u:let l=`https://packagist.org/packages/${c.item.label}`;yield O.env.openExternal(O.Uri.parse(l));break}})),a.show()})}pickCwd(r,n,i){return C(this,null,function*(){if(r&&r.length>=1&&typeof r[0]=="string"&&r[0].endsWith("composer.json"))return O.Uri.joinPath(O.Uri.parse(r[0]),"..").fsPath;let s=O.workspace.workspaceFolders;if(s){if(s.length==1)return An(s[0].uri).fsPath;if(s.length>1){let a=yield O.window.showWorkspaceFolderPick({placeHolder:"Select the command's working directory ..."});if(a)return An(a.uri).fsPath}return}if(i){let a=yield O.window.showOpenDialog({canSelectMany:!1,canSelectFiles:!1,canSelectFolders:!0,openLabel:B.action_choose_folder});return a&&a.length==1?a[0].fsPath:void 0}if(O.window.activeTextEditor){let a=O.Uri.joinPath(O.window.activeTextEditor.document.uri,"..");if(a.scheme=="file")return a.fsPath}})}pickInstalledPackage(r,n,i){return C(this,null,function*(){var p,f;let s=O.Uri.joinPath(O.Uri.file(r),"composer.json"),a=yield Pe.parseComposerJson(s),o=[],u="(dev) ";if(a){let h=(m,E,I)=>{m!="php"&&!m.startsWith("ext-")&&o.push({label:m,description:`${I?u:""}${E}`})};for(let m in(p=a.require)!=null?p:{})h(m,a.require[m],!1);for(let m in(f=a["require-dev"])!=null?f:{})h(m,a["require-dev"][m],!0)}let c=h=>({pkgname:h.label,dev:h.description.startsWith(u)}),l=yield O.window.showQuickPick(o,{canPickMany:i!=null?i:!1,title:n!=null?n:"",placeHolder:"Package name"});return l?Array.isArray(l)?l.map(h=>c(h)):[c(l)]:[]})}},Ui=class extends vo{constructor(e,r,n){super(r,n),this.registerCommand("composer.install",{requiresComposerJson:!0},(i,...s)=>C(this,null,function*(){return yield r.executeComposerTask("install",s,i)})),this.registerCommand("composer.update",{requiresComposerJson:!0},(i,...s)=>C(this,null,function*(){return yield r.executeComposerTask("update",s,i)})),this.registerCommand("composer.remove",{requiresComposerJson:!0},(i,...s)=>C(this,null,function*(){if(s.length==0){let a=yield this.pickInstalledPackage(i,"Select package to remove",!0),o=a.filter(c=>c.dev).map(c=>c.pkgname),u=a.filter(c=>!c.dev).map(c=>c.pkgname);o.length!=0&&(yield r.executeComposerTask("remove",[...o,"--dev"],i)),u.length!=0&&(yield r.executeComposerTask("remove",u,i))}else return yield r.executeComposerTask("remove",s,i)})),this.registerCommand("composer.create-project",{requiresCwd:!0,enableOpenFolder:!0},(i,...s)=>C(this,null,function*(){if(e.appendLine(`Project will be created in '${i}' ...`),!(yield Zf(i)))throw e.appendLine(B.error_nonEmptyFolder),O.window.showErrorMessage(B.error_nonEmptyFolder),new Error(B.error_nonEmptyFolder);let a=s.length?s[0]:yield this.QuickPickPackage();if(a){e.appendLine(`About to create project from package '${a}' ...`);let o=yield this.taskProvider.executeComposerTask("create-project",[a,"."],i);O.workspace.workspaceFolders||(yield ed(o),(yield O.window.showInformationMessage(`${B.open_folder_title} (${i})`,B.action_open_folder,B.action_dismiss))==B.action_open_folder&&(yield O.commands.executeCommand("vscode.openFolder",O.Uri.file(i))))}})),this.registerCommand("composer.require",{requiresCwd:!0},(i,...s)=>C(this,null,function*(){let a=s.length?s[0]:yield this.QuickPickPackage();a&&(yield this.taskProvider.executeComposerTask("require",[a],i))})),this.registerCommand("composer.require-dev",{requiresCwd:!0},(i,...s)=>C(this,null,function*(){let a=s.length?s[0]:yield this.QuickPickPackage();a&&(yield this.taskProvider.executeComposerTask("require",[a,"--dev"],i))})),this.registerCommand("composer.run-script",{requiresComposerJson:!0},(i,...s)=>C(this,null,function*(){let a;if(s&&s.length>0)a=s[0];else{let o=O.Uri.joinPath(O.Uri.file(i),"composer.json"),u=yield Pe.parseComposerJson(o);if(u&&typeof u.scripts=="object"){let c=[];for(let l in u.scripts)c.push(l);a=yield O.window.showQuickPick(c,{title:"Select script to run ...",placeHolder:"script name"})}else{O.window.showErrorMessage(`'${"composer.json"}' could not be parsed`);return}}a&&(yield this.taskProvider.executeComposerTask("run-script",[a],i))})),this.registerCommand("composer.search",{},(i,...s)=>C(this,null,function*(){let a=yield this.QuickPickPackage("Search packages ...","filter",!0);if(a){let o=`https://packagist.org/packages/${a}`;yield O.env.openExternal(O.Uri.parse(o))}})),this.registerCommand("composer.about",{},()=>C(this,null,function*(){return yield this.taskProvider.executeComposerTask("about")})),this.registerCommand("composer.archive",{requiresCwd:!0},i=>C(this,null,function*(){let s=yield O.window.showInputBox({placeHolder:"[package] [version] --format=tar",title:"Create package archive.",prompt:'"composer archive" options'});typeof s!="undefined"&&(yield this.taskProvider.executeComposerTask("archive",s?s.split(" "):[],i))})),this.registerCommand("composer.clear-cache",{},()=>C(this,null,function*(){return yield this.taskProvider.executeComposerTask("clear-cache")})),this.registerCommand("composer.fund",{requiresComposerJson:!0},i=>C(this,null,function*(){return yield this.taskProvider.executeComposerTask("fund",[],i)})),this.registerCommand("composer.check-platform-reqs",{requiresComposerJson:!0},i=>C(this,null,function*(){return yield this.taskProvider.executeComposerTask("check-platform-reqs",[],i)})),this.registerCommand("composer.licenses",{requiresComposerJson:!0},i=>C(this,null,function*(){return yield this.taskProvider.executeComposerTask("licenses",[],i)})),this.registerCommand("composer.outdated",{requiresComposerJson:!0},i=>C(this,null,function*(){return yield this.taskProvider.executeComposerTask("outdated",[],i)})),this.registerCommand("composer.reinstall",{requiresComposerJson:!0},i=>C(this,null,function*(){return yield this.taskProvider.executeComposerTask("reinstall",[],i)})),this.registerCommand("composer.show-tree",{requiresComposerJson:!0},i=>C(this,null,function*(){return yield this.taskProvider.executeComposerTask("show",["--tree"],i)}))}};var j=require("vscode");function rd(t){return t&&(t.path.endsWith("composer.json")||t.path.endsWith("composer.lock"))}var dC=-99999;function hC(t,e){let r=[...e.matchAll(/\r?\n/g)];return{uri:t,version:dC++,getText:()=>e,positionAt:n=>{let i=new j.Position(0,n);if(r){let s=0;for(let a of r){let o=a.index+a.length;if(o<=n)i=new j.Position(++s,n-o);else break}}return i}}}var $i=class extends oe{constructor(){super();this.parser=Jt;this.documents=new Map;this.timeouts=new Map;this.push(this.collection=j.languages.createDiagnosticCollection("Composer"));let r;this.push(r=j.workspace.createFileSystemWatcher("**/composer.*")),this.push(j.workspace.onDidOpenTextDocument(n=>this.updateFromDocument(n))),this.push(j.workspace.onDidChangeTextDocument(n=>this.updateFromDocument(n.document))),this.push(j.workspace.onDidCloseTextDocument(n=>this.updateFromFs(n.uri))),this.push(j.workspace.onDidChangeConfiguration(n=>{n.affectsConfiguration("composer.diagnosticsEnabled")})),r.onDidChange(n=>this.updateFromFs(n)),r.onDidDelete(n=>this.updateFromFs(n)),r.onDidCreate(n=>this.updateFromFs(n)),j.workspace.workspaceFolders&&j.workspace.workspaceFolders.forEach(n=>C(this,null,function*(){yield this.updateFromFs(j.Uri.joinPath(n.uri,"composer.json")),yield this.updateFromFs(j.Uri.joinPath(n.uri,"composer.lock")),yield this.update(n.uri)}))}updateFromFs(r){return C(this,null,function*(){if(rd(r)){this.documents.delete(r.toString(!0));try{let n=yield j.workspace.fs.readFile(r);n&&n.length&&this.documents.set(r.toString(!0),hC(r,Buffer.from(n).toString("utf-8")))}catch(n){}yield this.setDirty(j.Uri.joinPath(r,".."))}})}updateFromDocument(r){return C(this,null,function*(){rd(r.uri)&&(this.documents.set(r.uri.toString(!0),r),yield this.setDirty(j.Uri.joinPath(r.uri,"..")))})}setDirty(r){return C(this,null,function*(){let n=r.toString(!0),i=this.timeouts.get(n);i?i.refresh():this.timeouts.set(n,setTimeout(()=>C(this,null,function*(){this.timeouts.delete(n),yield this.update(r)}),500))})}update(r){return C(this,null,function*(){let n=j.Uri.joinPath(r,"composer.json"),i=j.Uri.joinPath(r,"composer.lock"),s=this.documents.get(n.toString(!0)),a=this.documents.get(i.toString(!0)),o=[];if(s&&a&&j.workspace.getConfiguration().get("composer.diagnosticsEnabled",!0)!=!1){let u=Pe.parsePackagesMeta(JSON.parse(a.getText())),c=this.parser.parse(s);yield this.parser.traverse(c,(l,p)=>{},(l,p,f)=>{if(typeof l.value=="string"&&(f=="require"||f=="require-dev")){let h=u[l.value];if(h&&h.abandoned){let m=new j.Diagnostic(l.range,`'${l.value}' has been abandoned.`,j.DiagnosticSeverity.Warning);m.source="Composer",m.code="abandoned",m.tags=[j.DiagnosticTag.Deprecated],o.push(m)}}})}o.length?this.collection.set(n,o):this.collection.delete(n)})}};var k=require("vscode");var Dn={scheme:"file",language:"json",pattern:"**/composer.json"},Vt=class extends oe{constructor(r,n){super();this.taskProvider=r;this.packagist=n;this.parser=Jt;this.push(this.onDidChangeCodeLensesEmitter=new k.EventEmitter),this.onDidChangeCodeLenses=this.onDidChangeCodeLensesEmitter.event,this.push(this.onDidChangeInlayHintsEmitter=new k.EventEmitter),this.onDidChangeInlayHints=this.onDidChangeInlayHintsEmitter.event,this.push(k.languages.registerHoverProvider(Dn,this)),this.push(k.languages.registerInlayHintsProvider(Dn,this)),this.push(k.languages.registerCodeLensProvider(Dn,this)),this.push(k.languages.registerCompletionItemProvider(Dn,this,":",'"')),this.push(k.languages.registerCodeActionsProvider(Dn,this,{})),this.push(k.workspace.onDidChangeConfiguration(s=>{s.affectsConfiguration("composer.inlayVersionEnabled")&&this.onDidChangeInlayHintsEmitter.fire()}));let i;this.push(i=k.workspace.createFileSystemWatcher("**/composer.lock")),i.onDidDelete(s=>this.onDidChangeInlayHintsEmitter.fire()),i.onDidCreate(s=>this.onDidChangeInlayHintsEmitter.fire()),i.onDidChange(s=>this.onDidChangeInlayHintsEmitter.fire())}provideCodeActions(r,n,i,s){return C(this,null,function*(){let a=[],o=this.parser.parse(r);return yield this.parser.traverse(o,u=>{},(u,c,l)=>C(this,null,function*(){if((l=="require"||l=="require-dev")&&(n.intersection(u.range)||c&&c.range.intersection(n))){if(u.value=="php"||u.value.startsWith("ext-"))return;let p=l=="require-dev";(yield this.parser.resolvePackagesMeta(r.uri))[u.value]==null&&a.push({command:p?"composer.require-dev":"composer.require",title:`require "${u.value}"${p?" --dev":""}`,tooltip:"",arguments:[r.uri.toString(!0),u.value]}),a.push({command:"composer.update",title:`${B.action_update} "${u.value}"`,tooltip:"",arguments:[r.uri.toString(!0),u.value]}),a.push({command:"composer.remove",title:`${B.action_remove} "${u.value}"`,tooltip:"",arguments:[r.uri.toString(!0),u.value,p?"--dev":""]})}})),a})}provideCompletionForVersions(r,n){return C(this,null,function*(){let i=yield this.packagist.packageData(n),s=i!=null&&i.packages?i.packages[n]:void 0,a=[];if(Array.isArray(s)&&s.length){let o=new Set;a=s.filter(u=>u.version_normalized).map((u,c)=>{let l=u.version_normalized.split("."),p=l&&l.length>=2?new k.CompletionItem(`"^${l[0]}.${l[1]}"`):new k.CompletionItem(`"${u.version}"`);return p.range=r,p.filterText=` ${p.label}`,p.sortText=c.toString().padStart(8,"0"),p}).filter(u=>typeof u.label=="string"&&!o.has(u.label)&&o.add(u.label))}return{items:a,isIncomplete:!1}})}provideCompletionItems(r,n,i,s){return C(this,null,function*(){let a=this.parser.parse(r);return yield this.parser.traverse(a,o=>{},(o,u,c)=>C(this,null,function*(){var l;if(c=="require"||c=="require-dev"){if(o.range.contains(n)&&typeof o.value=="string"){let p=o.value.trim();if(p.length==0)return;let f=[],h=(l=r.getWordRangeAtPosition(n))!=null?l:new k.Range(n,n),m=yield this.packagist.search(p);return m&&m.results&&m.results.forEach(E=>{let I=new k.CompletionItem(E.name,k.CompletionItemKind.Reference);I.detail=E.description,I.documentation=Vt.descriptionForPackage(E,!1,!0,!0),I.insertText=`"${E.name}"`,E.abandoned&&(I.tags=[k.CompletionItemTag.Deprecated]),I.commitCharacters=[":",'"'," "],I.additionalTextEdits=[k.TextEdit.delete(o.range.with({end:h.start})),k.TextEdit.delete(o.range.with({start:h.end}))],f.push(I)}),{items:f,isIncomplete:!0}}if(u&&u.range.contains(n))return yield this.provideCompletionForVersions(u.range,o.value);if(o.range.end.line==n.line&&o.range.end.character<n.character&&r.getText(new k.Range(o.range.end,n)).trim()==":")return yield this.provideCompletionForVersions(new k.Range(n,n),o.value)}}))})}provideCodeLenses(r,n){return C(this,null,function*(){let i=[],s=new k.Range(0,0,0,0);i.push(new k.CodeLens(s,{title:`$(desktop-download) ${B.codelens_install}`,tooltip:"composer install",command:"composer.install",arguments:[r.uri.toString(!1)]}),new k.CodeLens(s,{title:`$(refresh) ${B.codelens_update}`,tooltip:"composer update",command:"composer.update",arguments:[r.uri.toString(!1)]}),new k.CodeLens(s,{title:`$(check) ${B.codelens_check}`,tooltip:"composer check-platform-reqs",command:"composer.check-platform-reqs",arguments:[r.uri.toString(!1)]}));let a=this.parser.parse(r);return yield this.parser.traverse(a,o=>{},(o,u,c)=>{c=="scripts"&&typeof o.value=="string"&&i.push(new k.CodeLens(o.range,{title:"$(run) Run",tooltip:`Run the script '${o.value}'`,command:"composer.run-script",arguments:[r.uri.toString(!1),o.value]}))}),i})}provideInlayHints(r,n,i){return C(this,null,function*(){let s=[];if(k.workspace.getConfiguration().get("composer.inlayVersionEnabled",!0)==!1)return s;let a=yield this.parser.resolvePackagesMeta(r.uri),o=this.parser.parse(r);return yield this.parser.traverse(o,u=>{},(u,c,l)=>{if((l=="require"||l=="require-dev")&&n.contains(u.range)&&c){let p=a[u.value];if(p&&p.version){let f=new k.InlayHintLabelPart(`(${p.version})`);f.tooltip=`${B.installed_version}`;let h=new k.InlayHint(c.range.end,[f],k.InlayHintKind.Type);h.paddingLeft=!0,h.textEdits=[],s.push(h)}}}),s})}static descriptionForPackage(r,n,i,s){var a,o;if(r&&r.name){let u=new k.MarkdownString("",!0);u.supportHtml=!0;let c=[],l="";if(r.version&&(l=`_(${r.version})_`),u.appendMarkdown(`**${r.name}** ${l}

`),r.authors&&Array.isArray(r.authors)){let p=r.authors.map(f=>`$(person) ${f.name}`).filter(f=>f).join(", ");p&&u.appendMarkdown(`**${B.authors}:** ${p}<br/>`)}if(r.abandoned&&u.appendMarkdown(`$(stop) **${B.abandoned}** ${r.abandoned}<br/>`),i&&typeof r.downloads=="number"&&u.appendMarkdown(`$(extensions-install-count) ${r.downloads.toLocaleString("en-US",{maximumFractionDigits:0})}<br/>`),s&&typeof r.favers=="number"&&u.appendMarkdown(`$(star-full) ${r.favers.toLocaleString("en-US",{maximumFractionDigits:0})}<br/>`),u.appendMarkdown(`

`),(typeof n=="undefined"||n)&&u.appendMarkdown(`${(a=r.description)!=null?a:""}

`),c.push(`[Packagist](https://packagist.org/packages/${r.name})`),(o=r.source)!=null&&o.url){let p=r.source.url,f="Source",h=p.replace(/\.git$/,"");c.push(`[${f}](${h})`)}return r.homepage&&c.push(`[Homepage](${r.homepage})`),u.appendMarkdown(c.join(" | ")),u}}provideHover(r,n,i){return C(this,null,function*(){let s=yield this.parser.resolvePackagesMeta(r.uri),a=this.parser.parse(r);return yield this.parser.traverse(a,o=>{},(o,u,c)=>{if((c=="require"||c=="require-dev")&&o.range.contains(n)){let l=s[o.value];if(l&&l.name)return new k.Hover(Vt.descriptionForPackage(l),o.range)}})})}};var mo=require("fs"),Ze=require("vscode");var nd="composer.lock.check",Vi=class extends oe{constructor(r,n){super();this.context=r;this.taskprovider=n;if(this.enabled){let i;this.push(Ze.workspace.onDidChangeWorkspaceFolders(s=>this.updateFolders(s.added))),this.push(i=Ze.workspace.createFileSystemWatcher("**/composer.lock",!0,!0,!1)),i.onDidDelete(s=>C(this,null,function*(){s.fsPath.endsWith("composer.lock")&&(yield this.updateFolder(Ze.workspace.getWorkspaceFolder(s)))})),this.updateFolders(Ze.workspace.workspaceFolders)}}updateFolders(r){r&&r.length!=0&&r.forEach(n=>this.updateFolder(n))}updateFolder(r){return C(this,null,function*(){if(!r||!r.uri||r.uri.scheme!="file")return;let n=Ze.Uri.joinPath(r.uri,"composer.json"),i=Ze.Uri.joinPath(r.uri,"composer.lock");try{(0,mo.existsSync)(n.fsPath)&&!(0,mo.existsSync)(i.fsPath)&&(yield this.popup(r))}catch(s){}})}get enabled(){return this.context.globalState.get(nd,!0)!=!1}set enabled(r){this.context.globalState.update(nd,r)}popup(r){return C(this,null,function*(){if(!r&&r.uri.scheme!="file"||!this.enabled)return;let n=B.action_install,i=B.action_dontshowagain,s=yield Ze.window.showWarningMessage(B.error_missingComposerLock,n,i);s==n?yield this.taskprovider.executeComposerTask("install",[],An(r.uri).fsPath):s==i&&(this.enabled=!1)})}};var ze=require("fs"),Et=require("process"),Dr=require("vscode");var Fd=qr(require("https")),Hd=require("url");var Ld=require("url"),ZC=Ad(),eE=Nd();function tE(t){return t.protocol==="http:"?process.env.HTTP_PROXY||process.env.http_proxy||null:t.protocol==="https:"&&(process.env.HTTPS_PROXY||process.env.https_proxy||process.env.HTTP_PROXY||process.env.http_proxy)||null}function Md(t,e,r){let n=e||tE(t);if(!n)return null;let i=(0,Ld.parse)(n);if(!/^https?:$/.test(i.protocol))return null;let s={host:i.hostname,port:Number(i.port),auth:i.auth,rejectUnauthorized:rE(r)?r:!0};return t.protocol==="http:"?new ZC(s):new eE(s)}function rE(t){return t===!0||t===!1}function jd(t,e,r,n,i){return C(this,null,function*(){e.appendLine("Downloading "+t+" ..."),e.appendLine("  URL: "+n);try{return So(t,n,e,r).then(s=>(e.appendLine("OK."),s))}catch(s){if(i){e.appendLine(`
  Alternative URL: `+i);try{let a=yield So(t,i,e,r);return e.appendLine("OK."),a}catch(a){throw s}}else throw s}})}function So(t,e,r,n){return C(this,null,function*(){let i=(0,Hd.parse)(e),s=n(),a=s.proxy,o=s.strictSSL,u={host:i.hostname,path:i.path,agent:Md(i,a,o),port:i.port,timeout:15*60*1e3,rejectUnauthorized:nE(o)?o:!0},c=[];return new Promise((l,p)=>{let f=Fd.request(u,h=>{if(h.statusCode===301||h.statusCode===302)return r.appendLine(`
  Redirect: ${h.headers.location}`),l(So(t,h.headers.location,r,n));if(h.statusCode!=200)return r.appendLine(`
  Download failure: status code '${h.statusCode}'`),p(new Error(h.statusCode.toString()));let m=parseInt(h.headers["content-length"]),E=0,I=0,q=`  Downloading (${Math.floor(m/1024)}kB):`;r.append(q),h.on("data",Q=>{E+=Q.length,c.push(Q);let U=Math.ceil(q.length*(E/m));for(;I<U;)r.append("."),I++}),h.on("end",()=>{l(Buffer.concat(c))}),h.on("error",Q=>{p(new Error(`Failed to download from ${e}. Error Message: ${Q.message} || 'NONE'}`))})});f.on("error",h=>{r.appendLine(`
  Error: ${h.message}`),p(new Error(`Request error: ${h.message||"NONE"}`))}),f.end()})})}function nE(t){return t===!0||t===!1}var Ud=require("vscode"),Wi=class{constructor(e,r){this.proxy=e;this.strictSSL=r}};function $d(){return()=>{let t=Ud.workspace.getConfiguration(),e=t.get("http.proxy"),r=t.get("http.proxyStrictSSL",!0);return new Wi(e,r)}}var iE=["/usr/bin/composer","/usr/local/bin/composer"],Vd="latest.phar.timestamp",sE=30*24*60*60;function Bd(){return Date.now()/1e3}var Ki=class extends oe{constructor(r,n){super();this.context=r;this.log=n;Dr.workspace.onDidChangeConfiguration(s=>{s.affectsConfiguration("composer.bin")&&this.updatePath()}),Dr.commands.registerCommand("composer.download",()=>C(this,null,function*(){return yield this.getOrDownloadComposerPhar(!0)}));var i=this.updatePath();i.userbin!=!0&&this.tryUpdate()}getUserDir(){let r=Et.platform=="win32"?"APPDATA":"HOME",n=Et.env[r];if(n)return n.replace("\\","/").trim()}getHomeDir(){var s,a;let r=Et.env["COMPOSER_HOME"];if(r)return r.trim();let n=this.getUserDir();if(n==null)return;if(Et.platform=="win32")return`${n}/Composer`;let i=[];if((0,ze.existsSync)("/etc/xdg")){let o=(s=Et.env.XDG_CONFIG_HOME)!=null?s:`${n}/.config`;i.push(`${o}/composer`)}return i.push(`${n}/.composer`),(a=i.find(o=>(0,ze.existsSync)(o)))!=null?a:i[0]}getComposerHome(){let r=this.getHomeDir();if(r==null||!r){this.log.appendLine(`Cannot determine composer home directory. Please set '${"COMPOSER_HOME"}' environment variable.`);return}if(r=r.replaceAll("\\","/").trim(),(0,ze.existsSync)(r))try{(0,ze.chmodSync)(r,511)}catch(n){}else{this.log.appendLine(`Creating folder '${r}' for 'composer.phar' installation.`),this.log.appendLine(`This can be customized using the '${"COMPOSER_HOME"}' environment variable.`);try{(0,ze.mkdirSync)(r,511)}catch(n){}}return r}resolveComposerPharPath(){var r=td();if(r)return{path:r,userbin:!0};for(let s of iE)if((0,ze.existsSync)(s))return{path:s,userbin:!0};let n=this.getComposerHome(),i=`${n}/composer.phar`;return(0,ze.existsSync)(i)?{path:i,userbin:!0}:{path:`${n}/latest.phar`}}updatePath(){let r=this.resolveComposerPharPath();return this.path=r.path,Et.platform=="win32"&&(this.path=this.path.replaceAll("/","\\")),console.log(`composer bin: '${this.path}'`),r}tryUpdate(){return C(this,null,function*(){var r=this.context.globalState.get(Vd,void 0);r===void 0?yield Dr.commands.executeCommand("composer.download"):r&&typeof r=="number"&&Bd()-r>sE&&(this.log.appendLine("  Updating composer.phar since the local version is more than 30 days old ..."),yield Dr.commands.executeCommand("composer.download"))})}getOrDownloadComposerPhar(r){return C(this,null,function*(){for(let n=0;n<3;n++){if(r||!(0,ze.existsSync)(this.path)){let i;try{i=yield jd("composer.phar",this.log,$d(),"https://getcomposer.org/composer.phar")}catch(s){}if(i&&i.byteLength>1024*1024)try{yield $f(this.path,i),this.context.globalState.update(Vd,Bd()),this.log.appendLine(`  composer.phar downloaded to '${this.path}'.`)}catch(s){this.log.appendLine(`  Error writing file '${this.path}': ${s.message}`);continue}else{i&&i.byteLength>0&&this.log.appendLine(`  Error: only ${i.byteLength} bytes downloaded.`);continue}}return this.path}})}};var ce=require("vscode");var Xi=class extends oe{constructor(r){super();this.composerphar=r;this.push(ce.tasks.registerTaskProvider("composer",{provideTasks:()=>[],resolveTask:(n,i)=>C(this,null,function*(){let s;return typeof n.scope=="object"&&n.scope.uri&&(s=n.scope.uri.fsPath),yield this.createTask(n.definition,s)})}))}getPhpToolsApi(){return C(this,null,function*(){var r,n;if(this.phptools==null){let i=ce.extensions.getExtension("devsense.phptools-vscode");i?this.phptools=(r=yield i.activate())!=null?r:{}:this.phptools={}}return(n=this.phptools)!=null?n:{}})}getPhpBin(){return C(this,null,function*(){let r=yield this.getPhpToolsApi();if(r&&r.phpBin){let i=yield r.phpBin();if(i)return i}let n=ce.workspace.getConfiguration().get("php.executablePath");return n!==void 0&&n&&typeof n=="string"&&n!="php"?n:"php"})}executeComposerTask(r,n,i){return C(this,null,function*(){return yield ce.tasks.executeTask(yield this.createComposerTask(r,n,i))})}createComposerTask(r,n,i){return C(this,null,function*(){return yield this.createTask({type:"composer",command:r,args:n},i)})}createTask(r,n){return C(this,null,function*(){var o,u;let i=yield this.composerphar.getOrDownloadComposerPhar();if(i===void 0){ce.window.showErrorMessage(B.error_couldntGetComposer);return}let s=yield this.getPhpBin(),a=[{value:i,quoting:ce.ShellQuoting.Strong},r.command];return r.args&&r.args.forEach(c=>{a.push({value:c!=null?c:"",quoting:ce.ShellQuoting.Strong})}),new ce.Task(r,(o=r.scope)!=null?o:ce.TaskScope.Workspace,(u=r.name)!=null?u:`composer ${r.command}`,"composer",new ce.ShellExecution(s,a,{cwd:n}))})}};var Gd=qr(require("https"));var aE=5*60*1e3,Yi=class extends oe{constructor(){super();this.cache={}}request(r){let n=this.cache[r];return n&&n.json&&n.timestamp+aE>Date.now()?n.json:new Promise((i,s)=>{let a=[];Gd.get(r,o=>{o.on("data",u=>{a.push(u)}),o.on("end",()=>{let u=JSON.parse(Buffer.concat(a).toString("utf-8"));this.cache[r]={json:u,timestamp:Date.now()},i(u)}),o.on("error",u=>{s(u)})})})}searchByTag(r){return C(this,null,function*(){return yield this.request(`https://packagist.org/search.json?tags=${r}`)})}search(r){return C(this,null,function*(){return yield this.request(`https://packagist.org/search.json?query=${r}`)})}packageData(r){return C(this,null,function*(){return yield this.request(`https://repo.packagist.org/p2/${r}.json`)})}};var oE;function uE(t){return C(this,null,function*(){Wf(t),Yf(t),t.subscriptions.push(oE=new Po(t))})}function cE(){return C(this,null,function*(){Sn("extension unloaded (composer)")})}var Po=class extends oe{constructor(r){super();this.push(this.log=zd.window.createOutputChannel("Composer")),this.push(this.packagist=new Yi),this.push(this.composerphar=new Ki(r,this.log)),this.push(this.taskprovider=new Xi(this.composerphar)),this.push(new Ui(this.log,this.taskprovider,this.packagist)),this.push(new Vt(this.taskprovider,this.packagist)),this.push(new Vi(r,this.taskprovider)),this.push(new $i)}};0&&(module.exports={activate,deactivate});
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */
